"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8149],{4097:function(e,t,s){s.d(t,{pV:function(){return tn}});var n=s(41113),i=s(53105),r=s(83454);class l{constructor(e){this.start=e}}class a extends l{constructor(e,t,s,n,i,r,l,a,o,h,u,c,f,p,d){super(e),this.rules=t,this.topRules=s,this.tokens=n,this.localTokens=i,this.context=r,this.externalTokens=l,this.externalSpecializers=a,this.externalPropSources=o,this.precedences=h,this.mainSkip=u,this.scopedSkip=c,this.dialects=f,this.externalProps=p,this.autoDelim=d}toString(){return Object.values(this.rules).join("\n")}}class o extends l{constructor(e,t,s,n,i){super(e),this.id=t,this.props=s,this.params=n,this.expr=i}toString(){return this.id.name+(this.params.length?`<${this.params.join()}>`:"")+" -> "+this.expr}}class h extends l{constructor(e,t){super(e),this.items=t}}class u extends l{constructor(e,t){super(e),this.items=t}}class c extends l{constructor(e,t,s){super(e),this.a=t,this.b=s}}class f extends l{constructor(e,t,s,n,i){super(e),this.precedences=t,this.conflicts=s,this.rules=n,this.literals=i}}class p extends l{constructor(e,t,s,n){super(e),this.precedences=t,this.rules=s,this.fallback=n}}class d extends l{constructor(e,t,s){super(e),this.literal=t,this.props=s}}class m extends l{constructor(e,t,s){super(e),this.id=t,this.source=s}}class g extends l{constructor(e,t,s,n){super(e),this.id=t,this.source=s,this.tokens=n}}class k extends l{constructor(e,t,s,n,i,r){super(e),this.type=t,this.token=s,this.id=n,this.source=i,this.tokens=r}}class x extends l{constructor(e,t,s){super(e),this.id=t,this.source=s}}class b extends l{constructor(e,t,s,n){super(e),this.id=t,this.externalID=s,this.source=n}}class w extends l{constructor(e,t){super(e),this.name=t}toString(){return this.name}}class y extends l{walk(e){return e(this)}eq(e){return!1}}y.prototype.prec=10;class $ extends y{constructor(e,t,s){super(e),this.id=t,this.args=s}toString(){return this.id.name+(this.args.length?`<${this.args.join()}>`:"")}eq(e){return this.id.name==e.id.name&&D(this.args,e.args)}walk(e){let t=z(this.args,e);return e(t==this.args?this:new $(this.start,this.id,t))}}class v extends y{constructor(e,t,s,n,i){super(e),this.type=t,this.props=s,this.token=n,this.content=i}toString(){return`@${this.type}[${this.props.join(",")}]<${this.token}, ${this.content}>`}eq(e){return this.type==e.type&&G.eqProps(this.props,e.props)&&C(this.token,e.token)&&C(this.content,e.content)}walk(e){let t=this.token.walk(e),s=this.content.walk(e);return e(t==this.token&&s==this.content?this:new v(this.start,this.type,this.props,t,s))}}class S extends y{constructor(e,t){super(e),this.rule=t}toString(){let e=this.rule;return`${e.id}${e.props.length?`[${e.props.join(",")}]`:""} { ${e.expr} }`}eq(e){let t=this.rule,s=e.rule;return C(t.expr,s.expr)&&t.id.name==s.id.name&&G.eqProps(t.props,s.props)}walk(e){let t=this.rule,s=t.expr.walk(e);return e(s==t.expr?this:new S(this.start,new o(t.start,t.id,t.props,[],s)))}}class O extends y{constructor(e,t){super(e),this.exprs=t}toString(){return this.exprs.map(e=>J(e,this)).join(" | ")}eq(e){return D(this.exprs,e.exprs)}walk(e){let t=z(this.exprs,e);return e(t==this.exprs?this:new O(this.start,t))}}O.prototype.prec=1;class R extends y{constructor(e,t,s,n=!1){super(e),this.exprs=t,this.markers=s,this.empty=n}toString(){return this.empty?"()":this.exprs.map(e=>J(e,this)).join(" ")}eq(e){return D(this.exprs,e.exprs)&&this.markers.every((t,s)=>{let n=e.markers[s];return t.length==n.length&&t.every((e,t)=>e.eq(n[t]))})}walk(e){let t=z(this.exprs,e);return e(t==this.exprs?this:new R(this.start,t,this.markers,this.empty&&!t.length))}}R.prototype.prec=2;class j extends l{constructor(e,t,s){super(e),this.id=t,this.type=s}toString(){return("ambig"==this.type?"~":"!")+this.id.name}eq(e){return this.id.name==e.id.name&&this.type==e.type}}class T extends y{constructor(e,t,s){super(e),this.expr=t,this.kind=s}toString(){return J(this.expr,this)+this.kind}eq(e){return C(this.expr,e.expr)&&this.kind==e.kind}walk(e){let t=this.expr.walk(e);return e(t==this.expr?this:new T(this.start,t,this.kind))}}T.prototype.prec=3;class N extends y{constructor(e,t){super(e),this.value=t}toString(){return JSON.stringify(this.value)}eq(e){return this.value==e.value}}class P extends y{constructor(e,t,s){super(e),this.ranges=t,this.inverted=s}toString(){return`[${this.inverted?"^":""}${this.ranges.map(([e,t])=>String.fromCodePoint(e)+(t==e+1?"":"-"+String.fromCodePoint(t)))}]`}eq(e){return this.inverted==e.inverted&&this.ranges.length==e.ranges.length&&this.ranges.every(([t,s],n)=>{let[i,r]=e.ranges[n];return t==i&&s==r})}}class A extends y{constructor(e){super(e)}toString(){return"_"}eq(){return!0}}function z(e,t){let s=null;for(let n=0;n<e.length;n++){let i=e[n].walk(t);i==e[n]||s||(s=e.slice(0,n)),s&&s.push(i)}return s||e}let I={asciiLetter:[[65,91],[97,123]],asciiLowercase:[[97,123]],asciiUppercase:[[65,91]],digit:[[48,58]],whitespace:[[9,14],[32,33],[133,134],[160,161],[5760,5761],[8192,8203],[8232,8234],[8239,8240],[8287,8288],[12288,12289]],eof:[[65535,65535]]};class q extends y{constructor(e,t){super(e),this.type=t}toString(){return"@"+this.type}eq(e){return this.type==e.type}}function C(e,t){return e.constructor==t.constructor&&e.eq(t)}function D(e,t){return e.length==t.length&&e.every((e,s)=>C(e,t[s]))}class G extends l{constructor(e,t,s,n){super(e),this.at=t,this.name=s,this.value=n}eq(e){return this.name==e.name&&this.value.length==e.value.length&&this.value.every((t,s)=>t.value==e.value[s].value&&t.name==e.value[s].name)}toString(){let e=(this.at?"@":"")+this.name;if(this.value.length)for(let{name:t,value:s}of(e+="=",this.value))e+=t?`{${t}}`:/[^\w-]/.test(s)?JSON.stringify(s):s;return e}static eqProps(e,t){return e.length==t.length&&e.every((e,s)=>e.eq(t[s]))}}class E extends l{constructor(e,t,s){super(e),this.value=t,this.name=s}}function J(e,t){return e.prec<t.prec?"("+e.toString()+")":e.toString()}class U extends Error{}function _(e){for(let t in e)return!0;return!1}let M=0;class B{constructor(e,t,s,n={}){this.name=e,this.flags=t,this.nodeName=s,this.props=n,this.hash=++M,this.id=-1,this.rules=[]}toString(){return this.name}get nodeType(){return this.top||null!=this.nodeName||_(this.props)||this.repeated}get terminal(){return(1&this.flags)>0}get eof(){return(4&this.flags)>0}get error(){return"error"in this.props}get top(){return(2&this.flags)>0}get interesting(){return this.flags>0||null!=this.nodeName}get repeated(){return(16&this.flags)>0}set preserve(e){this.flags=e?8|this.flags:-9&this.flags}get preserve(){return(8&this.flags)>0}set inline(e){this.flags=e?32|this.flags:-33&this.flags}get inline(){return(32&this.flags)>0}cmp(e){return this.hash-e.hash}}class F{constructor(){this.terms=[],this.names=Object.create(null),this.tops=[],this.eof=this.term("␄",null,5),this.error=this.term("⚠","⚠",8)}term(e,t,s=0,n={}){let i=new B(e,s,t,n);return this.terms.push(i),this.names[e]=i,i}makeTop(e,t){let s=this.term("@top",e,2,t);return this.tops.push(s),s}makeTerminal(e,t,s={}){return this.term(e,t,1,s)}makeNonTerminal(e,t,s={}){return this.term(e,t,0,s)}makeRepeat(e){return this.term(e,null,16)}uniqueName(e){for(let t=0;;t++){let s=t?`${e}-${t}`:e;if(!this.names[s])return s}}finish(e){for(let t of e)t.name.rules.push(t);this.terms=this.terms.filter(t=>t.terminal||t.preserve||e.some(e=>e.name==t||e.parts.includes(t)));let t={},s=[this.error];this.error.id=0;let n=1;for(let e of this.terms)e.id<0&&e.nodeType&&!e.repeated&&(e.id=n++,s.push(e));let i=n;for(let e of this.terms)e.repeated&&(e.id=n++,s.push(e));for(let e of(this.eof.id=n++,this.terms))e.id<0&&(e.id=n++),e.name&&(t[e.id]=e.name);if(n>=65534)throw new U("Too many terms");return{nodeTypes:s,names:t,minRepeatTerm:i,maxTerm:n-1}}}function W(e,t,s){if(e.length!=t.length)return e.length-t.length;for(let n=0;n<e.length;n++){let i=s(e[n],t[n]);if(i)return i}return 0}let L=[];class Q{constructor(e,t=L,s=0){this.precedence=e,this.ambigGroups=t,this.cut=s}join(e){return this==Q.none||this==e?e:e==Q.none?this:new Q(Math.max(this.precedence,e.precedence),V(this.ambigGroups,e.ambigGroups),Math.max(this.cut,e.cut))}cmp(e){return this.precedence-e.precedence||W(this.ambigGroups,e.ambigGroups,(e,t)=>e<t?-1:e>t?1:0)||this.cut-e.cut}}function V(e,t){if(0==e.length||e==t)return t;if(0==t.length)return e;let s=e.slice();for(let n of t)e.includes(n)||s.push(n);return s.sort()}Q.none=new Q(0);let Y=0;class H{constructor(e,t,s,n){this.name=e,this.parts=t,this.conflicts=s,this.skip=n,this.id=Y++}cmp(e){return this.id-e.id}cmpNoName(e){return this.parts.length-e.parts.length||this.skip.hash-e.skip.hash||this.parts.reduce((t,s,n)=>t||s.cmp(e.parts[n]),0)||W(this.conflicts,e.conflicts,(e,t)=>e.cmp(t))}toString(){return this.name+" -> "+this.parts.join(" ")}get isRepeatWrap(){return this.name.repeated&&2==this.parts.length&&this.parts[0]==this.name}sameReduce(e){return this.name==e.name&&this.parts.length==e.parts.length&&this.isRepeatWrap==e.isRepeatWrap}}class K{constructor(e,t,s){this.from=e,this.to=t,this.target=s}toString(){return`-> ${this.target.id}[label=${JSON.stringify(this.from<0?"ε":X(this.from)+(this.to>this.from+1?"-"+X(this.to-1):""))}]`}}function X(e){return e>65535?"∞":10==e?"\\n":13==e?"\\r":e<32||e>=55296&&e<57343?"\\u{"+e.toString(16)+"}":String.fromCharCode(e)}let Z=1;class ee{constructor(e=[],t=Z++){this.accepting=e,this.id=t,this.edges=[]}edge(e,t,s){this.edges.push(new K(e,t,s))}nullEdge(e){this.edge(-1,-1,e)}compile(){let e=Object.create(null),t=0,s=function s(n){let i=e[en(n)]=new ee(n.reduce((e,t)=>V(e,t.accepting),[]),t++),r=[];for(let e of n)for(let t of e.edges)t.from>=0&&r.push(t);for(let t of function(e){let t=[],s=[];for(let s of e)t.includes(s.from)||t.push(s.from),t.includes(s.to)||t.push(s.to);t.sort((e,t)=>e-t);for(let n=1;n<t.length;n++){let i=t[n-1],r=t[n],l=[];for(let t of e)if(t.to>i&&t.from<r)for(let e of t.target.closure())l.includes(e)||l.push(e);l.length&&s.push(new ei(i,r,l))}let n=e.filter(e=>65535==e.from&&65535==e.to);if(n.length){let e=[];for(let t of n)for(let s of t.target.closure())e.includes(s)||e.push(s);e.length&&s.push(new ei(65535,65535,e))}return s}(r)){let n=t.targets.sort((e,t)=>e.id-t.id);i.edge(t.from,t.to,e[en(n)]||s(n))}return i}(this.closure().sort((e,t)=>e.id-t.id));return function(e,t){let s=Object.create(null),n=Object.create(null);for(let t of e){let e=en(t.accepting),i=n[e]||(n[e]=[]);i.push(t),s[t.id]=i}for(;;){let n=!1,i=Object.create(null);for(let t of e){if(i[t.id])continue;let e=s[t.id];if(1==e.length){i[e[0].id]=e;continue}let r=[];e:for(let t of e){for(let e of r)if(function(e,t,s){if(e.edges.length!=t.edges.length)return!1;for(let n=0;n<e.edges.length;n++){let i=e.edges[n],r=t.edges[n];if(i.from!=r.from||i.to!=r.to||s[i.target.id]!=s[r.target.id])return!1}return!0}(t,e[0],s)){e.push(t);continue e}r.push([t])}for(let e of(r.length>1&&(n=!0),r))for(let t of e)i[t.id]=e}if(!n)return function(e,t,s){for(let t of e)for(let e=0;e<t.edges.length;e++){let n=t.edges[e],i=s[n.target.id][0];i!=n.target&&(t.edges[e]=new K(n.from,n.to,i))}return s[t.id][0]}(e,t,s);s=i}}(Object.values(e),s)}closure(){let e=[],t=Object.create(null);return!function s(n){if(!t[n.id])for(let i of(t[n.id]=!0,(n.edges.some(e=>e.from>=0)||n.accepting.length>0&&!n.edges.some(e=>(function(e,t){if(e.length!=t.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!=t[s])return!1;return!0})(n.accepting,e.target.accepting)))&&e.push(n),n.edges))i.from<0&&s(i.target)}(this),e}findConflicts(e){let t=[],s=this.cycleTerms();function n(e,s,n,i,r){e.id<s.id&&([e,s]=[s,e],n=-n);let l=t.find(t=>t.a==e&&t.b==s);l?l.soft!=n&&(l.soft=0):t.push(new et(e,s,n,es(i),r&&es(r)))}return this.reachable((t,i)=>{if(0!=t.accepting.length){for(let e=0;e<t.accepting.length;e++)for(let s=e+1;s<t.accepting.length;s++)n(t.accepting[e],t.accepting[s],0,i);t.reachable((r,l)=>{if(r!=t)for(let a of r.accepting){let r=s.includes(a);for(let o of t.accepting)a!=o&&n(a,o,r||s.includes(o)||!e(a,o)?0:1,i,i.concat(l))}})}}),t}cycleTerms(){let e=[];this.reachable(t=>{for(let{target:s}of t.edges)e.push(t,s)});let t=new Map,s=[];for(let n=0;n<e.length;){let i=e[n++],r=e[n++],l=t.get(i);if(l||t.set(i,l=[]),!l.includes(r)){if(i==r)s.includes(i)||s.push(i);else{for(let t of l)e.push(i,t);l.push(r)}}}let n=[];for(let e of s)for(let t of e.accepting)n.includes(t)||n.push(t);return n}reachable(e){let t=[],s=[];!function n(i){for(let r of(e(i,s),t.push(i),i.edges))t.includes(r.target)||(s.push(r),n(r.target),s.pop())}(this)}toString(){let e="digraph {\n";return this.reachable(t=>{for(let s of(t.accepting.length&&(e+=`  ${t.id} [label=${JSON.stringify(t.accepting.join())}];
`),t.edges))e+=`  ${t.id} ${s};
`}),e+"}"}toArray(e,t){let s=[],n=[];this.reachable(i=>{let r=n.length,l=r+3+2*i.accepting.length;for(let a of(s[i.id]=r,n.push(i.stateMask(e),l,i.edges.length),i.accepting.sort((e,s)=>t.indexOf(e.id)-t.indexOf(s.id)),i.accepting))n.push(a.id,e[a.id]||65535);for(let e of i.edges)n.push(e.from,e.to,-e.target.id-1)});for(let e=0;e<n.length;e++)n[e]<0&&(n[e]=s[-n[e]-1]);if(n.length>65536)throw new U("Tokenizer tables too big to represent with 16-bit offsets.");return Uint16Array.from(n)}stateMask(e){let t=0;return this.reachable(s=>{for(let n of s.accepting)t|=e[n.id]||65535}),t}}class et{constructor(e,t,s,n,i){this.a=e,this.b=t,this.soft=s,this.exampleA=n,this.exampleB=i}}function es(e){let t="";for(let s=0;s<e.length;s++)t+=String.fromCharCode(e[s].from);return t}function en(e){let t="";for(let s of e)t.length&&(t+="-"),t+=s.id;return t}class ei{constructor(e,t,s){this.from=e,this.to=t,this.targets=s}}let er=/[\w_-]+/gy;try{er=/[\p{Alphabetic}\d_-]+/ugy}catch(e){}let el=[];class ea{constructor(e,t=null){this.string=e,this.fileName=t,this.type="sof",this.value=null,this.start=0,this.end=0,this.next()}lineInfo(e){for(let t=1,s=0;;){let n=this.string.indexOf("\n",s);if(!(n>-1)||!(n<e))return{line:t,ch:e-s};++t,s=n+1}}message(e,t=-1){let s=this.fileName||"";if(t>-1){let e=this.lineInfo(t);s+=(s?" ":"")+e.line+":"+e.ch}return s?e+` (${s})`:e}raise(e,t=-1){throw new U(this.message(e,t))}match(e,t){let s=t.exec(this.string.slice(e));return s?e+s[0].length:-1}next(){let e=this.match(this.end,/^(\s|\/\/.*|\/\*[^]*?\*\/)*/);if(e==this.string.length)return this.set("eof",null,e,e);let t=this.string[e];if('"'==t){let t=this.match(e+1,/^(\\.|[^"\\])*"/);return -1==t&&this.raise("Unterminated string literal",e),this.set("string",ew(this.string.slice(e+1,t-1)),e,t)}if("'"==t){let t=this.match(e+1,/^(\\.|[^'\\])*'/);return -1==t&&this.raise("Unterminated string literal",e),this.set("string",ew(this.string.slice(e+1,t-1)),e,t)}if("@"==t){er.lastIndex=e+1;let t=er.exec(this.string);return t?this.set("at",t[0],e,e+1+t[0].length):this.raise("@ without a name",e)}if(("$"==t||"!"==t)&&"["==this.string[e+1]){let t=this.match(e+2,/^(?:\\.|[^\]\\])*\]/);return -1==t&&this.raise("Unterminated character set",e),this.set("set",this.string.slice(e+2,t-1),e,t)}{if(/[\[\]()!~+*?{}<>\.,|:$=]/.test(t))return this.set(t,null,e,e+1);er.lastIndex=e;let s=er.exec(this.string);return s?this.set("id",s[0],e,e+s[0].length):this.raise("Unexpected character "+JSON.stringify(t),e)}}set(e,t,s,n){this.type=e,this.value=t,this.start=s,this.end=n}eat(e,t=null){return this.type==e&&(null==t||this.value===t)&&(this.next(),!0)}unexpected(){return this.raise(`Unexpected token '${this.string.slice(this.start,this.end)}'`,this.start)}expect(e,t=null){let s=this.value;return this.type==e&&(null==t||s===t)||this.unexpected(),this.next(),s}parse(){return function(e){let t=e.start,s=[],n=null,i=null,r=[],l=null,o=[],u=[],k=null,w=[],y=[],v=[],S=[],O=[],R=!1,j=!1;for(;"eof"!=e.type;){let t=e.start;if(e.eat("at","top"))"id"!=e.type&&e.raise("Top rules must have a name",e.start),O.push(eo(e,eg(e))),R=!0;else if("at"==e.type&&"tokens"==e.value)i?e.raise("Multiple @tokens declaractions",e.start):i=function(e){let t=e.start;e.next(),e.expect("{");let s=[],n=[],i=[],r=[];for(;!e.eat("}");)"at"==e.type&&"precedence"==e.value?i.push(ek(e)):"at"==e.type&&"conflict"==e.value?r.push(function(e){let t=e.start;e.next(),e.expect("{");let s=ec(e);s instanceof N||s instanceof $||e.raise("Invalid expression in token conflict",s.start),e.eat(",");let n=ec(e);return n instanceof N||n instanceof $||e.raise("Invalid expression in token conflict",n.start),e.expect("}"),new c(t,s,n)}(e)):"string"==e.type?n.push(new d(e.start,e.expect("string"),eh(e))):s.push(eo(e));return new f(t,i,r,s,n)}(e);else if(e.eat("at","local"))e.expect("id","tokens"),r.push(function(e,t){e.expect("{");let s=[],n=[],i=null;for(;!e.eat("}");)"at"==e.type&&"precedence"==e.value?n.push(ek(e)):e.eat("at","else")&&!i?i={id:eg(e),props:eh(e)}:s.push(eo(e));return new p(t,n,s,i)}(e,t));else if(e.eat("at","context")){k&&e.raise("Multiple @context declarations",t);let s=eg(e);e.expect("id","from");let n=e.expect("string");k=new m(t,s,n)}else if(e.eat("at","external"))e.eat("id","tokens")?w.push(function(e,t){let s=eg(e);e.expect("id","from");let n=e.expect("string");return new g(t,s,n,ex(e))}(e,t)):e.eat("id","prop")?v.push(function(e,t){let s=eg(e),n=e.eat("id","as")?eg(e):s;e.expect("id","from");let i=e.expect("string");return new b(t,n,s,i)}(e,t)):e.eat("id","extend")?y.push(eb(e,"extend",t)):e.eat("id","specialize")?y.push(eb(e,"specialize",t)):e.eat("id","propSource")?S.push(function(e,t){let s=eg(e);return e.expect("id","from"),new x(t,s,e.expect("string"))}(e,t)):e.unexpected();else if(e.eat("at","dialects")){e.expect("{");for(let t=!0;!e.eat("}");t=!1)t||e.eat(","),u.push(eg(e))}else if("at"==e.type&&"precedence"==e.value)n&&e.raise("Multiple precedence declarations",e.start),n=function(e){let t=e.start;e.next(),e.expect("{");let s=[];for(;!e.eat("}");)s.length&&e.eat(","),s.push({id:eg(e),type:e.eat("at","left")?"left":e.eat("at","right")?"right":e.eat("at","cut")?"cut":null});return new h(t,s)}(e);else if(e.eat("at","detectDelim"))j=!0;else if(e.eat("at","skip")){let t=eu(e);if("{"==e.type){e.next();let s=[],n=[];for(;!e.eat("}");)e.eat("at","top")?(n.push(eo(e,eg(e))),R=!0):s.push(eo(e));o.push({expr:t,topRules:n,rules:s})}else l&&e.raise("Multiple top-level skip declarations",e.start),l=t}else s.push(eo(e))}return R?new a(t,s,O,i,r,k,w,y,S,n,l,o,u,v,j):e.raise("Missing @top declaration")}(this)}}function eo(e,t){let s=t?t.start:e.start,n=t||eg(e),i=eh(e),r=[];if(e.eat("<"))for(;!e.eat(">");)r.length&&e.expect(","),r.push(eg(e));let l=eu(e);return new o(s,n,i,r,l)}function eh(e){if("["!=e.type)return el;let t=[];for(e.expect("[");!e.eat("]");)t.length&&e.expect(","),t.push(function(e){let t=e.start,s=[],n=e.value,i="at"==e.type;if(e.eat("at")||e.eat("id")||e.unexpected(),e.eat("="))for(;;)if("string"==e.type||"id"==e.type)s.push(new E(e.start,e.value,null)),e.next();else if(e.eat("."))s.push(new E(e.start,".",null));else if(e.eat("{"))s.push(new E(e.start,null,e.expect("id"))),e.expect("}");else break;return new G(t,i,n,s)}(e));return t}function eu(e){e.expect("{");let t=em(e);return e.expect("}"),t}function ec(e){let t=e.start;if(e.eat("(")){if(e.eat(")"))return new R(t,el,[el,el]);let s=em(e);return e.expect(")"),s}if("string"==e.type){let s=e.value;return(e.next(),0==s.length)?new R(t,el,[el,el]):new N(t,s)}if(e.eat("id","_"))return new A(t);if("set"==e.type){let s=e.value,n="!"==e.string[e.start],i=ew(s.replace(/\\.|-|"/g,e=>"-"==e?"﷚":'"'==e?'\\"':e)),r=[];for(let t=0;t<i.length;){let s=i.codePointAt(t);if((t+=s>65535?2:1)<i.length-1&&"﷚"==i[t]){let n=i.codePointAt(t+1);t+=n>65535?3:2,n<s&&e.raise("Invalid character range",e.start),ef(e,r,s,n+1)}else 64986==s&&(s=45),ef(e,r,s,s+1)}return e.next(),new P(t,r.sort((e,t)=>e[0]-t[0]),n)}if("at"==e.type&&("specialize"==e.value||"extend"==e.value)){let{start:t,value:s}=e;e.next();let n=eh(e);e.expect("<");let i=em(e),r;return e.eat(",")?r=em(e):i instanceof N?r=i:e.raise(`@${s} requires two arguments when its first argument isn't a literal string`),e.expect(">"),new v(t,s,n,i,r)}if("at"==e.type&&I.hasOwnProperty(e.value)){let t=new q(e.start,e.value);return e.next(),t}if("["==e.type){let s=eo(e,new w(t,"_anon"));return s.params.length&&e.raise("Inline rules can't have parameters",s.start),new S(t,s)}else{let s=eg(e);if("["==e.type||"{"==e.type){let n=eo(e,s);return n.params.length&&e.raise("Inline rules can't have parameters",n.start),new S(t,n)}if(e.eat(".")&&"std"==s.name&&I.hasOwnProperty(e.value)){let s=new q(t,e.value);return e.next(),s}return new $(t,s,function(e){let t=[];if(e.eat("<"))for(;!e.eat(">");)t.length&&e.expect(","),t.push(em(e));return t}(e))}}function ef(e,t,s,n){t.every(([e,t])=>t<=s||e>=n)||e.raise("Overlapping character range",e.start),t.push([s,n])}function ep(e){return"}"==e.type||")"==e.type||"|"==e.type||"/"==e.type||"/\\"==e.type||"{"==e.type||","==e.type||">"==e.type}function ed(e){let t=e.start,s=[],n=[el];do{for(;;){let t=e.start,s;if(e.eat("~"))s="ambig";else if(e.eat("!"))s="prec";else break;n[n.length-1]=n[n.length-1].concat(new j(t,eg(e),s))}if(ep(e))break;s.push(function(e){let t=e.start,s=ec(e);for(;;){let n=e.type;if(!(e.eat("*")||e.eat("?")||e.eat("+")))return s;s=new T(t,s,n)}}(e)),n.push(el)}while(!ep(e));return 1==s.length&&n.every(e=>0==e.length)?s[0]:new R(t,s,n,!s.length)}function em(e){let t=e.start,s=ed(e);if(!e.eat("|"))return s;let n=[s];do n.push(ed(e));while(e.eat("|"));let i=n.find(e=>e instanceof R&&e.empty);return i&&e.raise("Empty expression in choice operator. If this is intentional, use () to make it explicit.",i.start),new O(t,n)}function eg(e){"id"!=e.type&&e.unexpected();let t=e.start,s=e.value;return e.next(),new w(t,s)}function ek(e){let t=e.start;e.next(),e.expect("{");let s=[];for(;!e.eat("}");){s.length&&e.eat(",");let t=ec(e);t instanceof N||t instanceof $?s.push(t):e.raise("Invalid expression in token precedences",t.start)}return new u(t,s)}function ex(e){let t=[];for(e.expect("{");!e.eat("}");){t.length&&e.eat(",");let s=eg(e),n=eh(e);t.push({id:s,props:n})}return t}function eb(e,t,s){let n=eu(e),i=eg(e);e.expect("id","from");let r=e.expect("string");return new k(s,t,n,i,r,ex(e))}function ew(e){let t=/\\(?:u\{([\da-f]+)\}|u([\da-f]{4})|x([\da-f]{2})|([ntbrf0])|(.))|[^]/yig,s="",n;for(;n=t.exec(e);){let[e,t,i,r,l,a]=n;t||i||r?s+=String.fromCodePoint(parseInt(t||i||r,16)):l?s+="n"==l?"\n":"t"==l?"	":"0"==l?"\x00":"r"==l?"\r":"f"==l?"\f":"\b":a?s+=a:s+=e}return s}function ey(e,t){return(e<<5)+e+t}let e$=void 0!==r&&r.env.LOG||"",ev=/\btime\b/.test(e$),eS=ev?(e,t)=>{let s=Date.now(),n=t();return console.log(`${e} (${((Date.now()-s)/1e3).toFixed(2)}s)`),n}:(e,t)=>t();class eO{constructor(e,t,s,n,i,r){this.rule=e,this.pos=t,this.ahead=s,this.ambigAhead=n,this.skipAhead=i,this.via=r,this.hash=0}finish(){let e=ey(ey(this.rule.id,this.pos),this.skipAhead.hash);for(let t of this.ahead)e=ey(e,t.hash);for(let t of this.ambigAhead)e=function(e,t){for(let s=0;s<t.length;s++)e=ey(e,t.charCodeAt(s));return e}(e,t);return this.hash=e,this}get next(){return this.pos<this.rule.parts.length?this.rule.parts[this.pos]:null}advance(){return new eO(this.rule,this.pos+1,this.ahead,this.ambigAhead,this.skipAhead,this.via).finish()}get skip(){return this.pos==this.rule.parts.length?this.skipAhead:this.rule.skip}cmp(e){return this.rule.cmp(e.rule)||this.pos-e.pos||this.skipAhead.hash-e.skipAhead.hash||W(this.ahead,e.ahead,(e,t)=>e.cmp(t))||W(this.ambigAhead,e.ambigAhead,ej)}eqSimple(e){return e.rule==this.rule&&e.pos==this.pos}toString(){let e=this.rule.parts.map(e=>e.name);return e.splice(this.pos,0,"\xb7"),`${this.rule.name} -> ${e.join(" ")}`}eq(e){return this==e||this.hash==e.hash&&this.rule==e.rule&&this.pos==e.pos&&this.skipAhead==e.skipAhead&&eP(this.ahead,e.ahead)&&eP(this.ambigAhead,e.ambigAhead)}trail(e=60){let t=[];for(let e=this;e;e=e.via)for(let s=e.pos-1;s>=0;s--)t.push(e.rule.parts[s]);let s=t.reverse().join(" ");return s.length>e&&(s=s.slice(s.length-e).replace(/.*? /,"… ")),s}conflicts(e=this.pos){let t=this.rule.conflicts[e];return e==this.rule.parts.length&&this.ambigAhead.length&&(t=t.join(new Q(0,this.ambigAhead))),t}static addOrigins(e,t){let s=e.slice();for(let e=0;e<s.length;e++){let n=s[e];if(0==n.pos)for(let e of t)e.next!=n.rule.name||s.includes(e)||s.push(e)}return s}}function eR(e){let t=Q.none;for(let s of e)t=t.join(s.conflicts());return t}function ej(e,t){return e<t?-1:e>t?1:0}function eT(e,t,s,n){let i=[];for(let s=t+1;s<e.parts.length;s++){let t=e.parts[s],r=!1;if(t.terminal)eC(t,i);else for(let e of n[t.name])null==e?r=!0:eC(e,i);if(!r)return i}for(let e of s)eC(e,i);return i}function eN(e,t){if(e.length!=t.length)return!1;for(let s=0;s<e.length;s++)if(!e[s].eq(t[s]))return!1;return!0}function eP(e,t){if(e.length!=t.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!=t[s])return!1;return!0}class eA{constructor(e,t){this.term=e,this.target=t}eq(e){return e instanceof eA&&this.term==e.term&&e.target.id==this.target.id}cmp(e){return e instanceof ez?-1:this.term.id-e.term.id||this.target.id-e.target.id}toString(){return"s"+this.target.id}map(e,t){let s=t[e[this.target.id]];return s==this.target?this:new eA(this.term,s)}}class ez{constructor(e,t){this.term=e,this.rule=t}eq(e){return e instanceof ez&&this.term==e.term&&e.rule.sameReduce(this.rule)}cmp(e){return e instanceof eA?1:this.term.id-e.term.id||this.rule.name.id-e.rule.name.id||this.rule.parts.length-e.rule.parts.length}toString(){return`${this.rule.name.name}(${this.rule.parts.length})`}map(){return this}}function eI(e){let t=5381;for(let s of e)t=ey(t,s.hash);return t}class eq{constructor(e,t,s=0,n,i=eI(t),r=null){this.id=e,this.set=t,this.flags=s,this.skip=n,this.hash=i,this.startRule=r,this.actions=[],this.actionPositions=[],this.goto=[],this.tokenGroup=-1,this.defaultReduce=null}toString(){let e=this.actions.map(e=>e.term+"="+e).join(",")+(this.goto.length?" | "+this.goto.map(e=>e.term+"="+e).join(","):"");return this.id+": "+this.set.filter(e=>e.pos>0).join()+(this.defaultReduce?`
  always ${this.defaultReduce.name}(${this.defaultReduce.parts.length})`:e.length?"\n  "+e:"")}addActionInner(e,t){t:for(let s=0;s<this.actions.length;s++){let n=this.actions[s];if(n.term==e.term){if(n.eq(e))return null;let i=eO.addOrigins(t,this.set),r=eO.addOrigins(this.actionPositions[s],this.set),l=eR(i),a=eR(r),o=function(e,t){for(let s of e)if(s.rule.name.repeated){for(let e of t)if(e.rule.name==s.rule.name){if(s.rule.isRepeatWrap&&2==s.pos)return 1;if(e.rule.isRepeatWrap&&2==e.pos)return -1}}return 0}(i,r)||l.precedence-a.precedence;if(o>0){this.actions.splice(s,1),this.actionPositions.splice(s,1),s--;continue t}if(o<0)return null;if(!l.ambigGroups.some(e=>a.ambigGroups.includes(e)))return n;continue t}}return this.actions.push(e),this.actionPositions.push(t),null}addAction(e,t,s){let n=this.addActionInner(e,t);if(n){let i,r=this.actionPositions[this.actions.indexOf(n)][0],l=[t[0].rule.name,r.rule.name];if(s.some(e=>e.rules.some(e=>l.includes(e))))return;i=(n instanceof eA?`shift/reduce conflict between
  ${r}
and
  ${t[0].rule}`:`reduce/reduce conflict between
  ${r.rule}
and
  ${t[0].rule}`)+`
With input:
  ${t[0].trail(70)} \xb7 ${e.term} …`+function(e,t){if(e.eqSimple(t))return"";function s(e,t){let s=[];for(let n=t.via;!n.eqSimple(e);n=n.via)s.push(n);return s.length?(s.unshift(t),s.reverse().map((e,s)=>"\n"+"  ".repeat(s+1)+(e==t?"":"via ")+e).join("")):""}for(let n=e;n;n=n.via)for(let i=t;i;i=i.via)if(n.eqSimple(i))return"\nShared origin: "+n+s(n,e)+s(n,t);return""}(r,t[0]),s.push(new eG(i,l))}}getGoto(e){return this.goto.find(t=>t.term==e)}hasSet(e){return eN(this.set,e)}finish(){if(this.actions.length){let e=this.actions[0];if(e instanceof ez){let{rule:t}=e;this.actions.every(e=>e instanceof ez&&e.rule.sameReduce(t))&&(this.defaultReduce=t)}}this.actions.sort((e,t)=>e.cmp(t)),this.goto.sort((e,t)=>e.cmp(t))}eq(e){let t=this.defaultReduce,s=e.defaultReduce;return t||s?!!t&&!!s&&t.sameReduce(s):this.skip==e.skip&&this.tokenGroup==e.tokenGroup&&eN(this.actions,e.actions)&&eN(this.goto,e.goto)}}function eC(e,t){t.includes(e)||t.push(e)}class eD{constructor(e,t){this.set=e,this.state=t}}class eG{constructor(e,t){this.error=e,this.rules=t}}function eE(e,t,s){for(let n of e.goto)for(let e of t.goto)if(n.term==e.term&&s[n.target.id]!=s[e.target.id])return!1;s:for(let n of e.actions){let e=!1;for(let i of t.actions)if(i.term==n.term){if(n instanceof eA?i instanceof eA&&s[n.target.id]==s[i.target.id]:i.eq(n))continue s;e=!0}if(e)return!1}return!0}function eJ(e,t,s){return eE(e,t,s)&&eE(t,e,s)}class eU{constructor(e,t){this.origin=e,this.members=[t]}}let e_=[];function eM(e,t=65535){if(e>t)throw Error("Trying to encode a number that's too big: "+e);if(65535==e)return"~";let s="";for(let t=46;;t=0){let n=e%46,i=e-n;if(s=function(e){let t=e+32;return t>=34&&t++,t>=92&&t++,String.fromCharCode(t)}(n+t)+s,0==i)break;e=i/46}return s}function eB(e,t=65535){let s='"'+eM(e.length,4294967295);for(let n=0;n<e.length;n++)s+=eM(e[n],t);return s+'"'}let eF=[];class eW{constructor(e,t){this.terms=e,this.conflicts=t}concat(e){if(this==eW.none)return e;if(e==eW.none)return this;let t=null;if(this.conflicts||e.conflicts){t=this.conflicts?this.conflicts.slice():this.ensureConflicts();let s=e.ensureConflicts();t[t.length-1]=t[t.length-1].join(s[0]);for(let e=1;e<s.length;e++)t.push(s[e])}return new eW(this.terms.concat(e.terms),t)}withConflicts(e,t){if(t==Q.none)return this;let s=this.conflicts?this.conflicts.slice():this.ensureConflicts();return s[e]=s[e].join(t),new eW(this.terms,s)}ensureConflicts(){if(this.conflicts)return this.conflicts;let e=[];for(let t=0;t<=this.terms.length;t++)e.push(Q.none);return e}}function eL(...e){return new eW(e,null)}eW.none=new eW(eF,null);class eQ{constructor(e,t,s){this.id=e,this.args=t,this.term=s}matches(e){return this.id==e.id.name&&D(e.args,this.args)}matchesRepeat(e){return"+"==this.id&&C(e.expr,this.args[0])}}class eV{constructor(e,t){this.options=t,this.terms=new F,this.specialized=Object.create(null),this.tokenOrigins=Object.create(null),this.rules=[],this.built=[],this.ruleNames=Object.create(null),this.namespaces=Object.create(null),this.namedTerms=Object.create(null),this.termTable=Object.create(null),this.knownProps=Object.create(null),this.dynamicRulePrecedences=[],this.definedGroups=[],this.astRules=[],this.currentSkip=[],eS("Parse",()=>{this.input=new ea(e,t.fileName),this.ast=this.input.parse()});let s=n.md;for(let e in s)s[e]instanceof n.md&&!s[e].perNode&&(this.knownProps[e]={prop:s[e],source:{name:e,from:null}});for(let e of this.ast.externalProps)this.knownProps[e.id.name]={prop:this.options.externalProp?this.options.externalProp(e.id.name):new n.md,source:{name:e.externalID.name,from:e.source}};for(let e in this.dialects=this.ast.dialects.map(e=>e.name),this.tokens=new e6(this,this.ast.tokens),this.localTokens=this.ast.localTokens.map(e=>new e2(this,e)),this.externalTokens=this.ast.externalTokens.map(e=>new tt(this,e)),this.externalSpecializers=this.ast.externalSpecializers.map(e=>new ts(this,e)),eS("Build rules",()=>{let e=this.newName("%noskip",!0);this.defineRule(e,[]);let t=this.ast.mainSkip?this.newName("%mainskip",!0):e,s=[],n=[];for(let e of this.ast.rules)this.astRules.push({skip:t,rule:e});for(let e of this.ast.topRules)n.push({skip:t,rule:e});for(let i of this.ast.scopedSkip){let r=e,l=this.ast.scopedSkip.findIndex((e,t)=>t<s.length&&C(e.expr,i.expr));for(let e of(l>-1?r=s[l]:this.ast.mainSkip&&C(i.expr,this.ast.mainSkip)?r=t:e9(i.expr)||(r=this.newName("%skip",!0)),s.push(r),i.rules))this.astRules.push({skip:r,rule:e});for(let e of i.topRules)n.push({skip:r,rule:e})}for(let{rule:e}of this.astRules)this.unique(e.id);this.currentSkip.push(e),this.skipRules=t==e?[t]:[e,t],t!=e&&this.defineRule(t,this.normalizeExpr(this.ast.mainSkip));for(let t=0;t<this.ast.scopedSkip.length;t++){let n=s[t];this.skipRules.includes(n)||(this.skipRules.push(n),n!=e&&this.defineRule(n,this.normalizeExpr(this.ast.scopedSkip[t].expr)))}for(let{rule:e,skip:t}of(this.currentSkip.pop(),n.sort((e,t)=>e.rule.start-t.rule.start))){this.unique(e.id),this.used(e.id.name),this.currentSkip.push(t);let{name:s,props:n}=this.nodeInfo(e.props,"a",e.id.name,eF,eF,e.expr),i=this.terms.makeTop(s,n);this.namedTerms[s]=i,this.defineRule(i,this.normalizeExpr(e.expr)),this.currentSkip.pop()}for(let e of this.externalSpecializers)e.finish();for(let{skip:e,rule:t}of this.astRules){var i;this.ruleNames[t.id.name]&&t.props.some(e=>e.at&&"export"==e.name)&&!t.params.length&&(this.buildRule(t,[],e,!1),t.expr instanceof R&&0==t.expr.exprs.length&&this.used(t.id.name))}}),this.ruleNames){let t=this.ruleNames[e];t&&this.warn(`Unused rule '${t.name}'`,t.start)}for(let{name:e,group:t,rule:s}of(this.tokens.takePrecedences(),this.tokens.takeConflicts(),this.definedGroups))this.defineGroup(e,t,s);this.checkGroups()}unique(e){e.name in this.ruleNames&&this.raise(`Duplicate definition of rule '${e.name}'`,e.start),this.ruleNames[e.name]=e}used(e){this.ruleNames[e]=null}newName(e,t=null,s={}){for(let n=t?0:1;;n++){let i=n?`${e}-${n}`:e;if(!this.terms.names[i])return this.terms.makeNonTerminal(i,!0===t?null:t,s)}}prepareParser(){let e=eS("Simplify rules",()=>(function(e){let t=Object.create(null),s;for(let n=0;n<e.length;){let i=n,r=e[n++].name;for(;n<e.length&&e[n].name==r;)n++;let l=n-i;if(!r.interesting)for(let a=n;a<e.length;){let n=a,o=e[a++].name;for(;a<e.length&&e[a].name==o;)a++;if(a-n!=l||o.interesting)continue;let h=!0;for(let t=0;t<l&&h;t++){let s=e[i+t],r=e[n+t];0!=s.cmpNoName(r)&&(h=!1)}h&&(s=t[r.name]=o)}}if(!s)return e;let n=[];for(let s of e)t[s.name.name]||n.push(s.parts.every(e=>!t[e.name])?s:new H(s.name,s.parts.map(e=>t[e.name]||e),s.conflicts,s.skip));return n})(function(e,t){for(let s=0;;s++){let n=Object.create(null),i;if(0==s){for(let t of e)if(t.name.inline&&!n[t.name.name]){let s=e.filter(e=>e.name==t.name);if(s.some(e=>e.parts.includes(t.name)))continue;i=n[t.name.name]=s}}for(let s=0;s<e.length;s++){let r=e[s];!(!r.name.interesting&&!r.parts.includes(r.name)&&r.parts.length<3&&!t.includes(r.name)&&(1==r.parts.length||e.every(e=>e.skip==r.skip||!e.parts.includes(r.name))))||r.parts.some(e=>!!n[e.name])||e.some((e,t)=>t!=s&&e.name==r.name)||(i=n[r.name.name]=[r])}if(!i)return e;let r=[];for(let t of e)if(!n[t.name.name]){if(!t.parts.some(e=>!!n[e.name])){r.push(t);continue}!function e(s,i,l){if(s==t.parts.length){r.push(new H(t.name,l,i,t.skip));return}let a=t.parts[s],o=n[a.name];if(!o){e(s+1,i.concat(t.conflicts[s+1]),l.concat(a));return}for(let n of o)e(s+1,i.slice(0,i.length-1).concat(i[s].join(n.conflicts[0])).concat(n.conflicts.slice(1,n.conflicts.length-1)).concat(t.conflicts[s+1].join(n.conflicts[n.conflicts.length-1])),l.concat(n.parts))}(0,[t.conflicts[0]],[])}e=r}}(this.rules,[...this.skipRules,...this.terms.tops]))),{nodeTypes:t,names:s,minRepeatTerm:n,maxTerm:i}=this.terms.finish(e);for(let e in this.namedTerms)this.termTable[e]=this.namedTerms[e].id;/\bgrammar\b/.test(e$)&&console.log(e.join("\n"));let r=this.terms.tops.slice(),l=function(e){let t=Object.create(null);for(let s of e.terms)s.terminal||(t[s.name]=[]);for(;;){let s=!1;for(let n of e.terms)if(!n.terminal)for(let e of n.rules){let i=t[n.name],r=!1,l=i.length;for(let s of e.parts){if(r=!0,s.terminal)eC(s,i);else for(let e of t[s.name])null==e?r=!1:eC(e,i);if(r)break}r||eC(null,i),i.length>l&&(s=!0)}if(!s)return t}}(this.terms),a=this.skipRules.map((e,t)=>{let s=[],n=[],i=[];for(let t of e.rules){if(!t.parts.length)continue;let e=t.parts[0];for(let t of e.terminal?[e]:l[e.name]||[])n.includes(t)||n.push(t);e.terminal&&1==t.parts.length&&!i.some(s=>s!=t&&s.parts[0]==e)?s.push(e):i.push(t)}return e.rules=i,i.length&&r.push(e),{skip:s,rule:i.length?e:null,startTokens:n,id:t}}),o=eS("Build full automaton",()=>(function(e,t,s){let n=[],i={},r=Date.now();function l(e,t){let l;if(0==e.length)return null;let a=eI(e),o=i[a];for(let t of e)if(l){if(l!=t.skip)throw new U("Inconsistent skip sets after "+t.trail())}else l=t.skip;if(o){for(let t of o)if(eN(e,t.set)){if(t.state.skip!=l)throw new U("Inconsistent skip sets after "+t.set[0].trail());return t.state}}let h=function(e,t){let s=[],n=[];function i(t,i,r,l,a){for(let o of t.rules){let t=s.find(e=>e.rule==o);if(!t){let n=e.find(e=>0==e.pos&&e.rule==o);t=n?new eO(o,0,n.ahead.slice(),n.ambigAhead,n.skipAhead,n.via):new eO(o,0,[],e_,l,a),s.push(t)}if(t.skipAhead!=l)throw new U("Inconsistent skip sets after "+a.trail());for(let e of(t.ambigAhead=V(t.ambigAhead,r),i))t.ahead.includes(e)||(t.ahead.push(e),t.rule.parts.length&&!t.rule.parts[0].terminal&&eC(t,n))}}for(let s of e){let e=s.next;e&&!e.terminal&&i(e,eT(s.rule,s.pos,s.ahead,t),s.conflicts(s.pos+1).ambigGroups,s.pos==s.rule.parts.length-1?s.skipAhead:s.rule.skip,s)}for(;n.length;){let e=n.pop();i(e.rule.parts[0],eT(e.rule,0,e.ahead,t),V(e.rule.conflicts[1].ambigGroups,1==e.rule.parts.length?e.ambigAhead:e_),1==e.rule.parts.length?e.skipAhead:e.rule.skip,e)}let r=e.slice();for(let t of s){t.ahead.sort((e,t)=>e.hash-t.hash),t.finish();let s=e.findIndex(e=>0==e.pos&&e.rule==t.rule);s>-1?r[s]=t:r.push(t)}return r.sort((e,t)=>e.cmp(t))}(e,s),u=eI(h),c;if(!t)for(let e of n)e.hash==u&&e.hasSet(h)&&(c=e);return!c&&(c=new eq(n.length,h,0,l,u,t),n.push(c),ev&&n.length%500==0&&console.log(`${n.length} states after ${((Date.now()-r)/1e3).toFixed(2)}s`)),(i[a]||(i[a]=[])).push(new eD(e,c)),c}for(let s of t){let t=s.rules.length?s.rules[0].skip:e.names["%noskip"];l(s.rules.map(s=>new eO(s,0,[e.eof],e_,t,null).finish()),s)}let a=[];for(let e=0;e<n.length;e++){let t=n[e],i=[],r=[],o=[];for(let e of t.set)if(e.pos==e.rule.parts.length)e.rule.name.top||o.push(e);else{let t=e.rule.parts[e.pos],s=i.indexOf(t);s<0?(i.push(t),r.push([e])):r[s].push(e)}for(let e=0;e<i.length;e++){let s=i[e],n=r[e].map(e=>e.advance());if(s.terminal){let i=l(function(e){let t=null,s=1;for(let n of e){let e=n.rule.conflicts[n.pos-1].cut;e<s||((!t||e>s)&&(s=e,t=[]),t.push(n))}return t||e}(n));i&&t.addAction(new eA(s,i),r[e],a)}else{let e=l(n);e&&t.goto.push(new eA(s,e))}}let h=!1;for(let e of o)for(let s of e.ahead){let n=t.actions.length;t.addAction(new ez(s,e.rule),[e],a),t.actions.length==n&&(h=!0)}if(h)for(let e=0;e<t.goto.length;e++)s[t.goto[e].term.name].some(e=>t.actions.some(t=>t.term==e&&t instanceof eA))||t.goto.splice(e--,1)}if(a.length)throw new U(a.map(e=>e.error).join("\n\n"));for(let e of n)e.finish();return ev&&console.log(`${n.length} states total.`),n})(this.terms,r,l)),h=this.localTokens.map((e,t)=>e.buildLocalGroup(o,a,t)),{tokenGroups:u,tokenPrec:c,tokenData:f}=eS("Build token groups",()=>this.tokens.buildTokenGroups(o,a,h.length)),p=eS("Finish automaton",()=>(function(e){for(let t=1;;t++){let s=[],n=!1,i=Date.now(),r=[];for(let t=0;t<e.length;t++){let i=e[t],l=r.findIndex(e=>i.eq(e));if(l<0)s[t]=r.length,r.push(i);else{s[t]=l,n=!0;let e=r[l],a=null;for(let t of i.set)e.set.some(e=>e.eqSimple(t))||(a||(a=[])).push(t);a&&(e.set=a.concat(e.set).sort((e,t)=>e.cmp(t)))}}if(ev&&console.log(`Merge identical pass ${t}${n?"":", done"} (${((Date.now()-i)/1e3).toFixed(2)}s)`),!n)return e;for(let e of r)e.defaultReduce||(e.actions=e.actions.map(e=>e.map(s,r)),e.goto=e.goto.map(e=>e.map(s,r)));for(let e=0;e<r.length;e++)r[e].id=e;e=r}})(function(e){let t=[],s=[];n:for(let n=0;n<e.length;n++){let i=e[n];if(!i.startRule)for(let r=0;r<s.length;r++){let l=s[r],a=e[l.members[0]];if(i.tokenGroup==a.tokenGroup&&i.skip==a.skip&&!a.startRule&&function(e,t){if(e.length!=t.length)return!1;for(let s=0;s<e.length;s++)if(!e[s].eqSimple(t[s]))return!1;return!0}(i.set,a.set)){l.members.push(n),t.push(r);continue n}}t.push(s.length),s.push(new eU(s.length,n))}for(let n=1;;n++){let i=!1,r=Date.now();for(let n=0,r=s.length;n<r;n++){let r=s[n];for(let l=0;l<r.members.length-1;l++)for(let a=l+1;a<r.members.length;a++){let o=r.members[l],h=r.members[a];eJ(e[o],e[h],t)||(i=!0,function(n,i){let r=s[n],l=e[r.members[i]],a=r.members.pop();i!=r.members.length&&(r.members[i]=a);for(let i=n+1;i<s.length;i++)if(t[l.id]=i,s[i].origin==r.origin&&s[i].members.every(s=>eJ(l,e[s],t))){s[i].members.push(l.id);return}t[l.id]=s.length,s.push(new eU(r.origin,l.id))}(n,a--))}}if(ev&&console.log(`Collapse pass ${n}${i?"":", done"} (${((Date.now()-r)/1e3).toFixed(2)}s)`),!i)return function(e,t){let s=[];for(let n of e){let e=t[n.id];s[e]||(s[e]=new eq(e,n.set,0,n.skip,n.hash,n.startRule),s[e].tokenGroup=n.tokenGroup,s[e].defaultReduce=n.defaultReduce)}for(let n of e){let e=s[t[n.id]];e.flags|=n.flags;for(let i=0;i<n.actions.length;i++){let r=n.actions[i].map(t,s);e.actions.some(e=>e.eq(r))||(e.actions.push(r),e.actionPositions.push(n.actionPositions[i]))}for(let i of n.goto){let n=i.map(t,s);e.goto.some(e=>e.eq(n))||e.goto.push(n)}}return s}(e,t)}}(o))),d=function(e,t){let s=Object.create(null),n=[],i=e=>{s[e.id]||(s[e.id]=!0,n.push(e))};for(let s of e)s.startRule&&t.includes(s.startRule)&&i(s);for(let e=0;e<n.length;e++){for(let t of n[e].actions)t instanceof eA&&i(t.target);for(let t of n[e].goto)i(t.target)}return e=>!s[e]}(p,this.terms.tops);/\blr\b/.test(e$)&&console.log(p.join("\n"));let m=[];for(let e of this.externalSpecializers)m.push(e);for(let e in this.specialized)m.push({token:this.terms.names[e],table:function(e){let t=Object.create(null);for(let{value:s,term:n,type:i}of e){let e="specialize"==i?0:1;t[s]=n.id<<1|e}return t}(this.specialized[e])});let g=e=>e instanceof tt?e.ast.start:this.tokens.ast?this.tokens.ast.start:-1,k=u.concat(this.externalTokens).sort((e,t)=>g(e)-g(t)).concat(h),x=new eX,b=a.map(e=>{let t=[];for(let s of e.skip)t.push(s.id,0,4);if(e.rule){let s=p.find(t=>t.startRule==e.rule);for(let e of s.actions)t.push(e.term.id,s.id,2)}return t.push(65535,0),x.storeArray(t)}),w=eS("Finish states",()=>{let e=new Uint32Array(6*p.length),t=this.computeForceReductions(p,a),s=new eY(k,x,e,b,a,p,this);for(let e of p)s.finish(e,d(e.id),t[e.id]);return e}),y=Object.create(null);for(let e=0;e<this.dialects.length;e++)y[this.dialects[e]]=x.storeArray((this.tokens.byDialect[e]||eF).map(e=>e.id).concat(65535));let $=null;if(this.dynamicRulePrecedences.length)for(let{rule:e,prec:t}of($=Object.create(null),this.dynamicRulePrecedences))$[e.id]=t;let v=Object.create(null);for(let e of this.terms.tops)v[e.nodeName]=[p.find(t=>t.startRule==e).id,e.id];let S=x.storeArray(c.concat(65535)),{nodeProps:O,skippedTypes:R}=this.gatherNodeProps(t);return{states:w,stateData:x.finish(),goto:function(e){let t={},s=0;for(let n of e)for(let e of n.goto){s=Math.max(e.term.id,s);let i=t[e.term.id]||(t[e.term.id]={});(i[e.target.id]||(i[e.target.id]=[])).push(n.id)}let n=new eX,i=[],r=s+2;for(let e=0;e<=s;e++){let s=t[e];if(!s){i.push(1);continue}let l=[],a=Object.keys(s);for(let e of a){let t=s[e];for(let s of(l.push((e==a[a.length-1]?1:0)+(t.length<<1)),l.push(+e),t))l.push(s)}i.push(n.storeArray(l)+r)}if(i.some(e=>e>65535))throw new U("Goto table too large");return Uint16Array.from([s+1,...i,...n.data])}(p),nodeNames:t.filter(e=>e.id<n).map(e=>e.nodeName).join(" "),nodeProps:O,skippedTypes:R,maxTerm:i,repeatNodeCount:t.length-n,tokenizers:k,tokenData:f,topRules:v,dialects:y,dynamicPrecedences:$,specialized:m,tokenPrec:S,termNames:s}}getParser(){let{states:e,stateData:t,goto:s,nodeNames:n,nodeProps:r,skippedTypes:l,maxTerm:a,repeatNodeCount:o,tokenizers:h,tokenData:u,topRules:c,dialects:f,dynamicPrecedences:p,specialized:d,tokenPrec:m,termNames:g}=this.prepareParser(),k=d.map(e=>{if(!(e instanceof ts))return{term:e.token.id,get:t=>e.table[t]||-1};{let t=this.options.externalSpecializer(e.ast.id.name,this.termTable);return{term:e.term.id,get:(s,n)=>t(s,n)<<1|("extend"==e.ast.type?1:0),external:t,extend:"extend"==e.ast.type}}});return i.WQ.deserialize({version:14,states:e,stateData:t,goto:s,nodeNames:n,maxTerm:a,repeatNodeCount:o,nodeProps:r.map(({prop:e,terms:t})=>[this.knownProps[e].prop,...t]),propSources:this.options.externalPropSource?this.ast.externalPropSources.map(e=>this.options.externalPropSource(e.id.name)):void 0,skippedNodes:l,tokenData:u,tokenizers:h.map(e=>e.create()),context:this.ast.context?this.options.contextTracker:void 0,topRules:c,dialects:f,dynamicPrecedences:p,specialized:k,tokenPrec:m,termNames:g})}getParserFile(){let{states:e,stateData:t,goto:s,nodeNames:n,nodeProps:i,skippedTypes:r,maxTerm:l,repeatNodeCount:a,tokenizers:o,tokenData:h,topRules:u,dialects:c,dynamicPrecedences:f,specialized:p,tokenPrec:d,termNames:m}=this.prepareParser(),g=this.options.moduleStyle||"es",k="// This file was generated by lezer-generator. You probably shouldn't edit it.\n",x=k,b={},w=Object.create(null),y=Object.create(null);for(let e of ti)y[e]=!0;let $=this.options.exportName||"parser";y[$]=!0;let v=e=>{for(let t=0;;t++){let s=e+(t?"_"+t:"");if(!y[s])return s}},S=(e,t,s=e)=>{let n=e+" from "+t;if(w[n])return w[n];let i=JSON.stringify(t),r=e;return e in y&&(e+=`${"cjs"==g?":":" as"} ${r=v(s)}`),y[r]=!0,(b[i]||(b[i]=[])).push(e),w[n]=r},O=S("LRParser","@lezer/lr"),R=o.map(e=>e.createSource(S)),j=this.ast.context?S(this.ast.context.id.name,this.ast.context.source):null,T=i.map(({prop:e,terms:t})=>{let{source:s}=this.knownProps[e];return`[${s.from?S(s.name,s.from):JSON.stringify(s.name)}, ${t.map(z).join(",")}]`}),N="",P=p.map(e=>{if(e instanceof ts){let t=S(e.ast.id.name,e.ast.source);return`{term: ${e.term.id}, get: (value, stack) => (${t}(value, stack) << 1)${"extend"==e.ast.type?" | 1":""}, external: ${t}${"extend"==e.ast.type?", extend: true":""}}`}{var t;let s=v("spec_"+e.token.name.replace(/\W/g,""));return y[s]=!0,N+=`const ${s} = ${"{__proto__:null,"+Object.keys(t=e.table).map(e=>`${/\W/.test(e)?JSON.stringify(e):e}:${t[e]}`).join(", ")+"}"}
`,`{term: ${e.token.id}, get: value => ${s}[value] || -1}`}}),A=this.ast.externalPropSources.map(e=>S(e.id.name,e.source));for(let e in b)"cjs"==g?x+=`const {${b[e].join(", ")}} = require(${e})
`:x+=`import {${b[e].join(", ")}} from ${e}
`;function z(e){return"string"!=typeof e||/^(true|false|\d+(\.\d+)?|\.\d+)$/.test(e)?e:JSON.stringify(e)}x+=N;let I=Object.keys(c).map(e=>`${e}: ${c[e]}`),q=`${O}.deserialize({
  version: 14,
  states: ${eB(e,4294967295)},
  stateData: ${eB(t)},
  goto: ${eB(s)},
  nodeNames: ${JSON.stringify(n)},
  maxTerm: ${l}${j?`,
  context: ${j}`:""}${T.length?`,
  nodeProps: [
    ${T.join(",\n    ")}
  ]`:""}${A.length?`,
  propSources: [${A.join()}]`:""}${r.length?`,
  skippedNodes: ${JSON.stringify(r)}`:""},
  repeatNodeCount: ${a},
  tokenData: ${eB(h)},
  tokenizers: [${R.join(", ")}],
  topRules: ${JSON.stringify(u)}${I.length?`,
  dialects: {${I.join(", ")}}`:""}${f?`,
  dynamicPrecedences: ${JSON.stringify(f)}`:""}${P.length?`,
  specialized: [${P.join(",")}]`:""},
  tokenPrec: ${d}${this.options.includeNames?`,
  termNames: ${JSON.stringify(m)}`:""}
})`,C=[];for(let e in this.termTable){let t=e;if(ti.includes(t))for(let s=1;((t="_".repeat(s)+e)in this.termTable);s++);C.push(`${t}${"cjs"==g?":":" ="} ${this.termTable[e]}`)}for(let e=0;e<this.dialects.length;e++)C.push(`Dialect_${this.dialects[e]}${"cjs"==g?":":" ="} ${e}`);return{parser:x+("cjs"==g?`exports.${$} = ${q}
`:`export const ${$} = ${q}
`),terms:"cjs"==g?`${k}module.exports = {
  ${C.join(",\n  ")}
}`:`${k}export const
  ${C.join(",\n  ")}
`}}gatherNonSkippedNodes(){let e=Object.create(null),t=[],s=s=>{e[s.id]||(e[s.id]=!0,t.push(s))};this.terms.tops.forEach(s);for(let e=0;e<t.length;e++)for(let n of t[e].rules)for(let e of n.parts)s(e);return e}gatherNodeProps(e){let t=this.gatherNonSkippedNodes(),s=[],n=[];for(let i of e)for(let e in t[i.id]||i.error||s.push(i.id),i.props){let t=this.knownProps[e];if(!t)throw new U("No known prop type for "+e);if(null==t.source.from&&("repeated"==t.source.name||"error"==t.source.name))continue;let s=n.find(t=>t.prop==e);s||n.push(s={prop:e,values:{}}),(s.values[i.props[e]]||(s.values[i.props[e]]=[])).push(i.id)}return{nodeProps:n.map(({prop:e,values:t})=>{let s=[];for(let e in t){let n=t[e];if(1==n.length)s.push(n[0],e);else{for(let e of(s.push(-n.length),n))s.push(e);s.push(e)}}return{prop:e,terms:s}}),skippedTypes:s}}makeTerminal(e,t,s){return this.terms.makeTerminal(this.terms.uniqueName(e),t,s)}computeForceReductions(e,t){let s=[],n=[],i=Object.create(null);for(let t of e){for(let e of(s.push(0),t.goto)){let s=i[e.term.id]||(i[e.term.id]=[]),n=s.find(t=>t.target==e.target.id);n?n.parents.push(t.id):s.push({parents:[t.id],target:e.target.id})}n[t.id]=t.set.filter(e=>e.pos>0&&!e.rule.name.top).sort((e,t)=>t.pos-e.pos||e.rule.parts.length-t.rule.parts.length)}let r=Object.create(null);for(let n of e)n.defaultReduce&&n.defaultReduce.parts.length>0&&(s[n.id]=eK(n.defaultReduce,t),1==n.defaultReduce.parts.length&&(r[n.id]=n.defaultReduce.name.id));for(let l=1;;l++){let a=!0;for(let o of e){if(o.defaultReduce)continue;let e=n[o.id];if(e.length!=l){e.length>l&&(a=!1);continue}for(let n of e)if(1!=n.pos||!function e(t,s,n=null){let l=i[t];return!!l&&l.some(t=>{let i=n?n.filter(e=>t.parents.includes(e)):t.parents;if(0==i.length)return!1;if(t.target==s)return!0;let l=r[t.target];return null!=l&&e(l,s,i)})}(n.rule.name.id,o.id)){s[o.id]=eK(n.rule,t,n.pos),1==n.pos&&(r[o.id]=n.rule.name.id);break}}if(a)break}return s}substituteArgs(e,t,s){return 0==t.length?e:e.walk(e=>{let n;if(e instanceof $&&(n=s.findIndex(t=>t.name==e.id.name))>-1){let s=t[n];if(e.args.length){if(s instanceof $&&!s.args.length)return new $(e.start,s.id,e.args);this.raise("Passing arguments to a parameter that already has arguments",e.start)}return s}if(e instanceof S){let n=e.rule,i=this.substituteArgsInProps(n.props,t,s);return i==n.props?e:new S(e.start,new o(n.start,n.id,i,n.params,n.expr))}if(e instanceof v){let n=this.substituteArgsInProps(e.props,t,s);return n==e.props?e:new v(e.start,e.type,n,e.token,e.content)}return e})}substituteArgsInProps(e,t,s){let n=e=>{let n=e;for(let i=0;i<e.length;i++){let r=e[i];if(!r.name)continue;let l=s.findIndex(e=>e.name==r.name);if(l<0)continue;n==e&&(n=e.slice());let a=t[l];a instanceof $&&!a.args.length?n[i]=new E(r.start,a.id.name,null):a instanceof N?n[i]=new E(r.start,a.value,null):this.raise(`Trying to interpolate expression '${a}' into a prop`,r.start)}return n},i=e;for(let t=0;t<e.length;t++){let s=e[t],r=n(s.value);r!=s.value&&(i==e&&(i=e.slice()),i[t]=new G(s.start,s.at,s.name,r))}return i}conflictsFor(e){let t=Q.none,s=Q.none;for(let n of e)if("ambig"==n.type)t=t.join(new Q(0,[n.id.name]));else{let e=this.ast.precedences,i=e?e.items.findIndex(e=>e.id.name==n.id.name):-1;i<0&&this.raise(`Reference to unknown precedence: '${n.id.name}'`,n.id.start);let r=e.items[i],l=e.items.length-i;"cut"==r.type?t=t.join(new Q(0,eF,l)):(t=t.join(new Q(l<<2)),s=s.join(new Q((l<<2)+("left"==r.type?1:"right"==r.type?-1:0))))}return{here:t,atEnd:s}}raise(e,t=1){return this.input.raise(e,t)}warn(e,t=-1){let s=this.input.message(e,t);this.options.warn?this.options.warn(s):console.warn(s)}defineRule(e,t){let s=this.currentSkip[this.currentSkip.length-1];for(let n of t)this.rules.push(new H(e,n.terms,n.ensureConflicts(),s))}resolve(e){for(let t of this.built)if(t.matches(e))return[eL(t.term)];let t=this.tokens.getToken(e);if(t)return[eL(t)];for(let t of this.localTokens){let s=t.getToken(e);if(s)return[eL(s)]}for(let t of this.externalTokens){let s=t.getToken(e);if(s)return[eL(s)]}for(let t of this.externalSpecializers){let s=t.getToken(e);if(s)return[eL(s)]}let s=this.astRules.find(t=>t.rule.id.name==e.id.name);return s?(s.rule.params.length!=e.args.length&&this.raise(`Wrong number or arguments for '${e.id.name}'`,e.start),this.used(s.rule.id.name),[eL(this.buildRule(s.rule,e.args,s.skip))]):this.raise(`Reference to undefined rule '${e.id.name}'`,e.start)}normalizeRepeat(e){let t=this.built.find(t=>t.matchesRepeat(e));if(t)return eL(t.term);let s=e.expr.prec<e.prec?`(${e.expr})+`:`${e.expr}+`,n=this.terms.makeRepeat(this.terms.uniqueName(s));return this.built.push(new eQ("+",[e.expr],n)),this.defineRule(n,this.normalizeExpr(e.expr).concat(eL(n,n))),eL(n)}normalizeSequence(e){let t=e.exprs.map(e=>this.normalizeExpr(e)),s=this;return function n(i,r,l){let{here:a,atEnd:o}=s.conflictsFor(e.markers[r]);if(r==t.length)return[i.withConflicts(i.terms.length,a.join(l))];let h=[];for(let e of t[r])for(let t of n(i.concat(e).withConflicts(i.terms.length,a),r+1,l.join(o)))h.push(t);return h}(eW.none,0,Q.none)}normalizeExpr(e){if(e instanceof T&&"?"==e.kind)return[eW.none,...this.normalizeExpr(e.expr)];if(e instanceof T){let t=this.normalizeRepeat(e);return"+"==e.kind?[t]:[eW.none,t]}if(e instanceof O)return e.exprs.reduce((e,t)=>e.concat(this.normalizeExpr(t)),[]);if(e instanceof R)return this.normalizeSequence(e);if(e instanceof N)return[eL(this.tokens.getLiteral(e))];if(e instanceof $)return this.resolve(e);if(e instanceof v)return[eL(this.resolveSpecialization(e))];else if(e instanceof S)return[eL(this.buildRule(e.rule,eF,this.currentSkip[this.currentSkip.length-1],!0))];else return this.raise(`This type of expression ('${e}') may not occur in non-token rules`,e.start)}buildRule(e,t,s,n=!1){let i=this.substituteArgs(e.expr,t,e.params),{name:r,props:l,dynamicPrec:a,inline:o,group:h,exported:u}=this.nodeInfo(e.props||eF,n?"pg":"pgi",e.id.name,t,e.params,e.expr);u&&e.params.length&&this.warn("Can't export parameterized rules",e.start),u&&n&&this.warn("Can't export inline rule",e.start);let c=this.newName(e.id.name+(t.length?"<"+t.join(",")+">":""),r||!0,l);return o&&(c.inline=!0),a&&this.registerDynamicPrec(c,a),(c.nodeType||u)&&0==e.params.length&&(r||(c.preserve=!0),n||(this.namedTerms[u||e.id.name]=c)),n||this.built.push(new eQ(e.id.name,t,c)),this.currentSkip.push(s),this.defineRule(c,this.normalizeExpr(i)),this.currentSkip.pop(),h&&this.definedGroups.push({name:c,group:h,rule:e}),c}nodeInfo(e,t,s=null,n=eF,i=eF,r,l){let a;let o={},h=s&&(t.indexOf("a")>-1||!("_"==(a=s[0])||a.toUpperCase()!=a))&&!/ /.test(s)?s:null,u=null,c=0,f=!1,p=null,d=null;for(let r of e)if(r.at){if("name"==r.name)h=this.finishProp(r,n,i),/ /.test(h)&&this.raise(`Node names cannot have spaces ('${h}')`,r.start);else if("dialect"==r.name){0>t.indexOf("d")&&this.raise("Can't specify a dialect on non-token rules",e[0].start),1==r.value.length||r.value[0].value||this.raise("The '@dialect' rule prop must hold a plain string value");let s=this.dialects.indexOf(r.value[0].value);s<0&&this.raise(`Unknown dialect '${r.value[0].value}'`,r.value[0].start),u=s}else"dynamicPrecedence"==r.name?(0>t.indexOf("p")&&this.raise("Dynamic precedence can only be specified on nonterminals"),1==r.value.length&&/^-?(?:10|\d)$/.test(r.value[0].value)||this.raise("The '@dynamicPrecedence' rule prop must hold an integer between -10 and 10"),c=+r.value[0].value):"inline"==r.name?(r.value.length&&this.raise("'@inline' doesn't take a value",r.value[0].start),0>t.indexOf("i")&&this.raise("Inline can only be specified on nonterminals"),f=!0):"isGroup"==r.name?(0>t.indexOf("g")&&this.raise("'@isGroup' can only be specified on nonterminals"),p=r.value.length?this.finishProp(r,n,i):s):"export"==r.name?d=r.value.length?this.finishProp(r,n,i):s:this.raise(`Unknown built-in prop name '@${r.name}'`,r.start)}else{if(!this.knownProps[r.name]){let e=["name","dialect","dynamicPrecedence","export","isGroup"].includes(r.name)?` (did you mean '@${r.name}'?)`:"";this.raise(`Unknown prop name '${r.name}'${e}`,r.start)}o[r.name]=this.finishProp(r,n,i)}if(r&&this.ast.autoDelim&&(h||_(o))){let e=this.findDelimiters(r);e&&(eH(e[0],"closedBy",e[1].nodeName),eH(e[1],"openedBy",e[0].nodeName))}if(l&&_(l))for(let e in l)e in o||(o[e]=l[e]);return _(o)&&!h&&this.raise("Node has properties but no name",e.length?e[0].start:r.start),f&&(_(o)||u||c)&&this.raise("Inline nodes can't have props, dynamic precedence, or a dialect",e[0].start),f&&h&&(h=null),{name:h,props:o,dialect:u,dynamicPrec:c,inline:f,group:p,exported:d}}finishProp(e,t,s){return e.value.map(e=>{if(e.value)return e.value;let n=s.findIndex(t=>t.name==e.name);n<0&&this.raise(`Property refers to '${e.name}', but no parameter by that name is in scope`,e.start);let i=t[n];return i instanceof $&&!i.args.length?i.id.name:i instanceof N?i.value:this.raise(`Expression '${i}' can not be used as part of a property value`,e.start)}).join("")}resolveSpecialization(e){let t,s=e.type,{name:n,props:i,dialect:r}=this.nodeInfo(e.props,"d"),l=this.normalizeExpr(e.token);if(1==l.length&&1==l[0].terms.length&&l[0].terms[0].terminal||this.raise(`The first argument to '${s}' must resolve to a token`,e.token.start),e.content instanceof N)t=[e.content.value];else{if(!(e.content instanceof O&&e.content.exprs.every(e=>e instanceof N)))return this.raise(`The second argument to '${e.type}' must be a literal or choice of literals`,e.content.start);t=e.content.exprs.map(e=>e.value)}let a=l[0].terms[0],o=null,h=this.specialized[a.name]||(this.specialized[a.name]=[]);for(let l of t){let t=h.find(e=>e.value==l);null==t?(o||(o=this.makeTerminal(a.name+"/"+JSON.stringify(l),n,i),null!=r&&(this.tokens.byDialect[r]||(this.tokens.byDialect[r]=[])).push(o)),h.push({value:l,term:o,type:s,dialect:r,name:n}),this.tokenOrigins[o.name]={spec:a}):(t.type!=s&&this.raise(`Conflicting specialization types for ${JSON.stringify(l)} of ${a.name} (${s} vs ${t.type})`,e.start),t.dialect!=r&&this.raise(`Conflicting dialects for specialization ${JSON.stringify(l)} of ${a.name}`,e.start),t.name!=n&&this.raise(`Conflicting names for specialization ${JSON.stringify(l)} of ${a.name}`,e.start),o&&t.term!=o&&this.raise(`Conflicting specialization tokens for ${JSON.stringify(l)} of ${a.name}`,e.start),o=t.term)}return o}findDelimiters(e){if(!(e instanceof R)||e.exprs.length<2)return null;let t=e=>{if(e instanceof N)return{term:this.tokens.getLiteral(e),str:e.value};if(e instanceof $&&0==e.args.length){let s=this.ast.rules.find(t=>t.id.name==e.id.name);if(s)return t(s.expr);let n=this.tokens.rules.find(t=>t.id.name==e.id.name);if(n&&n.expr instanceof N)return{term:this.tokens.getToken(e),str:n.expr.value}}return null},s=t(e.exprs[e.exprs.length-1]);if(!s||!s.term.nodeName)return null;let n=["()","[]","{}","<>"].find(e=>s.str.indexOf(e[1])>-1&&0>s.str.indexOf(e[0]));if(!n)return null;let i=t(e.exprs[0]);return!i||!i.term.nodeName||0>i.str.indexOf(n[0])||i.str.indexOf(n[1])>-1?null:[i.term,s.term]}registerDynamicPrec(e,t){this.dynamicRulePrecedences.push({rule:e,prec:t}),e.preserve=!0}defineGroup(e,t,s){var n;let i=[],r=e=>{if(e.nodeName)return[e];i.includes(e)&&this.raise(`Rule '${s.id.name}' cannot define a group because it contains a non-named recursive rule ('${e.name}')`,s.start);let t=[];for(let n of(i.push(e),this.rules))if(n.name==e){let e=n.parts.map(r).filter(e=>e.length);if(e.length>1&&this.raise(`Rule '${s.id.name}' cannot define a group because some choices produce multiple named nodes`,s.start),1==e.length)for(let s of e[0])t.push(s)}return i.pop(),t};for(let s of r(e))s.props.group=((null===(n=s.props.group)||void 0===n?void 0:n.split(" "))||[]).concat(t).sort().join(" ")}checkGroups(){let e=Object.create(null),t=Object.create(null);for(let s of this.terms.terms)if(s.nodeName&&(t[s.nodeName]=!0,s.props.group))for(let t of s.props.group.split(" "))(e[t]||(e[t]=[])).push(s);let s=Object.keys(e);for(let n=0;n<s.length;n++){let i=s[n],r=e[i];t[i]&&this.warn(`Group name '${i}' conflicts with a node of the same name`);for(let t=n+1;t<s.length;t++){let n=e[s[t]];r.some(e=>n.includes(e))&&(r.length>n.length?n.some(e=>!r.includes(e)):r.some(e=>!n.includes(e)))&&this.warn(`Groups '${i}' and '${s[t]}' overlap without one being a superset of the other`)}}}}class eY{constructor(e,t,s,n,i,r,l){this.tokenizers=e,this.data=t,this.stateArray=s,this.skipData=n,this.skipInfo=i,this.states=r,this.builder=l,this.sharedActions=[]}findSharedActions(e){if(e.actions.length<5)return null;let t=null;for(let s of this.sharedActions)(!t||s.actions.length>t.actions.length)&&s.actions.every(t=>e.actions.some(e=>e.eq(t)))&&(t=s);if(t)return t;let s=null,n=[];for(let t=e.id+1;t<this.states.length;t++){let i=this.states[t],r=0;if(!i.defaultReduce&&!(i.actions.length<5)){for(let t of e.actions)for(let e of i.actions)t.eq(e)&&(n[r++]=t);r>=5&&(!s||s.length<r)&&(s=n,n=[])}}if(!s)return null;let i={actions:s,addr:this.storeActions(s,-1,null)};return this.sharedActions.push(i),i}storeActions(e,t,s){if(t<0&&s&&s.actions.length==e.length)return s.addr;let n=[];for(let i of e)if(!(s&&s.actions.some(e=>e.eq(i)))){if(i instanceof eA)n.push(i.term.id,i.target.id,0);else{let e=eK(i.rule,this.skipInfo);e!=t&&n.push(i.term.id,65535&e,e>>16)}}return n.push(65535),t>-1?n.push(2,65535&t,t>>16):s?n.push(1,65535&s.addr,s.addr>>16):n.push(0),this.data.storeArray(n)}finish(e,t,s){let n=this.builder,i=n.skipRules.indexOf(e.skip),r=this.skipData[i],l=this.skipInfo[i].startTokens,a=e.defaultReduce?eK(e.defaultReduce,this.skipInfo):0,o=t?1:0,h=-1,u=null;if(0==a){if(t)for(let t of e.actions)t instanceof ez&&t.term.eof&&(h=eK(t.rule,this.skipInfo));h<0&&(u=this.findSharedActions(e))}e.set.some(e=>e.rule.name.top&&e.pos==e.rule.parts.length)&&(o|=2);let c=[];for(let t=0;t<e.actions.length+l.length;t++){let s=t<e.actions.length?e.actions[t].term:l[t-e.actions.length];for(;;){let e=n.tokenOrigins[s.name];if(e&&e.spec){s=e.spec;continue}e&&e.external instanceof tt&&e0(c,e.external);break}}let f=0;for(let t=0;t<this.tokenizers.length;t++){let s=this.tokenizers[t];(c.includes(s)||s.groupID==e.tokenGroup)&&(f|=1<<t)}let p=6*e.id;this.stateArray[p+0]=o,this.stateArray[p+1]=this.storeActions(a?eF:e.actions,h,u),this.stateArray[p+2]=r,this.stateArray[p+3]=f,this.stateArray[p+4]=a,this.stateArray[p+5]=s}}function eH(e,t,s){let n=e.props[t];(!n||0>n.split(" ").indexOf(s))&&(e.props[t]=n?n+" "+s:s)}function eK(e,t,s=e.parts.length){return 65536|e.name.id|(e.isRepeatWrap&&s==e.parts.length?131072:0)|(t.some(t=>t.rule==e.name)?262144:0)|s<<19}class eX{constructor(){this.data=[]}storeArray(e){let t=function(e,t){i:for(let s=0;;){let n=e.indexOf(t[0],s);if(-1==n||n+t.length>e.length)break;for(let i=1;i<t.length;i++)if(t[i]!=e[n+i]){s=n+1;continue i}return n}return -1}(this.data,e);if(t>-1)return t;let s=this.data.length;for(let t of e)this.data.push(t);return s}finish(){return Uint16Array.from(this.data)}}class eZ{constructor(e,t){this.tokens=e,this.groupID=t}create(){return this.groupID}createSource(){return String(this.groupID)}}function e0(e,t){e.includes(t)||e.push(t)}class e1{constructor(e,t,s){this.name=e,this.expr=t,this.scope=s}}class e5{constructor(e,t,s,n){this.name=e,this.start=t,this.to=s,this.args=n}}class e3{constructor(e,t){for(let s of(this.b=e,this.ast=t,this.startState=new ee,this.built=[],this.building=[],this.byDialect=Object.create(null),this.precedenceRelations=[],this.rules=t?t.rules:eF,this.rules))e.unique(s.id)}getToken(e){for(let t of this.built)if(t.matches(e))return t.term;let t=e.id.name,s=this.rules.find(e=>e.id.name==t);if(!s)return null;let{name:n,props:i,dialect:r,exported:l}=this.b.nodeInfo(s.props,"d",t,e.args,s.params.length!=e.args.length?eF:s.params),a=this.b.makeTerminal(e.toString(),n,i);return null!=r&&(this.byDialect[r]||(this.byDialect[r]=[])).push(a),(a.nodeType||l)&&0==s.params.length&&(a.nodeType||(a.preserve=!0),this.b.namedTerms[l||t]=a),this.buildRule(s,e,this.startState,new ee([a])),this.built.push(new eQ(t,e.args,a)),a}buildRule(e,t,s,n,i=eF){let r=t.id.name;e.params.length!=t.args.length&&this.b.raise(`Incorrect number of arguments for token '${r}'`,t.start);let l=this.building.find(e=>e.name==r&&D(t.args,e.args));if(l){if(l.to==n){s.nullEdge(l.start);return}let e=this.building.length-1;for(;this.building[e].name!=r;)e--;this.b.raise(`Invalid (non-tail) recursion in token rules: ${this.building.slice(e).map(e=>e.name).join(" -> ")}`,t.start)}this.b.used(e.id.name);let a=new ee;s.nullEdge(a),this.building.push(new e5(r,a,n,t.args)),this.build(this.b.substituteArgs(e.expr,t.args,e.params),a,n,t.args.map((t,s)=>new e1(e.params[s].name,t,i))),this.building.pop()}build(e,t,s,n){if(e instanceof $){let i,r=e.id.name,l=n.find(e=>e.name==r);if(l)return this.build(l.expr,t,s,l.scope);for(let e=0,t=this.b.localTokens;e<=t.length;e++)i=(e==t.length?this.b.tokens:t[e]).rules.find(e=>e.id.name==r);if(!i)return this.b.raise(`Reference to token rule '${e.id.name}', which isn't found`,e.start);this.buildRule(i,e,t,s,n)}else if(e instanceof q)for(let[n,i]of I[e.type])t.edge(n,i,s);else if(e instanceof O)for(let i of e.exprs)this.build(i,t,s,n);else if(e9(e))t.nullEdge(s);else if(e instanceof R){let i=e.markers.find(e=>e.length>0);i&&this.b.raise("Conflict marker in token expression",i[0].start);for(let i=0;i<e.exprs.length;i++){let r=i==e.exprs.length-1?s:new ee;this.build(e.exprs[i],t,r,n),t=r}}else if(e instanceof T){if("*"==e.kind){let i=new ee;t.nullEdge(i),this.build(e.expr,i,i,n),i.nullEdge(s)}else if("+"==e.kind){let i=new ee;this.build(e.expr,t,i,n),this.build(e.expr,i,i,n),i.nullEdge(s)}else t.nullEdge(s),this.build(e.expr,t,s,n)}else if(e instanceof P)for(let[n,i]of e.inverted?function(e){let t=0,s=[];for(let[n,i]of e)n>t&&s.push([t,n]),t=i;return t<=e4&&s.push([t,e4+1]),s}(e.ranges):e.ranges)!function(e,t,s,n){if(s<65536&&(s<55296&&e.edge(s,Math.min(n,55296),t),n>57344&&e.edge(Math.max(s,57344),Math.min(n,65536),t),s=65536),n<=65536)return;let i=String.fromCodePoint(s),r=String.fromCodePoint(n-1),l=i.charCodeAt(0),a=i.charCodeAt(1),o=r.charCodeAt(0),h=r.charCodeAt(1);if(l==o){let s=new ee;e.edge(l,l+1,s),s.edge(a,h+1,t)}else{let s=l,n=o;if(a>56320){s++;let n=new ee;e.edge(l,l+1,n),n.edge(a,57344,t)}if(h<57343){n--;let s=new ee;e.edge(o,o+1,s),s.edge(56320,h+1,t)}if(s<=n){let i=new ee;e.edge(s,n+1,i),i.edge(56320,57344,t)}}}(t,s,n,i);else if(e instanceof N)for(let n=0;n<e.value.length;n++){let i=e.value.charCodeAt(n),r=n==e.value.length-1?s:new ee;t.edge(i,i+1,r),t=r}else{if(!(e instanceof A))return this.b.raise("Unrecognized expression type in token",e.start);let n=new ee;t.edge(0,56320,s),t.edge(56320,65536,s),t.edge(55296,56320,n),n.edge(56320,57344,s)}}takePrecedences(){let e=this.precedenceRelations=[];if(this.ast)for(let t of this.ast.precedences){let s=[];for(let n of t.items){let t=[];if(n instanceof $)for(let e of this.built)(n.args.length?e.matches(n):e.id==n.id.name)&&t.push(e.term);else{let e=JSON.stringify(n.value),s=this.built.find(t=>t.id==e);s&&t.push(s.term)}for(let i of(t.length||this.b.warn(`Precedence specified for unknown token ${n}`,n.start),t))te(e,i,s);s=s.concat(t)}}}precededBy(e,t){let s=this.precedenceRelations.find(t=>t.term==e);return s&&s.after.includes(t)}buildPrecTable(e){let t=[],s=this.precedenceRelations.slice();for(let{a:t,b:n,soft:i}of e)if(i){if(!s.some(e=>e.term==t)||!s.some(e=>e.term==n))continue;i<0&&([t,n]=[n,t]),te(s,n,[t]),te(s,t,[])}r:for(;s.length;){for(let e=0;e<s.length;e++){let n=s[e];if(n.after.every(e=>t.includes(e.id))){if(t.push(n.term.id),1==s.length)break r;s[e]=s.pop();continue r}}this.b.raise(`Cyclic token precedence relation between ${s.map(e=>e.term).join(", ")}`)}return t}}class e6 extends e3{constructor(){super(...arguments),this.explicitConflicts=[]}getLiteral(e){let t=JSON.stringify(e.value);for(let e of this.built)if(e.id==t)return e.term;let s=null,n={},i=null,r=null,l=this.ast?this.ast.literals.find(t=>t.literal==e.value):null;l&&({name:s,props:n,dialect:i,exported:r}=this.b.nodeInfo(l.props,"da",e.value));let a=this.b.makeTerminal(t,s,n);return null!=i&&(this.byDialect[i]||(this.byDialect[i]=[])).push(a),r&&(this.b.namedTerms[r]=a),this.build(e,this.startState,new ee([a]),eF),this.built.push(new eQ(t,eF,a)),a}takeConflicts(){var e;let t=e=>{if(e instanceof $){for(let t of this.built)if(t.matches(e))return t.term}else{let t=JSON.stringify(e.value),s=this.built.find(e=>e.id==t);if(s)return s.term}return this.b.warn(`Precedence specified for unknown token ${e}`,e.start),null};for(let s of(null===(e=this.ast)||void 0===e?void 0:e.conflicts)||[]){let e=t(s.a),n=t(s.b);e&&n&&(e.id<n.id&&([e,n]=[n,e]),this.explicitConflicts.push({a:e,b:n}))}}buildTokenGroups(e,t,s){let n=this.startState.compile();n.accepting.length&&this.b.raise(`Grammar contains zero-length tokens (in '${n.accepting[0].name}')`,this.rules.find(e=>e.id.name==n.accepting[0].name).start),/\btokens\b/.test(e$)&&console.log(n.toString());let i=n.findConflicts(function(e,t,s){let n=Object.create(null);function i(e,n){return e.actions.some(e=>e.term==n)||s[t.skipRules.indexOf(e.skip)].startTokens.includes(n)}return(t,s)=>{t.id<s.id&&([t,s]=[s,t]);let r=t.id|s.id<<16,l=n[r];return null!=l?l:n[r]=e.some(e=>i(e,t)&&i(e,s))}}(e,this.b,t)).filter(({a:e,b:t})=>!this.precededBy(e,t)&&!this.precededBy(t,e));for(let{a:e,b:t}of this.explicitConflicts)i.some(s=>s.a==e&&s.b==t)||i.push(new et(e,t,0,"",""));let r=i.filter(e=>e.soft),l=i.filter(e=>!e.soft),a=[],o=[];for(let n of e){if(n.defaultReduce||n.tokenGroup>-1)continue;let e=[],i=[],r=t[this.b.skipRules.indexOf(n.skip)].startTokens;for(let e of r)n.actions.some(t=>t.term==e)&&this.b.raise(`Use of token ${e.name} conflicts with skip rule`);let h=[];for(let e=0;e<n.actions.length+(r?r.length:0);e++){let t=e<n.actions.length?n.actions[e].term:r[e-n.actions.length],s=this.b.tokenOrigins[t.name];if(s&&s.spec)t=s.spec;else if(s&&s.external)continue;e0(h,t)}if(0==h.length)continue;for(let t of h)for(let s of l){let r=s.a==t?s.b:s.b==t?s.a:null;if(r){if(h.includes(r)&&!a.some(e=>e.conflict==s)){let e=s.exampleA?` (example: ${JSON.stringify(s.exampleA)}${s.exampleB?` vs ${JSON.stringify(s.exampleB)}`:""})`:"";a.push({error:`Overlapping tokens ${t.name} and ${r.name} used in same context${e}
After: ${n.set[0].trail()}`,conflict:s})}e0(e,t),e0(i,r)}}let u=null;for(let t of o)if(!i.some(e=>t.tokens.includes(e))){for(let s of e)e0(t.tokens,s);u=t;break}u||(u=new eZ(e,o.length+s),o.push(u)),n.tokenGroup=u.groupID}a.length&&this.b.raise(a.map(e=>e.error).join("\n\n")),o.length+s>16&&this.b.raise(`Too many different token groups (${o.length}) to represent them as a 16-bit bitfield`);let h=this.buildPrecTable(r);return{tokenGroups:o,tokenPrec:h,tokenData:n.toArray(function(e){let t=Object.create(null);for(let s of e){let e=1<<s.groupID;for(let n of s.tokens)t[n.id]=(t[n.id]||0)|e}return t}(o),h)}}}class e2 extends e3{constructor(e,t){super(e,t),this.fallback=null,t.fallback&&e.unique(t.fallback.id)}getToken(e){let t=null;if(this.ast.fallback&&this.ast.fallback.id.name==e.id.name){if(e.args.length&&this.b.raise(`Incorrect number of arguments for ${e.id.name}`,e.start),!this.fallback){let{name:t,props:s,exported:n}=this.b.nodeInfo(this.ast.fallback.props,"",e.id.name,eF,eF),i=this.fallback=this.b.makeTerminal(e.id.name,t,s);(i.nodeType||n)&&(i.nodeType||(i.preserve=!0),this.b.namedTerms[n||e.id.name]=i),this.b.used(e.id.name)}t=this.fallback}else t=super.getToken(e);return t&&!this.b.tokenOrigins[t.name]&&(this.b.tokenOrigins[t.name]={group:this}),t}buildLocalGroup(e,t,s){let n=this.startState.compile();for(let{a:e,b:t,exampleA:s}of(n.accepting.length&&this.b.raise(`Grammar contains zero-length tokens (in '${n.accepting[0].name}')`,this.rules.find(e=>e.id.name==n.accepting[0].name).start),n.findConflicts(()=>!0)))this.precededBy(e,t)||this.precededBy(t,e)||this.b.raise(`Overlapping tokens ${e.name} and ${t.name} in local token group${s?` (example: ${JSON.stringify(s)})`:""}`);for(let n of e){if(n.defaultReduce)continue;let e=null,i=t[this.b.skipRules.indexOf(n.skip)].startTokens[0];for(let{term:t}of n.actions){let s=this.b.tokenOrigins[t.name];(null==s?void 0:s.group)==this?e=t:i=t}e&&(i&&this.b.raise(`Tokens from a local token group used together with other tokens (${e.name} with ${i.name})`),n.tokenGroup=s)}let r=this.buildPrecTable(eF),l=n.toArray({[s]:65535},r),a=l.length,o=new Uint16Array(l.length+r.length+1);return o.set(l,0),o.set(r,a),o[o.length-1]=65535,{groupID:s,create:()=>new i.RA(o,a,this.fallback?this.fallback.id:void 0),createSource:e=>`new ${e("LocalTokenGroup","@lezer/lr")}(${eB(o)}, ${a}${this.fallback?`, ${this.fallback.id}`:""})`}}}let e4=1114111;function e9(e){return e instanceof R&&0==e.exprs.length}function e8(e,t){let s=Object.create(null);for(let n of t){e.unique(n.id);let{name:t,props:i,dialect:r}=e.nodeInfo(n.props,"d",n.id.name),l=e.makeTerminal(n.id.name,t,i);null!=r&&(e.tokens.byDialect[r]||(e.tokens.byDialect[r]=[])).push(l),e.namedTerms[n.id.name]=s[n.id.name]=l}return s}function e7(e,t,s){let n=t[s.id.name];return n?(s.args.length&&e.raise("External tokens cannot take arguments",s.args[0].start),e.used(s.id.name),n):null}function te(e,t,s){let n=e.findIndex(e=>e.term==t);n<0?e.push({term:t,after:s}):e[n]={term:t,after:e[n].after.concat(s)}}class tt{constructor(e,t){for(let s in this.b=e,this.ast=t,this.tokens=e8(e,t.tokens),this.tokens)this.b.tokenOrigins[this.tokens[s].name]={external:this}}getToken(e){return e7(this.b,this.tokens,e)}create(){return this.b.options.externalTokenizer(this.ast.id.name,this.b.termTable)}createSource(e){let{source:t,id:{name:s}}=this.ast;return e(s,t)}}class ts{constructor(e,t){this.b=e,this.ast=t,this.term=null,this.tokens=e8(e,t.tokens)}finish(){let e=this.b.normalizeExpr(this.ast.token);for(let t in 1==e.length&&1==e[0].terms.length&&e[0].terms[0].terminal||this.b.raise(`The token expression to '@external ${this.ast.type}' must resolve to a token`,this.ast.token.start),this.term=e[0].terms[0],this.tokens)this.b.tokenOrigins[this.tokens[t].name]={spec:this.term,external:this}}getToken(e){return e7(this.b,this.tokens,e)}}function tn(e,t={}){let s=new eV(e,t),n=s.getParser();return n.termTable=s.termTable,n}let ti=["break","case","catch","continue","debugger","default","do","else","finally","for","function","if","return","switch","throw","try","var","while","with","null","true","false","instanceof","typeof","void","delete","new","in","this","const","class","extends","export","import","super","enum","implements","interface","let","package","private","protected","public","static","yield","require"]}}]);