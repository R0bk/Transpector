(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5405],{48312:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(74793)}])},74793:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return eR}});var n=a(41844),l=a(55784),s=a(69071),o=a(32871),r=a(83599);a(92450);var i=a(76248),d=a(73445),c=a(4080),u=a(73073);let p=[{id:"text",type:"textInput",data:{text:"Jane Doe"},deletable:!1,position:{x:-200,y:400}},{id:"tokenizedWords",type:"tokenizedWords",data:{tokenizedWords:[["This","is","an","ex","amp","le"]],activations:u.nGf([1,12,7,7])},deletable:!1,position:{x:-200,y:300}},{id:"tokens",type:"token",data:{tokens:[1,2,3,4,5]},deletable:!1,position:{x:-200,y:200}},{id:"we",type:"embed",data:{label:"Textual Embedding",realationId:"hook_embed",activations:u.nGf([1,5,5])},deletable:!1,position:{x:-200,y:-200}},{id:"pos",type:"embed",data:{label:"Positional Embedding",realationId:"hook_pos_embed",activations:u.nGf([1,5,5])},deletable:!1,position:{x:200,y:-200}}],h=[{id:"e1",source:"text",target:"tokenizedWords",deletable:!1},{id:"e2",source:"tokenizedWords",target:"tokens",deletable:!1},{id:"e3",source:"tokens",target:"we",type:"button",deletable:!1},{id:"e4",source:"tokens",target:"pos",type:"button",deletable:!1},{id:"we-b1",source:"we",target:"blocks.0",deletable:!1},{id:"e8",source:"we",target:"blocks.0.hook_resid_mid",deletable:!1},{id:"e9",source:"pos",target:"blocks.0",deletable:!1},{id:"e12",source:"pos",target:"blocks.0.hook_resid_mid",deletable:!1}],m={stroke:"rgb(255, 0, 113)",strokeWidth:2},x=(e,t)=>{let{[e]:a,...n}=t;return n},g={method:"PUT",headers:{"Content-Type":"application/json"}},f=(0,d.Ue)((e,t)=>({logicalClock:0,initNodes:p,initEdges:h,nodes:[...p],edges:[...h],onNodesChange:a=>{e({nodes:(0,s.Fb)(a,t().nodes)})},onEdgesChange:a=>{e({edges:(0,s.yn)(a,t().edges)})},onConnect:a=>{console.log(a);let{source:n,target:l}=a,{nodes:o}=t(),r=o.find(e=>{let{id:t}=e;return t===n}).data,i=o.find(e=>{let{id:t}=e;return t===l}).data;t().addPatch(r.realationId,r.slice,i.realationId,i.slice);let d={...a,style:m};e({edges:(0,s.Z_)(d,t().edges)})},createNodes(a){e({nodes:[...t().nodes,...a]})},createEdges(a){e({edges:[...t().edges,...a]})},resetFlow(){e({nodes:p,edges:h})},availableModels:[],getAvailableModels(){fetch("/api/models/getModels").then(e=>e.json()).then(t=>{e({availableModels:t})})},modelInputText:[""],modelInputSubWords:[["This","is","an","ex","amp","le"]],modelInputTokens:[[1,2,3,4,5]],updateModelInputText(t){e({modelInputText:[t]}),fetch("/api/tokenize/toTokens",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:[t]})}).then(e=>e.json()).then(t=>{e({modelInputTokens:t.tokens})}),fetch("/api/tokenize/toStringTokens",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:[t]})}).then(e=>e.json()).then(t=>{e({modelInputSubWords:t.stringTokens})})},updatemodelInputTokens(t){e({modelInputTokens:t})},modelActivations:{},inferencePrompt:"",inferenceSubWords:[],inferencing:!1,modelOutputlogits:[],modelOutputTokens:[],modelOutputSubWords:[],modelOutputLoss:[],modelOuputFinalLoss:0,inferenceModel(){e({inferencing:!0}),fetch("/api/inference/run").then(e=>e.json()).then(t=>{console.log(t),e({inferencePrompt:t.inferencePrompt,inferenceSubWords:t.inferenceSubWords,modelOutputlogits:t.logits,modelOutputTokens:t.tokens,modelOutputSubWords:t.subWords,modelOutputLoss:t.tokenLoss,modelOuputFinalLoss:t.finalLoss,modelActivations:Object.fromEntries(Object.entries(t.activationData).map(e=>{let[t,a]=e;return[t,u.XeE(a)]}))}),e({inferencing:!1})})},modelPatches:{},syncPatches(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t().logicalClock,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};fetch("/api/patch/sync",{...g,body:JSON.stringify({patches:n,clientLogicalClock:a})}).then(e=>e.json()).then(t=>{e(e=>({modelPatches:{...t.patches},logicalClock:Math.max(a,t.server_logical_clock)+1}))})},addPatch(e,a,n,l){let{modelPatches:s,logicalClock:o}=t(),r=(0,c.uhR)([e,a,"slice"],a,s),i=(0,c.uhR)([e,a,"edges",n,l],{slice:l},r);t().syncPatches(o,i)},rmPatch(e,a,n,l){let{modelPatches:s,logicalClock:o}=t(),r=(0,c.ghH)([e,a,"edges",n,l],s);t().syncPatches(o,r)},patching:!1,patchTargetNodes:new Set,startPatchEdge(a,n){let{nodeId:l}=n,{nodes:s}=t(),o=s.find(e=>{let{id:t}=e;return t===l}).data.outputShapeStrings;e({patching:!0,patchTargetNodes:new Set(s.filter(e=>{var t;let{data:a}=e;return(null==a?void 0:null===(t=a.inputShapeStrings)||void 0===t?void 0:t.join(","))===o.join(",")}).map(e=>{let{id:t}=e;return t}))})},endPatchEdge(t){e({patching:!1,patchTargetNodes:new Set})},deletePatchEdge(e){let{nodes:a,rmPatch:n}=t();e.map(e=>{let{source:t,target:l}=e,s=a.find(e=>{let{id:a}=e;return a===t}).data,o=a.find(e=>{let{id:t}=e;return t===l}).data;n(s.realationId,s.slice,o.realationId,o.slice)})},validPatchEdge(e){let{source:a,target:n}=e,{nodes:l}=t(),s=l.find(e=>{let{id:t}=e;return t===a}).data,o=l.find(e=>{let{id:t}=e;return t===n}).data;return s.outputShapeStrings.join(",")===o.inputShapeStrings.join(",")},modelAblations:{},syncAblations(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t().logicalClock,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};fetch("/api/ablation/sync",{...g,body:JSON.stringify({ablations:n,clientLogicalClock:a})}).then(e=>e.json()).then(t=>{e(e=>({modelAblations:{...t.ablations},logicalClock:Math.max(a,t.server_logical_clock)+1}))})},addAblations(e,a,n){let{modelAblations:l,logicalClock:s}=t(),o={...l,[e]:{...null==l?void 0:l[e],...Object.assign({},...a.map(e=>({[e]:{slice:e,ablationType:n}})).values())}};t().syncAblations(s,o)},rmAblations(e,a){let{modelAblations:n,logicalClock:l}=t(),s=a.reduce((t,a)=>({...t,[e]:{...x(a,null==t?void 0:t[e])}}),{...n});t().syncAblations(l,s)}}));var b=a(99822);let y=e=>({updatemodelInputTokens:e.updatemodelInputTokens,modelInputTokens:e.modelInputTokens,modelInputSubWords:e.modelInputSubWords,modelInputText:e.modelInputText,modelActivations:e.modelActivations,inferencePrompt:e.inferencePrompt}),v=e=>{let{data:t}=e,a=f(y,i.X);return(0,n.jsxs)("div",{className:"px-6 py-4 shadow-md rounded-md bg-slate-900 border-2 border-stone-950",children:[(0,n.jsx)("div",{className:"flex",children:(0,n.jsx)("div",{className:"flex flex-row w-[48em]",children:(0,n.jsxs)("span",{className:"block text-xs text-slate-400 py-2",children:["[",a.modelInputTokens[0].map((e,t)=>(0,n.jsxs)("span",{className:"px-px",children:[String(e),", "]},t)),"]"]})})}),(0,n.jsx)(s.HH,{type:"target",position:s.Ly.Bottom,className:"w-16 !bg-teal-500"}),(0,n.jsx)(s.HH,{type:"source",position:s.Ly.Top,className:"w-16 !bg-teal-500"})]})},j=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,a=e*(360/t)%360;return b.USs("hsla(".concat(a,", 1%, 0%, 0.0)"),"hsla(".concat(a,", 100%, 60%, 1.0)"))},w=(e,t)=>Array.from({length:e},(e,a)=>b.cJy().interpolator(j(a)).domain(t));function N(e){let t=/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.e-]+))?\)/.exec(e);if(!t)return;let[,a,n,l,s]=t;return{r:parseInt(a),g:parseInt(n),b:parseInt(l),a:s?parseFloat(s):1}}let S=(e,t,a,n)=>{if(!e)return function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return""};let l=null==e?void 0:e.transpose([0,1,3,2]),[s,o,r,i]=l.shape,d=l.mean(0),c=-1===t?d:u.L9e(u.tPi(d,[t,0,0],[1,r,i]),[0]),p=[c.min().dataSync()[0],c.max().dataSync()[0]],h=d.arraySync(),m=d.transpose([0,2,1]).arraySync(),x=w(o,p);return(e,t)=>{let l="Key → Query"===n?h:m,s=null!==a?a:e,o=-1===t?x.map((t,a)=>t(l[a][e][s])):[x[t](l[t][e][s])];return function(e){let[t,a,n,l]=e;return"rgba(".concat(t,", ").concat(a,", ").concat(n,", ").concat(l,")")}(function(e){let[t,a,n,l]=[0,0,0,0];return e.map(N).forEach(e=>{let{r:s,g:o,b:r,a:i}=e,d=1-i;t=s*i+t*d,a=o*i+a*d,n=r*i+n*d,l=i+d*(1-i)}),[t,a,n,l].map(e=>Math.round(e))}(o))}},k=e=>{var t,a,s,o;let{layer:r=1,head:d=-1,direction:c="Key → Query",formatting:u="text"}=e,p=f(y,i.X),[h,m]=(0,l.useState)(null),x="blocks.".concat(r,".attn.hook_pattern"),g=null===(t=p.modelActivations)||void 0===t?void 0:null===(a=t[x])||void 0===a?void 0:null===(s=a.shape)||void 0===s?void 0:s[2],b=S(null===(o=p.modelActivations)||void 0===o?void 0:o[x],d,h,c);return(0,n.jsx)("div",{className:"flex",children:(0,n.jsx)("div",{className:"flex flex-row w-[48em]",children:(0,n.jsxs)("span",{className:"block text-xs text-slate-400 py-2",children:["array"===u&&"[",p.modelInputSubWords[0].map((e,t)=>(0,n.jsxs)("span",{id:"word-".concat(t),className:"px-px",style:{backgroundColor:p.inferencePrompt[0]===p.modelInputText[0]&&g===p.modelInputSubWords[0].length?b(t,d):""},onMouseOver:()=>m(t),onMouseOut:()=>m(null),children:[e,"array"===u&&","]},t)),"array"===u&&"]"]})})})},I=e=>{let{data:t}=e;return(0,n.jsxs)("div",{className:"px-6 py-4 shadow-md rounded-md bg-slate-900 border-2 border-stone-950",children:[(0,n.jsx)(k,{layer:1,head:-1,direction:"Key → Query",formatting:"array"}),(0,n.jsx)(s.HH,{type:"target",position:s.Ly.Bottom,className:"w-16 !bg-teal-500"}),(0,n.jsx)(s.HH,{type:"source",position:s.Ly.Top,className:"w-16 !bg-teal-500"})]})},T=e=>({modelInputText:e.modelInputText,updateModelInputText:e.updateModelInputText,inferencing:e.inferencing,inferenceModel:e.inferenceModel}),H=()=>{let e=f(T,i.X);return(0,n.jsxs)("div",{className:"px-6 py-4 shadow-md rounded-md bg-slate-900 border-2 border-stone-950",children:[(0,n.jsx)("div",{className:"flex",children:(0,n.jsx)("div",{className:"flex flex-row",children:(0,n.jsx)("label",{className:"w-[48em] block",children:(0,n.jsx)("input",{className:"text-slate-300 bg-slate-900 shadow-sm border-0 focus:outline-none focus:border-0 placeholder-slate-400 text-sm py-2 px-3 w-full ",placeholder:"Example input...",value:e.modelInputText,onChange:t=>e.updateModelInputText(t.target.value)})})})}),(0,n.jsx)(s.HH,{type:"source",position:s.Ly.Top,className:"w-16 !bg-teal-500"})]})},A=e=>{let{layerCount:t=5,headCount:a=5}=e,s=f(T,i.X),[o,r]=(0,l.useState)("2"),[d,c]=(0,l.useState)("2"),[u,p]=(0,l.useState)("Key → Query"),h=Array.from({length:t},(e,t)=>(0,n.jsx)("option",{value:t,children:"Layer ".concat(t)},t)),m=[{value:"-1",text:"All"},...Array.from({length:a},(e,t)=>({value:t,text:"Head ".concat(t)}))].map(e=>{let{value:t,text:a}=e;return(0,n.jsx)("option",{value:t,children:a},t)}),x=()=>{p(e=>"Key → Query"===e?"Key ← Query":"Key → Query")};return(0,n.jsx)("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 z-50 text-slate-400",children:(0,n.jsxs)("div",{className:"flex flex-row",children:[(0,n.jsxs)("div",{className:"flex flex-col px-2 mx-4 py-4 w-[8em] shadow-md rounded-md bg-slate-900 border-2 border-stone-950",children:[(0,n.jsx)("div",{className:"flex flex-row justify-center  px-0 py-1 h-1/3",children:(0,n.jsx)("select",{className:"text-xs bg-slate-900 border-0 focus:ring-0 focus:outline-none focus:border-0 ",value:o,onChange:e=>{r(e.target.value)},children:h})}),(0,n.jsx)("div",{className:"flex flex-row justify-center px-0 py-1 h-1/3",children:(0,n.jsx)("select",{className:"text-xs  bg-slate-900 border-0 focus:ring-0 focus:outline-none focus:border-0 ",value:d,onChange:e=>{c(e.target.value)},children:m})}),(0,n.jsx)("div",{className:"flex flex-row justify-center py-1 h-1/3",children:(0,n.jsx)("button",{className:"text-xs bg-slate-900 border-0 focus:ring-0 focus:outline-none focus:border-0",onClick:x,children:u})})]}),(0,n.jsx)("div",{className:"px-6 py-4 shadow-md rounded-md bg-slate-900 border-2 border-stone-950",children:(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("div",{className:"flex flex-row px-5 py-1",children:(0,n.jsx)(k,{layer:parseInt(o),head:parseInt(d),direction:u})}),(0,n.jsxs)("div",{className:"flex flex-row relative",children:[(0,n.jsx)("label",{className:"w-[48em] block",children:(0,n.jsx)("input",{className:"bg-slate-900 shadow-sm border-0 focus:outline-none focus:border-0 placeholder-slate-400 text-sm py-2 px-3 w-full ",placeholder:"Example input...",value:s.modelInputText,onChange:e=>s.updateModelInputText(e.target.value)})}),(0,n.jsx)("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center text-green-500",onClick:()=>s.inferenceModel(),disabled:s.inferencing,children:s.inferencing?(0,n.jsx)("svg",{className:"animate-spin h-5 w-5 mr-2",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})}):(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"h-5 w-5 mr-2",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 5l7 7m0 0l-7 7m7-7H3"})})})]})]})})]})})};var L=a(34710);let M=e=>({modelActivations:e.modelActivations,patchTargetNodes:e.patchTargetNodes,patching:e.patching}),C=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,a=e*(360/t)%360;return b.USs("hsla(".concat(a,", 30%, 0%, 0.0)"),"hsla(".concat(a,", 30%, 60%, 1.0)"))},_=e=>{let{data:t,width:a,height:s,renderText:o=!1}=e,r=(0,l.useRef)(null);return(0,l.useEffect)(()=>{if(!r.current)return;let[e,n,l,i]=t.shape,d=t.mean(0),c=[d.min().dataSync()[0],d.max().dataSync()[0]],u=Array.from({length:l},(e,t)=>b.cJy().interpolator(C(t)).domain(c)),p=b.tiA().domain(b.w6H(n).map(String)).range([0,a]).paddingInner(.3),h=b.tiA().domain(b.w6H(i*l).map(String)).range([0,s]),m=d.arraySync(),x=b.Ys(r.current),g=x.node().getContext("2d");if(g){x.attr("width",2*a),x.attr("height",2*s),x.style("width","".concat(a,"px")),x.style("height","".concat(s,"px")),g.scale(2,2),g.clearRect(0,0,a,s);for(let e=0;e<n;e++)for(let t=0;t<l;t++)for(let a=0;a<i;a++)g.fillStyle=u[t](m[e][t][a]),g.fillRect(p(String(e)),h(String(a+t*i)),p.bandwidth(),h.bandwidth());if(o){g.textAlign="center",g.textBaseline="middle",g.fillStyle="rgb(203 213 225)",g.font="".concat(.3*p.bandwidth(),"px sans-serif");for(let e=0;e<n;e++)for(let t=0;t<i;t++)g.fillText(m[e][t].toFixed(2),p(String(e))+p.bandwidth()/2,h(String(t))+h.bandwidth()/2)}}},[t,a,s]),(0,n.jsx)("canvas",{ref:r,width:a,height:s})},P=e=>{var t;let{id:a,data:o,selected:r}=e,{modelActivations:d,patchTargetNodes:c,patching:u}=f(M,i.X),[p,h,m]=[192,96,24],[x,g]=(0,l.useState)(p),[b,y]=(0,l.useState)(h),v=u&&!c.has(a);return(0,n.jsxs)("div",{className:"px-0 py-0 shadow-md rounded-md bg-slate-900 border-2 border-stone-950 ".concat(v?"grayscale-[95%]":""),children:[(0,n.jsx)(L.pM,{color:"#ff0071",isVisible:r,minWidth:p,minHeight:h+m,onResize:(e,t)=>{let{width:a,height:n}=t;g(a),y(n-m)}}),(0,n.jsx)("span",{className:"px-2 py-1 text-sm text-slate-300",children:o.label}),(0,n.jsx)("div",{className:"flex",children:(0,n.jsx)("div",{className:"flex flex-row w-48 h-24",children:(0,n.jsx)(_,{data:null!==(t=null==d?void 0:d[o.realationId])&&void 0!==t?t:o.activations,width:x,height:b})})}),(0,n.jsx)(s.HH,{type:"target",position:s.Ly.Bottom,className:"w-8 !bg-teal-500"}),(0,n.jsx)(s.HH,{type:"source",position:s.Ly.Top,className:"w-8 !bg-teal-500"})]})},O=e=>({inferenceModel:e.inferenceModel}),E=(e,t,a)=>{a.inferenceModel(),e.stopPropagation()};function R(e){let{id:t,sourceX:a,sourceY:l,targetX:o,targetY:r,sourcePosition:d,targetPosition:c,style:u={},markerEnd:p}=e,h=f(O,i.X),[m,x,g]=(0,s.OQ)({sourceX:a,sourceY:l,sourcePosition:d,targetX:o,targetY:r,targetPosition:c});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{id:t,style:u,className:"react-flow__edge-path",d:m,markerEnd:p}),(0,n.jsx)("foreignObject",{width:48,height:48,x:x-24,y:g-24,className:"edgebutton-foreignobject w-12 h-12 flex flex-center",requiredExtensions:"http://www.w3.org/1999/xhtml",children:(0,n.jsx)("div",{className:"m-1 h-10 w-10 justify-center items-center flex",children:(0,n.jsx)("button",{className:"edgebutton rounded-full p-2 justify-center bg-slate-800 items-center ring-1 ring-slate-200/20 shadow-lg w-10 h-10",onClick:e=>E(e,t,h),children:(0,n.jsx)("svg",{className:"w-6 h-6 text-green-500 rotate-180",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{d:"M19 14l-7 7m0 0l-7-7m7 7V3"})})})})})]})}let z=e=>({modelActivations:e.modelActivations,patchTargetNodes:e.patchTargetNodes,patching:e.patching}),W=e=>{let{id:t,data:a}=e,{modelActivations:l,patchTargetNodes:o,patching:r}=f(z,i.X),d=r&&!o.has(t);return(0,n.jsxs)("div",{className:"px-2 py-2 w-[12em] shadow-md rounded-md bg-slate-900 border-2 border-stone-950 ".concat(d?"grayscale-[95%]":""),children:[(0,n.jsx)("span",{className:"px-2 py-1 text-sm text-slate-300",children:a.label}),(0,n.jsx)(s.HH,{type:"target",position:s.Ly.Bottom,className:"w-8 !bg-teal-500"}),(0,n.jsx)(s.HH,{type:"source",position:s.Ly.Top,className:"w-8 !bg-teal-500"})]})},q=e=>({modelActivations:e.modelActivations,patchTargetNodes:e.patchTargetNodes,patching:e.patching}),X=e=>{let{data:t,width:a,height:s,renderText:o=!1}=e,r=(0,l.useRef)(null);return(0,l.useEffect)(()=>{if(!r.current)return;let[e,n,l]=t.shape,i=t.mean(0),d=[i.min().dataSync()[0],i.max().dataSync()[0]],c=b.cJy().interpolator(b.Vaf).domain(d),u=b.tiA().domain(b.w6H(n).map(String)).range([0,a]).paddingInner(.3),p=b.tiA().domain(b.w6H(l).map(String)).range([0,s-5]),h=i.arraySync(),m=b.Ys(r.current),x=m.node().getContext("2d");if(x){m.attr("width",2*a),m.attr("height",2*s),m.style("width","".concat(a,"px")),m.style("height","".concat(s,"px")),x.scale(2,2),x.clearRect(0,0,a,s);for(let e=0;e<n;e++)for(let t=0;t<l;t++)x.fillStyle=c(h[e][t]),x.fillRect(u(String(e)),p(String(t)),u.bandwidth(),p.bandwidth());if(o){x.textAlign="center",x.textBaseline="middle",x.fillStyle="rgb(203 213 225)",x.font="".concat(.3*u.bandwidth(),"px sans-serif");for(let e=0;e<n;e++)for(let t=0;t<l;t++)x.fillText(h[e][t].toFixed(2),u(String(e))+u.bandwidth()/2,p(String(t))+p.bandwidth()/2)}}},[t,a,s]),(0,n.jsx)("canvas",{ref:r,width:a,height:s})},B=e=>{var t;let{id:a,data:o,selected:r}=e,{modelActivations:d,patchTargetNodes:c,patching:u}=f(q,i.X),[p,h,m]=[288,288,24],[x,g]=(0,l.useState)(p),[b,y]=(0,l.useState)(h),v=u&&!c.has(a);return(0,n.jsxs)("div",{className:"px-0 py-0 shadow-md rounded-md bg-slate-900 border-2 border-stone-950 ".concat(v?"grayscale-[95%]":""),children:[(0,n.jsx)(L.pM,{color:"#ff0071",isVisible:r,minWidth:p,minHeight:h+m,onResize:(e,t)=>{let{width:a,height:n}=t;g(a),y(n-m)}}),(0,n.jsx)("span",{className:"px-2 py-1 text-sm text-slate-300",children:o.label}),(0,n.jsx)("div",{className:"flex",children:(0,n.jsx)("div",{className:"flex flex-row w-72 h-72",children:(0,n.jsx)(X,{data:null!==(t=null==d?void 0:d[o.realationId])&&void 0!==t?t:o.activations,width:x,height:b})})}),(0,n.jsx)(s.HH,{type:"target",position:s.Ly.Bottom,className:"w-8 !bg-teal-500"}),(0,n.jsx)(s.HH,{type:"source",position:s.Ly.Top,className:"w-8 !bg-teal-500"})]})},F=e=>{var t;let{id:a,data:o,selected:r}=e,{modelActivations:d,patchTargetNodes:c,patching:u}=f(q,i.X),[p,h,m]=[144,144,24],[x,g]=(0,l.useState)(p),[b,y]=(0,l.useState)(h),v=u&&!c.has(a);return(0,n.jsxs)("div",{className:"px-0 py-0 shadow-md rounded-md bg-slate-900 border-2 border-stone-950 ".concat(v?"grayscale-[95%]":""),children:[(0,n.jsx)(L.pM,{color:"#ff0071",isVisible:r,minWidth:p,minHeight:h+m,onResize:(e,t)=>{let{width:a,height:n}=t;g(a),y(n-m)}}),(0,n.jsx)("span",{className:"px-2 py-1 text-sm text-slate-300",children:"Attention Residual"}),(0,n.jsx)("div",{className:"flex",children:(0,n.jsx)("div",{className:"flex flex-row ",children:(0,n.jsx)(X,{data:null!==(t=null==d?void 0:d[o.realationId])&&void 0!==t?t:o.activations,width:x,height:b})})}),(0,n.jsx)(s.HH,{type:"target",position:s.Ly.Bottom,className:"w-8 !bg-teal-500"}),(0,n.jsx)(s.HH,{type:"source",position:s.Ly.Top,className:"w-8 !bg-teal-500"})]})};var J=a(83300),G=a(85529);let V=e=>({modelActivations:e.modelActivations,modelAblations:e.modelAblations,addAblations:e.addAblations,rmAblations:e.rmAblations,patchTargetNodes:e.patchTargetNodes,patching:e.patching}),Q=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,a=e*(360/t)%360;return b.USs("hsla(".concat(a,", 1%, 0%, 0.0)"),"hsla(".concat(a,", 100%, 60%, 1.0)"))},U=(e,t)=>{let a=(0,l.useRef)(e.id),n=e.shape,[s,o]=(0,l.useState)(()=>void 0!==t?u.L9e(u.tPi(e.transpose([0,1,3,2]),[0,t,0,0],[n[0],1,n[3],n[2]]),[1]):e.transpose([0,1,3,2])),[r,i]=(0,l.useState)(()=>s.mean(0)),[d,c]=(0,l.useState)(()=>[r.min().dataSync()[0],r.max().dataSync()[0]]),[p,h]=(0,l.useState)(()=>r.arraySync());return(0,l.useEffect)(()=>{if(a.current!==e.id){a.current=e.id;let n=e.shape,l=void 0!==t?u.L9e(u.tPi(e.transpose([0,1,3,2]),[0,t,0,0],[n[0],1,n[3],n[2]]),[1]):e.transpose([0,1,3,2]),s=l.mean(0);o(l),i(s),c([s.min().dataSync()[0],s.max().dataSync()[0]]),h(s.arraySync())}},[e,t]),{data:s,meanData:r,minMax:d,syncData:p}},Z=e=>{let{patternData:t,width:a,height:s,renderText:o=!1,colourId:r=0}=e,i=(0,l.useRef)(null),{data:d,minMax:c,syncData:u}=t,[p,h,m]=d.shape;return(0,l.useEffect)(()=>{if(!i.current)return;let e=b.cJy().interpolator(Q(r)).domain(c),t=b.tiA().domain(b.w6H(h).map(String)).range([0,a]),n=b.tiA().domain(b.w6H(m).map(String)).range([0,s]),l=b.Ys(i.current),d=l.node().getContext("2d");if(d){l.attr("width",2*a),l.attr("height",2*s),l.style("width","".concat(a,"px")),l.style("height","".concat(s,"px")),d.scale(2,2),d.clearRect(0,0,a,s);for(let a=0;a<h;a++)for(let l=0;l<m;l++)d.fillStyle=e(u[a][l]),d.fillRect(t(String(a)),n(String(l)),t.bandwidth(),n.bandwidth());if(o){d.textAlign="center",d.textBaseline="middle",d.fillStyle="rgb(203 213 225)",d.font="".concat(.3*t.bandwidth(),"px sans-serif");for(let e=0;e<h;e++)for(let a=0;a<m;a++)d.fillText(u[e][a].toFixed(2),t(String(e))+t.bandwidth()/2,n(String(a))+n.bandwidth()/2)}}},[m,h,c,u,a,s,o,r]),(0,n.jsx)("canvas",{ref:i,width:a,height:s})},D=e=>{let{patternData:t,width:a,height:s}=e,o=(0,l.useRef)(null),{data:r,syncData:i}=t,[d,c,u,p]=r.shape;return(0,l.useEffect)(()=>{let e=b.tiA().domain(b.w6H(u).map(String)).range([0,a]),t=b.tiA().domain(b.w6H(p).map(String)).range([0,s]);if(!o.current)return;let n=b.Ys(o.current),l=n.node().getContext("2d");l&&(n.attr("width",2*a),n.attr("height",2*s),n.style("width","".concat(a,"px")),n.style("height","".concat(s,"px")),l.scale(2,2),i.forEach((a,n)=>{let s=b.cJy().interpolator(Q(n)).domain(b.Wem(a.flat()));for(let n=0;n<u;n++)for(let o=0;o<p;o++)l.fillStyle=s(a[n][o]),l.fillRect(e(String(n)),t(String(o)),e.bandwidth(),t.bandwidth())}))},[i,p,u,a,s]),(0,n.jsx)("canvas",{ref:o,width:a,height:s})},K=(e,t)=>Array.from({length:t},(e,t)=>[[0,-1],[t,t+1],[0,-1],[0,-1]]).filter(t=>t[1][0]!==e),Y=e=>{var t,a,o,r,d,c;let{id:u,data:{realationId:p,relationSliceId:h,activations:m,slice:x,label:g,colourId:b},selected:y}=e,{modelActivations:v,modelAblations:j,rmAblations:w,addAblations:N,patchTargetNodes:S,patching:k}=f(V,i.X),I=null!==(d=null==j?void 0:null===(t=j[p])||void 0===t?void 0:null===(a=t[x.toString()])||void 0===a?void 0:a.slice)&&void 0!==d&&d,T=null==j?void 0:null===(o=j[p])||void 0===o?void 0:null===(r=o[x.toString()])||void 0===r?void 0:r.ablationType,[H,A]=(0,l.useState)(!1),[M,C,_]=[96,96,24],[P,O]=(0,l.useState)(M),[E,R]=(0,l.useState)(C),z=U(null!==(c=null==v?void 0:v[p])&&void 0!==c?c:m,h),W=k&&!S.has(u);return(0,n.jsxs)("div",{className:"px-0 py-0 shadow-md rounded-md bg-slate-900 border-2 border-stone-950 ".concat(I||W?"freeze"===T?"grayscale-[25%]":"grayscale-[95%]":""),onMouseEnter:()=>A(!0),onMouseLeave:()=>A(!1),children:[(0,n.jsx)(L.pM,{color:"#ff0071",isVisible:y,minWidth:M,minHeight:C+_,onResize:(e,t)=>{let{width:a,height:n}=t;O(a),R(n-_)}}),(0,n.jsx)(J.M,{offset:0,isVisible:H,position:s.Ly.Right,children:(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("button",{className:"bg-slate-800 hover:bg-red-400 text-slate-300 py-2 px-2 rounded-md my-1",onClick:I?()=>w(p,[x]):()=>N(p,[x],"zero"),children:(0,n.jsx)("div",{title:"Ablate Head",children:(0,n.jsx)(G.BRS,{fill:"zero"===T?"#888":"#fff",size:16})})}),(0,n.jsx)("button",{className:"bg-slate-800 hover:bg-red-400 text-slate-300 py-2 px-2 rounded-md my-1",onClick:I?()=>w(p,K(h,m.shape[1])):()=>N(p,K(h,m.shape[1]),"zero"),children:(0,n.jsx)("div",{title:"Isolate Head",children:(0,n.jsx)(G.Rvi,{size:16})})}),(0,n.jsx)("button",{className:"bg-slate-800 hover:bg-red-400 text-slate-300 py-2 px-2 rounded-md my-1",onClick:I?()=>w(p,[x]):()=>N(p,[x],"freeze"),children:(0,n.jsx)("div",{title:"Freeze Head",children:(0,n.jsx)(G.qQX,{size:16,fill:"freeze"===T?"#888":"#fff"})})})]})}),(0,n.jsxs)("span",{className:"px-2 py-1 text-sm text-slate-300",children:["freeze"===T&&(0,n.jsx)(G.qQX,{size:12})," ",g]}),(0,n.jsx)("div",{className:"flex",children:(0,n.jsx)("div",{className:"flex flex-row w-[".concat(P,"px] h-[").concat(E,"px]"),children:void 0!==h?(0,n.jsx)(Z,{patternData:z,width:P,height:E,colourId:b}):(0,n.jsx)(D,{patternData:z,width:P,height:E})})}),(0,n.jsx)(s.HH,{type:"target",position:s.Ly.Bottom,className:"w-8 !bg-teal-500"}),(0,n.jsx)(s.HH,{type:"source",position:s.Ly.Top,className:"w-8 !bg-teal-500"})]})},$=e=>{var t;let{id:a,data:{realationId:o,activations:r,label:d},selected:c}=e,{modelActivations:u,patchTargetNodes:p,patching:h}=f(V,i.X),[m,x,g]=[96,96,24],[b,y]=(0,l.useState)(m),[v,j]=(0,l.useState)(x),w=U(null!==(t=null==u?void 0:u[o])&&void 0!==t?t:r,void 0),N=h&&!p.has(a);return(0,n.jsxs)("div",{className:"px-0 py-0 shadow-md rounded-md bg-slate-900 border-2 border-stone-950 ".concat(N?"grayscale-[95%]":""),children:[(0,n.jsx)(L.pM,{color:"#ff0071",isVisible:c,minWidth:m,minHeight:x+g,onResize:(e,t)=>{let{width:a,height:n}=t;y(a),j(n-g)}}),(0,n.jsx)("span",{className:"px-2 py-1 text-sm text-slate-300",children:d}),(0,n.jsx)("div",{className:"flex",children:(0,n.jsx)("div",{className:"flex flex-row w-24 h-24",children:(0,n.jsx)(D,{patternData:w,width:b,height:v})})}),(0,n.jsx)(s.HH,{type:"target",position:s.Ly.Bottom,className:"w-8 !bg-teal-500"}),(0,n.jsx)(s.HH,{type:"source",position:s.Ly.Top,className:"w-8 !bg-teal-500"})]})};var ee=a(23838),et=a(13045);a(84249);let ea=e=>({modelOutputlogits:e.modelOutputlogits,modelOutputTokens:e.modelOutputTokens,modelOutputSubWords:e.modelOutputSubWords,modelOutputLoss:e.modelOutputLoss,inferenceSubWords:e.inferenceSubWords}),en=e=>{let{data:t}=e,{modelOutputSubWords:a,modelOutputLoss:o,inferenceSubWords:r}=f(ea,i.X),[d,c]=(0,l.useState)(null),u=(0,l.useRef)(null);return(0,l.useEffect)(()=>{if(!u.current)return;(0,ee.Z)(u.current).selectAll("*").remove();let e=(0,et.Z)().domain([0,o.length]).range([25,566]),t=(0,et.Z)().domain([0,Math.max(...o)]).range([95,4]),a=(0,ee.Z)(u.current).attr("width",576).attr("height",96),n=a.selectAll("rect").data(o).join("rect");n.attr("x",(t,a)=>e(a)).attr("y",e=>t(e)).attr("width",576/o.length-4).attr("height",e=>t(0)-t(e)).attr("fill",(e,t)=>t===d?"#d73027":"rgba(214, 39, 40, 0.2)"),n.on("mouseover",(e,t)=>c(t)).on("mouseout",()=>c(null)).append("title").text(e=>"Loss: ".concat(e));let l=a.selectAll("line").data(o).join("line");l.attr("x1",(t,a)=>e(a)).attr("y1",e=>t(e)).attr("x2",(t,a)=>e(a)+576/o.length-4).attr("y2",e=>t(e)).attr("stroke",(e,t)=>t===d?"#d73027":"rgba(214, 39, 40, 0.2)").attr("stroke-width",2);let s=b.y4O(t).ticks(2).tickPadding(4).tickSize(2).tickValues([Math.max(...o)]);a.append("g").attr("transform","translate(20, 0)").style("color","rgba(150,150,150,0.25)").call(s).append("text").attr("class","text-sm").attr("transform","rotate(-90)").attr("y",-15).attr("dy",".71em").attr("x",-64).attr("fill","rgba(150,150,150,0.25)").text("Loss")},[o,d]),(0,l.useEffect)(()=>{if(u.current){let e=(0,ee.Z)(u.current);e.selectAll("rect").attr("fill",(e,t)=>t===d?"#d73027":"rgba(214, 39, 40, 0.2)"),e.selectAll("line").attr("stroke",(e,t)=>t===d?"#d73027":"rgba(214, 39, 40, 0.2)")}},[d]),(0,n.jsxs)("div",{className:"px-6 py-4 shadow-md rounded-md bg-slate-900 border-2 border-stone-950",children:[(0,n.jsx)("div",{className:"py-2",children:(0,n.jsx)("svg",{ref:u})}),(0,n.jsx)("div",{className:"flex flex-wrap w-[576px] py-2",children:a.length>0&&a[0].map((e,t)=>(0,n.jsxs)("div",{className:"px-1",children:[(0,n.jsx)("span",{id:"word-".concat(t),className:"text-xs ".concat(d===t?"text-red-500":"text-slate-600"),children:t+1<r[0].length&&r[0][t+1]}),(0,n.jsx)("br",{}),(0,n.jsx)("span",{className:"text-sm ".concat(d===t?"text-red-500":"text-slate-300"),onMouseOver:()=>c(t),onMouseOut:()=>c(null),children:e})]},t))}),(0,n.jsx)(s.HH,{type:"target",position:s.Ly.Bottom,className:"w-16 !bg-teal-500"}),(0,n.jsx)(s.HH,{type:"source",position:s.Ly.Top,className:"w-16 !bg-teal-500"})]})};var el=a(59734);let es=e=>({modelActivations:e.modelActivations,patchTargetNodes:e.patchTargetNodes,patching:e.patching}),eo=e=>{let{id:t,data:a}=e,{modelActivations:l,patchTargetNodes:o,patching:r}=f(es,i.X),d=r&&!o.has(t);return(0,n.jsxs)("div",{className:"px-2 py-2 w-[12em] shadow-md rounded-md bg-slate-900 border-2 border-stone-950 ".concat(d?"grayscale-[95%]":""),children:[(0,n.jsx)("span",{className:"px-2 py-1 text-sm text-slate-300",children:a.label}),(0,n.jsx)(s.HH,{type:"target",position:s.Ly.Bottom,className:"w-8 !bg-teal-500"}),(0,n.jsx)(s.HH,{type:"source",position:s.Ly.Top,className:"w-8 !bg-teal-500"})]})},er=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return fetch(...t).then(e=>e.json())},ei=(e,t)=>({id:"".concat(e,"-").concat(t),source:e,target:t,deletable:!1}),ed=(e,t)=>{let a="blocks.".concat(e),n="blocks.".concat(e-1);return{layerId:a,prevLayerResidualId:t?"".concat(n,".hook_resid_mid"):"".concat(n,".hook_resid_post"),attnLayerNormNodeId:"".concat(a,".ln1"),patternId:"".concat(a,".pattern"),resultId:"".concat(a,".result"),residualId:"".concat(a,".hook_resid_mid"),mlpLayerNormId:"".concat(a,".ln2"),mlpId:"".concat(a,".mlp"),mlpResidualId:"".concat(a,".hook_resid_post"),modelOutputId:"output"}},ec=e=>({xOffset:120,layerPadding:500,layerInternalPadding:20,layerWidth:40+120*e.n_heads,layerHeight:900,xStartOffset:-400}),eu=(e,t,a)=>{let{layerId:n}=t,{layerWidth:l,xStartOffset:o,layerHeight:r,layerPadding:i}=a;return{id:n,data:{label:"Layer ".concat(e)},deletable:!1,position:{x:-l+o,y:-(e+1)*(r+i)},sourcePosition:s.Ly.Top,targetPosition:s.Ly.Bottom,style:{width:l,height:r,backgroundColor:"rgba(255, 0, 128, 0.05)",textAlign:"left",fontSize:"32px",padding:"24px",color:"#e2e8f080"}}},ep=(e,t)=>{let{layerId:a,attnLayerNormNodeId:n}=e,{layerWidth:l}=t;return{id:n,type:"layerNorm",data:{label:"Layer Norm",inputShapeStrings:["batch","seq","dModel"],outputShapeStrings:["batch","seq","dModel"],slice:[[0,-1],[0,-1],[0,-1]]},deletable:!1,position:{x:l/2-50,y:850},sourcePosition:s.Ly.Top,targetPosition:s.Ly.Bottom,parentNode:a,extent:"parent"}},eh=(e,t,a,n,l)=>{let{layerId:s}=n,{layerInternalPadding:o}=l;return{id:"".concat(s,".").concat(e),type:e,data:{label:"".concat(e),realationId:"".concat(s,".attn.hook_").concat(e[0]),activations:u.nGf([1,5,a,5]),inputShapeStrings:["batch","nHeads","seq","dHead"],outputShapeStrings:["batch","nHeads","seq","dHead"],slice:[[0,-1],[0,-1],[0,-1],[0,-1]]},deletable:!1,position:{x:20+400*t,y:o+("value"===e?200:700)},parentNode:s,extent:"parent"}},em=(e,t,a,n)=>{let{layerId:l,patternId:s}=t,{layerInternalPadding:o}=a;return{id:s,type:"pattern",data:{label:"Pattern",layerNumber:n,realationId:"".concat(l,".attn.hook_pattern"),colourId:0,activations:u.nGf([1,e,5,5]),inputShapeStrings:["batch","nHeads","seq","seq"],outputShapeStrings:["batch","nHeads","seq","seq"],slice:[[0,-1],[0,-1],[0,-1],[0,-1]]},deletable:!1,position:{x:600,y:200+o},parentNode:l,extent:"parent"}},ex=(e,t,a,n)=>{let{layerId:l}=t,{xOffset:s,layerInternalPadding:o}=a;return Array.from({length:e},(t,a)=>{let r="".concat(l,".headPattern").concat(a);return{id:r,type:"headPattern",data:{label:"Head ".concat(a),layerNumber:n,realationId:"".concat(l,".attn.hook_pattern"),relationSliceId:a,colourId:a,activations:u.nGf([1,e,5,5]),inputShapeStrings:["batch","headIdx","seq","seq"],outputShapeStrings:["batch","headIdx","seq","seq"],slice:[[0,-1],[a,a+1],[0,-1],[0,-1]]},deletable:!1,position:{x:20+a*s,y:400+o},parentNode:l,extent:"parent"}})},eg=(e,t,a)=>{let{layerId:n,resultId:l}=t,{layerInternalPadding:s}=a;return{id:l,type:"result",data:{label:"Result",realationId:"".concat(n,".attn.hook_z"),activations:u.nGf([1,e,5,5]),inputShapeStrings:["batch","nHeads","seq","dModel"],outputShapeStrings:["batch","nHeads","seq","dModel"],slice:[[0,-1],[0,-1],[0,-1],[0,-1]]},deletable:!1,position:{x:600,y:s},parentNode:n,extent:"parent"}},ef=(e,t,a)=>{let{layerId:n,residualId:l}=e,{layerHeight:s,layerPadding:o}=t;return{id:l,type:"residual",data:{label:"Residual",realationId:"".concat(n,".hook_resid_mid"),activations:u.nGf([1,5,5]),inputShapeStrings:["batch","seq","dModel"],outputShapeStrings:["batch","seq","dModel"],slice:[[0,-1],[0,-1],[0,-1]]},deletable:!1,position:{x:0,y:-s-o-a*(s+o)-200}}},eb=(e,t,a)=>{let{mlpId:n}=e,{layerHeight:l,layerPadding:s,layerWidth:o}=t;return{id:n,type:"mlp",data:{label:"MLP",inputShapeStrings:["batch","seq","dModel"],outputShapeStrings:["batch","seq","dModel"],slice:[[0,-1],[0,-1],[0,-1]]},deletable:!1,position:{x:-o/2.5,y:-(a+1)*(l+s)-320}}},ey=(e,t,a)=>{let{mlpLayerNormId:n}=e,{layerHeight:l,layerPadding:s,layerWidth:o}=t;return{id:n,type:"layerNorm",data:{label:"Layer Norm",inputShapeStrings:["batch","seq","dModel"],outputShapeStrings:["batch","seq","dModel"],slice:[[0,-1],[0,-1],[0,-1]]},deletable:!1,position:{x:-o/2.5,y:-(a+1)*(l+s)-220}}},ev=(e,t,a)=>{let{layerId:n,mlpResidualId:l}=e,{layerHeight:s,layerPadding:o}=t;return{id:l,type:"residual",data:{label:"Residual",realationId:"".concat(n,".hook_resid_post"),activations:u.nGf([1,5,5]),inputShapeStrings:["batch","seq","dModel"],outputShapeStrings:["batch","seq","dModel"],slice:[[0,-1],[0,-1],[0,-1]]},deletable:!1,position:{x:0,y:-s-o-a*(s+o)-500}}},ej=(e,t,a)=>{let{modelOutputId:n}=e,{layerHeight:l,layerPadding:s}=t;return{id:n,type:"modelOutput",data:{label:"Output",inputShapeStrings:["batch","seq","dModel"],outputShapeStrings:["batch","seq"],slice:[[0,-1],[0,-1],[0,-1]]},deletable:!1,position:{x:-200,y:-l-s-a*(l+s)-500-300}}},ew=e=>{let t=ec(e);var a=[],n=[];for(let l=0;l<e.n_layers;l++){let s=ed(l,e.attn_only);a=[...a,eu(l,s,t),ep(s,t),...["query","key","value"].map((a,n)=>eh(a,n,e.n_heads,s,t)),em(e.n_heads,s,t,l),...ex(e.n_heads,s,t,l),eg(e.n_heads,s,t),ef(s,t,l),...e.attn_only?[]:[ey(s,t,l),eb(s,t,l),ev(s,t,l)],...l===e.n_layers-1?[ej(s,t,l)]:[]],n=[...n,...l>0?[ei(s.prevLayerResidualId,s.layerId)]:[],...["query","key"].flatMap(t=>Array.from({length:e.n_heads},(e,a)=>ei("".concat(s.layerId,".").concat(t),"".concat(s.layerId,".headPattern").concat(a)))),...["query","key","value"].map(e=>ei(s.attnLayerNormNodeId,"".concat(s.layerId,".").concat(e))),...Array.from({length:e.n_heads},(e,t)=>ei("".concat(s.layerId,".headPattern").concat(t),s.patternId)),ei(s.patternId,s.resultId),ei("".concat(s.layerId,".value"),s.resultId),ei(s.resultId,s.residualId),ei(s.prevLayerResidualId,s.residualId),...e.attn_only?[]:[ei(s.residualId,s.mlpResidualId),ei(s.residualId,s.mlpLayerNormId),ei(s.mlpLayerNormId,s.mlpId),ei(s.mlpId,s.mlpResidualId)],...l===e.n_layers-1?[ei(s.mlpResidualId,s.modelOutputId)]:[]]}return[a,n]},eN=e=>({nodes:e.nodes,edges:e.edges,onNodesChange:e.onNodesChange,onEdgesChange:e.onEdgesChange,onConnect:e.onConnect,createNodes:e.createNodes,createEdges:e.createEdges,resetFlow:e.resetFlow,startPatch:e.startPatchEdge,endPatch:e.endPatchEdge,validPatch:e.validPatchEdge,deletePatch:e.deletePatchEdge}),eS=e=>{let{modelConfig:t}=e,{nodes:a,edges:d,onNodesChange:c,onEdgesChange:u,onConnect:p,createNodes:h,createEdges:x,resetFlow:g,startPatch:b,endPatch:y,validPatch:j,deletePatch:w}=f(eN,i.X),N=(0,l.useMemo)(()=>({button:R,default:s.Jd}),[]),S=(0,l.useMemo)(()=>({textInput:H,tokenizedWords:I,token:v,embed:B,key:P,query:P,value:P,headPattern:Y,pattern:Y,result:$,residual:F,layerNorm:W,mlp:eo,modelOutput:en}),[]);return(0,l.useEffect)(()=>{let[e,a]=ew(t);g(),h(e),x(a)},[t]),(0,n.jsx)("div",{style:{width:"100%",height:"100vh"},children:(0,n.jsxs)(s.x$,{nodes:a,edges:d,onNodesChange:c,onEdgesChange:u,nodeTypes:S,edgeTypes:N,onConnect:p,onConnectStart:b,onConnectEnd:y,onEdgesDelete:w,isValidConnection:j,connectionLineStyle:m,fitView:!0,className:"bg-gray-950",minZoom:.05,proOptions:{hideAttribution:!0},children:[(0,n.jsx)(o.a,{maskColor:"rgb(2 6 23)",nodeColor:"rgb(4 47 46)",style:{backgroundColor:"#0f172a"}}),(0,n.jsx)(r.A,{variant:r.T.Dots,gap:24,size:1})]})})},ek=e=>({syncAblations:e.syncAblations}),eI=e=>{let{selectedModel:t="gpt2"}=e,{syncAblations:a}=f(ek,i.X),{data:l,error:s}=(0,el.ZP)("/api/models/getModelConfig/".concat(t),er);if(s)return(0,n.jsx)("div",{children:"Failed to load"});if(!l)return(0,n.jsx)("div",{children:"Loading..."});a();let o=l.config;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eS,{modelConfig:o}),(0,n.jsx)(A,{layerCount:o.n_layers,headCount:o.n_heads})]})},eT=e=>({availableModels:e.availableModels,getAvailableModels:e.getAvailableModels}),eH=e=>{let{onSelect:t}=e,{availableModels:a,getAvailableModels:s}=f(eT,i.X),[o,r]=(0,l.useState)(null);(0,l.useEffect)(()=>{s()},[s]);let d=e=>{r(o===e?null:e)},c=async e=>{try{await fetch("/api/models/setModel",{method:"PUT",headers:{"Content-type":"application/json"},body:JSON.stringify({model_name:e})}),console.log("Selected model: ".concat(e)),t(e)}catch(e){console.error("Failed to select the model:",e)}};return a.length?(0,n.jsx)("div",{className:"p-0 max-h-[90vh] overflow-y-auto rounded-sm text-slate-300",children:a.map((e,t)=>(0,n.jsxs)("div",{className:"text-sm bg-slate-800 m-1 w-[600px]",children:[(0,n.jsxs)("div",{className:"bg-gray-700 p-1 flex justify-between items-center rounded-sm",children:[(0,n.jsxs)("div",{className:"px-0.5",onClick:()=>d(t),style:{cursor:"pointer",display:"flex",alignItems:"center"},children:[(0,n.jsx)("div",{style:{marginRight:"10px"},children:o===t?"-":"+"}),(0,n.jsx)("p",{children:e.model_name})]}),(0,n.jsx)("button",{className:"bg-slate-500/20 text-xs py-1 px-2 rounded-sm",onClick:()=>c(e.model_name),children:"Load"})]}),o===t&&(0,n.jsx)("div",{className:"p-1",children:(0,n.jsx)("table",{children:(0,n.jsx)("tbody",{className:"text-xs",children:Object.entries(e).map((e,t)=>{let[a,l]=e;return(0,n.jsxs)("tr",{children:[(0,n.jsxs)("td",{className:"text-gray-300 pr-2",children:[a,":"]}),(0,n.jsx)("td",{className:"text-gray-200",children:JSON.stringify(l)})]},t)})})})})]},t))}):(0,n.jsx)("div",{children:"Loading..."})},eA=e=>{let{onClose:t,selectedModel:a}=e;return(0,n.jsx)("div",{className:"z-50 fixed top-0 left-0 w-full h-full bg-black bg-opacity-25 flex items-center",children:(0,n.jsxs)("div",{className:"ml-12 bg-gray-800 rounded-lg relative",children:[(0,n.jsx)("button",{className:"absolute top-[-16px] right-[-8px] text-white text-xl font-semibold",onClick:()=>t(a),children:"\xd7"}),(0,n.jsx)(eH,{onSelect:t})]})})},eL=e=>{let{onClick:t,selectedModel:a}=e;return(0,n.jsx)("button",{className:"bg-slate-900 shadow-lg outline rounded-md outline-2 outline-slate-200/20 w-10 h-10 font-semibold fixed top-4 left-4",onClick:t,children:(0,n.jsx)("span",{className:"text-xs text-slate-300 font-light",children:a})})};var eM=a(5152),eC=a.n(eM);a(11004);let e_=eC()(()=>Promise.all([a.e(524),a.e(5861)]).then(a.bind(a,65861)),{loadableGenerated:{webpack:()=>[65861]},ssr:!1}),eP=eC()(()=>Promise.all([a.e(524),a.e(5934)]).then(a.bind(a,15934)),{loadableGenerated:{webpack:()=>[15934]},ssr:!1}),eO=eC()(()=>Promise.all([a.e(2440),a.e(8149),a.e(5762),a.e(571),a.e(9794),a.e(728),a.e(8724)]).then(a.bind(a,84259)),{loadableGenerated:{webpack:()=>[84259]},ssr:!1}),eE=()=>{let[e,t]=(0,l.useState)(!1),[a,s]=(0,l.useState)("gpt2");return(0,n.jsx)("div",{className:"w-[100vw] h-[100vh]",children:(0,n.jsxs)(e_,{children:[(0,n.jsx)(eP,{minSize:200,children:(0,n.jsxs)("div",{children:[(0,n.jsx)(eI,{selectedModel:a}),e&&(0,n.jsx)(eA,{selectedModel:a,onClose:e=>{t(!1),s(null!=e?e:a)}}),(0,n.jsx)(eL,{onClick:()=>t(!0),selectedModel:a})]})}),(0,n.jsx)(eP,{snap:!0,children:(0,n.jsx)(eO,{})})]})})};function eR(){return(0,n.jsx)("main",{className:"bg-gray-950 flex min-h-screen flex-col items-center justify-between ",children:(0,n.jsx)(eE,{})})}},75410:function(){},48628:function(){},31601:function(){},67792:function(){},34977:function(){},75042:function(){}},function(e){e.O(0,[864,904,295,2723,5974,3132,2773,4651,9547,5301,2888,179],function(){return e(e.s=48312)}),_N_E=e.O()}]);