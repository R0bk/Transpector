"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9794],{6654:function(e,t,i){i.d(t,{$L:function(){return J},LN:function(){return ee},Po:function(){return eo},Rh:function(){return eg},jN:function(){return eh},nj:function(){return eu},s_:function(){return en},xV:function(){return ec}});var s,n,r,a,o,h,d,l,c,u,m,p,g,_,f,b,v,M,w,y,x,S,I,C,z,A,B,T,E,R,L,D,k,H,N,W=i(35259),O=i(95082),P=i(19150),q=i(59523),F=i(39770),$=i(4016),V=i(17303),U=i(45159),Y=i(37135),K=i(70725),X=i(27347);class G{constructor(){this.sizeHint=0,this.minSize=0,this.maxSize=1/0,this.stretch=1,this.size=0,this.done=!1}}(s=_||(_={})).calc=function(e,t){let i=e.length;if(0===i)return t;let s=0,n=0,r=0,a=0,o=0;for(let t=0;t<i;++t){let i=e[t],h=i.minSize,d=i.maxSize,l=i.sizeHint;i.done=!1,i.size=Math.max(h,Math.min(l,d)),r+=i.size,s+=h,n+=d,i.stretch>0&&(a+=i.stretch,o++)}if(t===r)return 0;if(t<=s){for(let t=0;t<i;++t){let i=e[t];i.size=i.minSize}return t-s}if(t>=n){for(let t=0;t<i;++t){let i=e[t];i.size=i.maxSize}return t-n}let h=i;if(t<r){let s=r-t;for(;o>0&&s>.01;){let t=s,n=a;for(let r=0;r<i;++r){let i=e[r];if(i.done||0===i.stretch)continue;let d=i.stretch*t/n;i.size-d<=i.minSize?(s-=i.size-i.minSize,a-=i.stretch,i.size=i.minSize,i.done=!0,h--,o--):(s-=d,i.size-=d)}}for(;h>0&&s>.01;){let t=s/h;for(let n=0;n<i;++n){let i=e[n];!i.done&&(i.size-t<=i.minSize?(s-=i.size-i.minSize,i.size=i.minSize,i.done=!0,h--):(s-=t,i.size-=t))}}}else{let s=t-r;for(;o>0&&s>.01;){let t=s,n=a;for(let r=0;r<i;++r){let i=e[r];if(i.done||0===i.stretch)continue;let d=i.stretch*t/n;i.size+d>=i.maxSize?(s-=i.maxSize-i.size,a-=i.stretch,i.size=i.maxSize,i.done=!0,h--,o--):(s-=d,i.size+=d)}}for(;h>0&&s>.01;){let t=s/h;for(let n=0;n<i;++n){let i=e[n];!i.done&&(i.size+t>=i.maxSize?(s-=i.maxSize-i.size,i.size=i.maxSize,i.done=!0,h--):(s-=t,i.size+=t))}}}return 0},s.adjust=function(e,t,i){0!==e.length&&0!==i&&(i>0?function(e,t,i){let s=0;for(let i=0;i<=t;++i){let t=e[i];s+=t.maxSize-t.size}let n=0;for(let i=t+1,s=e.length;i<s;++i){let t=e[i];n+=t.size-t.minSize}let r=i=Math.min(i,s,n);for(let i=t;i>=0&&r>0;--i){let t=e[i],s=t.maxSize-t.size;s>=r?(t.sizeHint=t.size+r,r=0):(t.sizeHint=t.size+s,r-=s)}let a=i;for(let i=t+1,s=e.length;i<s&&a>0;++i){let t=e[i],s=t.size-t.minSize;s>=a?(t.sizeHint=t.size-a,a=0):(t.sizeHint=t.size-s,a-=s)}}(e,t,i):function(e,t,i){let s=0;for(let i=t+1,n=e.length;i<n;++i){let t=e[i];s+=t.maxSize-t.size}let n=0;for(let i=0;i<=t;++i){let t=e[i];n+=t.size-t.minSize}let r=i=Math.min(i,s,n);for(let i=t+1,s=e.length;i<s&&r>0;++i){let t=e[i],s=t.maxSize-t.size;s>=r?(t.sizeHint=t.size+r,r=0):(t.sizeHint=t.size+s,r-=s)}let a=i;for(let i=t;i>=0&&a>0;--i){let t=e[i],s=t.size-t.minSize;s>=a?(t.sizeHint=t.size-a,a=0):(t.sizeHint=t.size-s,a-=s)}}(e,t,-i))};class j{constructor(e){this._label="",this._caption="",this._mnemonic=-1,this._icon=void 0,this._iconClass="",this._iconLabel="",this._className="",this._closable=!1,this._changed=new $.Signal(this),this._isDisposed=!1,this.owner=e.owner,void 0!==e.label&&(this._label=e.label),void 0!==e.mnemonic&&(this._mnemonic=e.mnemonic),void 0!==e.icon&&(this._icon=e.icon),void 0!==e.iconClass&&(this._iconClass=e.iconClass),void 0!==e.iconLabel&&(this._iconLabel=e.iconLabel),void 0!==e.caption&&(this._caption=e.caption),void 0!==e.className&&(this._className=e.className),void 0!==e.closable&&(this._closable=e.closable),this._dataset=e.dataset||{}}get changed(){return this._changed}get label(){return this._label}set label(e){this._label!==e&&(this._label=e,this._changed.emit(void 0))}get mnemonic(){return this._mnemonic}set mnemonic(e){this._mnemonic!==e&&(this._mnemonic=e,this._changed.emit(void 0))}get icon(){return this._icon}set icon(e){this._icon!==e&&(this._icon=e,this._changed.emit(void 0))}get iconClass(){return this._iconClass}set iconClass(e){this._iconClass!==e&&(this._iconClass=e,this._changed.emit(void 0))}get iconLabel(){return this._iconLabel}set iconLabel(e){this._iconLabel!==e&&(this._iconLabel=e,this._changed.emit(void 0))}get caption(){return this._caption}set caption(e){this._caption!==e&&(this._caption=e,this._changed.emit(void 0))}get className(){return this._className}set className(e){this._className!==e&&(this._className=e,this._changed.emit(void 0))}get closable(){return this._closable}set closable(e){this._closable!==e&&(this._closable=e,this._changed.emit(void 0))}get dataset(){return this._dataset}set dataset(e){this._dataset!==e&&(this._dataset=e,this._changed.emit(void 0))}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,$.Signal.clearData(this))}}class J{constructor(e={}){this._flags=0,this._layout=null,this._parent=null,this._disposed=new $.Signal(this),this._hiddenMode=J.HiddenMode.Display,this.node=f.createNode(e),this.addClass("lm-Widget")}dispose(){this.isDisposed||(this.setFlag(J.Flag.IsDisposed),this._disposed.emit(void 0),this.parent?this.parent=null:this.isAttached&&J.detach(this),this._layout&&(this._layout.dispose(),this._layout=null),this.title.dispose(),$.Signal.clearData(this),q.pB.clearData(this),F.AttachedProperty.clearData(this))}get disposed(){return this._disposed}get isDisposed(){return this.testFlag(J.Flag.IsDisposed)}get isAttached(){return this.testFlag(J.Flag.IsAttached)}get isHidden(){return this.testFlag(J.Flag.IsHidden)}get isVisible(){return this.testFlag(J.Flag.IsVisible)}get title(){return f.titleProperty.get(this)}get id(){return this.node.id}set id(e){this.node.id=e}get dataset(){return this.node.dataset}get hiddenMode(){return this._hiddenMode}set hiddenMode(e){this._hiddenMode!==e&&(this.isHidden&&this._toggleHidden(!1),e==J.HiddenMode.Scale?this.node.style.willChange="transform":this.node.style.willChange="auto",this._hiddenMode=e,this.isHidden&&this._toggleHidden(!0))}get parent(){return this._parent}set parent(e){if(this._parent!==e){if(e&&this.contains(e))throw Error("Invalid parent widget.");if(this._parent&&!this._parent.isDisposed){let e=new J.ChildMessage("child-removed",this);q.pB.sendMessage(this._parent,e)}if(this._parent=e,this._parent&&!this._parent.isDisposed){let e=new J.ChildMessage("child-added",this);q.pB.sendMessage(this._parent,e)}this.isDisposed||q.pB.sendMessage(this,J.Msg.ParentChanged)}}get layout(){return this._layout}set layout(e){if(this._layout!==e){if(this.testFlag(J.Flag.DisallowLayout))throw Error("Cannot set widget layout.");if(this._layout)throw Error("Cannot change widget layout.");if(e.parent)throw Error("Cannot change layout parent.");this._layout=e,e.parent=this}}*children(){this._layout&&(yield*this._layout)}contains(e){for(let t=e;t;t=t._parent)if(t===this)return!0;return!1}hasClass(e){return this.node.classList.contains(e)}addClass(e){this.node.classList.add(e)}removeClass(e){this.node.classList.remove(e)}toggleClass(e,t){return!0===t?(this.node.classList.add(e),!0):!1===t?(this.node.classList.remove(e),!1):this.node.classList.toggle(e)}update(){q.pB.postMessage(this,J.Msg.UpdateRequest)}fit(){q.pB.postMessage(this,J.Msg.FitRequest)}activate(){q.pB.postMessage(this,J.Msg.ActivateRequest)}close(){q.pB.sendMessage(this,J.Msg.CloseRequest)}show(){if(this.testFlag(J.Flag.IsHidden)&&(this.isAttached&&(!this.parent||this.parent.isVisible)&&q.pB.sendMessage(this,J.Msg.BeforeShow),this.clearFlag(J.Flag.IsHidden),this._toggleHidden(!1),this.isAttached&&(!this.parent||this.parent.isVisible)&&q.pB.sendMessage(this,J.Msg.AfterShow),this.parent)){let e=new J.ChildMessage("child-shown",this);q.pB.sendMessage(this.parent,e)}}hide(){if(!this.testFlag(J.Flag.IsHidden)&&(this.isAttached&&(!this.parent||this.parent.isVisible)&&q.pB.sendMessage(this,J.Msg.BeforeHide),this.setFlag(J.Flag.IsHidden),this._toggleHidden(!0),this.isAttached&&(!this.parent||this.parent.isVisible)&&q.pB.sendMessage(this,J.Msg.AfterHide),this.parent)){let e=new J.ChildMessage("child-hidden",this);q.pB.sendMessage(this.parent,e)}}setHidden(e){e?this.hide():this.show()}testFlag(e){return(this._flags&e)!=0}setFlag(e){this._flags|=e}clearFlag(e){this._flags&=~e}processMessage(e){switch(e.type){case"resize":this.notifyLayout(e),this.onResize(e);break;case"update-request":this.notifyLayout(e),this.onUpdateRequest(e);break;case"fit-request":this.notifyLayout(e),this.onFitRequest(e);break;case"before-show":this.notifyLayout(e),this.onBeforeShow(e);break;case"after-show":this.setFlag(J.Flag.IsVisible),this.notifyLayout(e),this.onAfterShow(e);break;case"before-hide":this.notifyLayout(e),this.onBeforeHide(e);break;case"after-hide":this.clearFlag(J.Flag.IsVisible),this.notifyLayout(e),this.onAfterHide(e);break;case"before-attach":this.notifyLayout(e),this.onBeforeAttach(e);break;case"after-attach":this.isHidden||this.parent&&!this.parent.isVisible||this.setFlag(J.Flag.IsVisible),this.setFlag(J.Flag.IsAttached),this.notifyLayout(e),this.onAfterAttach(e);break;case"before-detach":this.notifyLayout(e),this.onBeforeDetach(e);break;case"after-detach":this.clearFlag(J.Flag.IsVisible),this.clearFlag(J.Flag.IsAttached),this.notifyLayout(e),this.onAfterDetach(e);break;case"activate-request":this.notifyLayout(e),this.onActivateRequest(e);break;case"close-request":this.notifyLayout(e),this.onCloseRequest(e);break;case"child-added":this.notifyLayout(e),this.onChildAdded(e);break;case"child-removed":this.notifyLayout(e),this.onChildRemoved(e);break;default:this.notifyLayout(e)}}notifyLayout(e){this._layout&&this._layout.processParentMessage(e)}onCloseRequest(e){this.parent?this.parent=null:this.isAttached&&J.detach(this)}onResize(e){}onUpdateRequest(e){}onFitRequest(e){}onActivateRequest(e){}onBeforeShow(e){}onAfterShow(e){}onBeforeHide(e){}onAfterHide(e){}onBeforeAttach(e){}onAfterAttach(e){}onBeforeDetach(e){}onAfterDetach(e){}onChildAdded(e){}onChildRemoved(e){}_toggleHidden(e){if(e)switch(this._hiddenMode){case J.HiddenMode.Display:this.addClass("lm-mod-hidden");break;case J.HiddenMode.Scale:this.node.style.transform="scale(0)",this.node.setAttribute("aria-hidden","true");break;case J.HiddenMode.ContentVisibility:this.node.style.contentVisibility="hidden",this.node.style.zIndex="-1"}else switch(this._hiddenMode){case J.HiddenMode.Display:this.removeClass("lm-mod-hidden");break;case J.HiddenMode.Scale:this.node.style.transform="",this.node.removeAttribute("aria-hidden");break;case J.HiddenMode.ContentVisibility:this.node.style.contentVisibility="",this.node.style.zIndex=""}}}!function(e){var t,i,s,n;(t=e.HiddenMode||(e.HiddenMode={}))[t.Display=0]="Display",t[t.Scale=1]="Scale",t[t.ContentVisibility=2]="ContentVisibility",(i=e.Flag||(e.Flag={}))[i.IsDisposed=1]="IsDisposed",i[i.IsAttached=2]="IsAttached",i[i.IsHidden=4]="IsHidden",i[i.IsVisible=8]="IsVisible",i[i.DisallowLayout=16]="DisallowLayout",(s=e.Msg||(e.Msg={})).BeforeShow=new q.v0("before-show"),s.AfterShow=new q.v0("after-show"),s.BeforeHide=new q.v0("before-hide"),s.AfterHide=new q.v0("after-hide"),s.BeforeAttach=new q.v0("before-attach"),s.AfterAttach=new q.v0("after-attach"),s.BeforeDetach=new q.v0("before-detach"),s.AfterDetach=new q.v0("after-detach"),s.ParentChanged=new q.v0("parent-changed"),s.UpdateRequest=new q.Af("update-request"),s.FitRequest=new q.Af("fit-request"),s.ActivateRequest=new q.Af("activate-request"),s.CloseRequest=new q.Af("close-request");class r extends q.v0{constructor(e,t){super(e),this.child=t}}e.ChildMessage=r;class a extends q.v0{constructor(e,t){super("resize"),this.width=e,this.height=t}}e.ResizeMessage=a,(n=a=e.ResizeMessage||(e.ResizeMessage={})).UnknownSize=new n(-1,-1),e.attach=function(t,i,s=null){if(t.parent)throw Error("Cannot attach a child widget.");if(t.isAttached||t.node.isConnected)throw Error("Widget is already attached.");if(!i.isConnected)throw Error("Host is not attached.");q.pB.sendMessage(t,e.Msg.BeforeAttach),i.insertBefore(t.node,s),q.pB.sendMessage(t,e.Msg.AfterAttach)},e.detach=function(t){if(t.parent)throw Error("Cannot detach a child widget.");if(!t.isAttached||!t.node.isConnected)throw Error("Widget is not attached.");q.pB.sendMessage(t,e.Msg.BeforeDetach),t.node.parentNode.removeChild(t.node),q.pB.sendMessage(t,e.Msg.AfterDetach)}}(J||(J={})),(n=f||(f={})).titleProperty=new F.AttachedProperty({name:"title",create:e=>new j({owner:e})}),n.createNode=function(e){return e.node||document.createElement(e.tag||"div")};class Q{constructor(e={}){this._disposed=!1,this._parent=null,this._fitPolicy=e.fitPolicy||"set-min-size"}dispose(){this._parent=null,this._disposed=!0,$.Signal.clearData(this),F.AttachedProperty.clearData(this)}get isDisposed(){return this._disposed}get parent(){return this._parent}set parent(e){if(this._parent!==e){if(this._parent)throw Error("Cannot change parent widget.");if(e.layout!==this)throw Error("Invalid parent widget.");this._parent=e,this.init()}}get fitPolicy(){return this._fitPolicy}set fitPolicy(e){if(this._fitPolicy!==e&&(this._fitPolicy=e,this._parent)){let e=this._parent.node.style;e.minWidth="",e.minHeight="",e.maxWidth="",e.maxHeight="",this._parent.fit()}}processParentMessage(e){switch(e.type){case"resize":this.onResize(e);break;case"update-request":this.onUpdateRequest(e);break;case"fit-request":this.onFitRequest(e);break;case"before-show":this.onBeforeShow(e);break;case"after-show":this.onAfterShow(e);break;case"before-hide":this.onBeforeHide(e);break;case"after-hide":this.onAfterHide(e);break;case"before-attach":this.onBeforeAttach(e);break;case"after-attach":this.onAfterAttach(e);break;case"before-detach":this.onBeforeDetach(e);break;case"after-detach":this.onAfterDetach(e);break;case"child-removed":this.onChildRemoved(e);break;case"child-shown":this.onChildShown(e);break;case"child-hidden":this.onChildHidden(e)}}init(){for(let e of this)e.parent=this.parent}onResize(e){for(let e of this)q.pB.sendMessage(e,J.ResizeMessage.UnknownSize)}onUpdateRequest(e){for(let e of this)q.pB.sendMessage(e,J.ResizeMessage.UnknownSize)}onBeforeAttach(e){for(let t of this)q.pB.sendMessage(t,e)}onAfterAttach(e){for(let t of this)q.pB.sendMessage(t,e)}onBeforeDetach(e){for(let t of this)q.pB.sendMessage(t,e)}onAfterDetach(e){for(let t of this)q.pB.sendMessage(t,e)}onBeforeShow(e){for(let t of this)t.isHidden||q.pB.sendMessage(t,e)}onAfterShow(e){for(let t of this)t.isHidden||q.pB.sendMessage(t,e)}onBeforeHide(e){for(let t of this)t.isHidden||q.pB.sendMessage(t,e)}onAfterHide(e){for(let t of this)t.isHidden||q.pB.sendMessage(t,e)}onChildRemoved(e){this.removeWidget(e.child)}onFitRequest(e){}onChildShown(e){}onChildHidden(e){}}(r=Q||(Q={})).getHorizontalAlignment=function(e){return b.horizontalAlignmentProperty.get(e)},r.setHorizontalAlignment=function(e,t){b.horizontalAlignmentProperty.set(e,t)},r.getVerticalAlignment=function(e){return b.verticalAlignmentProperty.get(e)},r.setVerticalAlignment=function(e,t){b.verticalAlignmentProperty.set(e,t)};class Z{constructor(e){this._top=NaN,this._left=NaN,this._width=NaN,this._height=NaN,this._minWidth=0,this._minHeight=0,this._maxWidth=1/0,this._maxHeight=1/0,this._disposed=!1,this.widget=e,this.widget.node.style.position="absolute",this.widget.node.style.contain="strict"}dispose(){if(this._disposed)return;this._disposed=!0;let e=this.widget.node.style;e.position="",e.top="",e.left="",e.width="",e.height="",e.contain=""}get minWidth(){return this._minWidth}get minHeight(){return this._minHeight}get maxWidth(){return this._maxWidth}get maxHeight(){return this._maxHeight}get isDisposed(){return this._disposed}get isHidden(){return this.widget.isHidden}get isVisible(){return this.widget.isVisible}get isAttached(){return this.widget.isAttached}fit(){let e=P.TE.sizeLimits(this.widget.node);this._minWidth=e.minWidth,this._minHeight=e.minHeight,this._maxWidth=e.maxWidth,this._maxHeight=e.maxHeight}update(e,t,i,s){let n=Math.max(this._minWidth,Math.min(i,this._maxWidth)),r=Math.max(this._minHeight,Math.min(s,this._maxHeight));if(n<i)switch(Q.getHorizontalAlignment(this.widget)){case"left":break;case"center":e+=(i-n)/2;break;case"right":e+=i-n;break;default:throw"unreachable"}if(r<s)switch(Q.getVerticalAlignment(this.widget)){case"top":break;case"center":t+=(s-r)/2;break;case"bottom":t+=s-r;break;default:throw"unreachable"}let a=!1,o=this.widget.node.style;if(this._top!==t&&(this._top=t,o.top=`${t}px`),this._left!==e&&(this._left=e,o.left=`${e}px`),this._width!==n&&(a=!0,this._width=n,o.width=`${n}px`),this._height!==r&&(a=!0,this._height=r,o.height=`${r}px`),a){let e=new J.ResizeMessage(n,r);q.pB.sendMessage(this.widget,e)}}}!function(e){function t(e){e.parent&&e.parent.layout&&e.parent.update()}e.horizontalAlignmentProperty=new F.AttachedProperty({name:"horizontalAlignment",create:()=>"center",changed:t}),e.verticalAlignmentProperty=new F.AttachedProperty({name:"verticalAlignment",create:()=>"top",changed:t})}(b||(b={}));class ee extends Q{constructor(){super(...arguments),this._widgets=[]}dispose(){for(;this._widgets.length>0;)this._widgets.pop().dispose();super.dispose()}get widgets(){return this._widgets}*[Symbol.iterator](){yield*this._widgets}addWidget(e){this.insertWidget(this._widgets.length,e)}insertWidget(e,t){t.parent=this.parent;let i=this._widgets.indexOf(t),s=Math.max(0,Math.min(e,this._widgets.length));if(-1===i){W.RO.insert(this._widgets,s,t),this.parent&&this.attachWidget(s,t);return}s===this._widgets.length&&s--,i!==s&&(W.RO.move(this._widgets,i,s),this.parent&&this.moveWidget(i,s,t))}removeWidget(e){this.removeWidgetAt(this._widgets.indexOf(e))}removeWidgetAt(e){let t=W.RO.removeAt(this._widgets,e);t&&this.parent&&this.detachWidget(e,t)}init(){super.init();let e=0;for(let t of this)this.attachWidget(e++,t)}attachWidget(e,t){let i=this.parent.node.children[e];this.parent.isAttached&&q.pB.sendMessage(t,J.Msg.BeforeAttach),this.parent.node.insertBefore(t.node,i),this.parent.isAttached&&q.pB.sendMessage(t,J.Msg.AfterAttach)}moveWidget(e,t,i){this.parent.isAttached&&q.pB.sendMessage(i,J.Msg.BeforeDetach),this.parent.node.removeChild(i.node),this.parent.isAttached&&q.pB.sendMessage(i,J.Msg.AfterDetach);let s=this.parent.node.children[t];this.parent.isAttached&&q.pB.sendMessage(i,J.Msg.BeforeAttach),this.parent.node.insertBefore(i.node,s),this.parent.isAttached&&q.pB.sendMessage(i,J.Msg.AfterAttach)}detachWidget(e,t){this.parent.isAttached&&q.pB.sendMessage(t,J.Msg.BeforeDetach),this.parent.node.removeChild(t.node),this.parent.isAttached&&q.pB.sendMessage(t,J.Msg.AfterDetach)}}(v||(v={})).clampDimension=function(e){return Math.max(0,Math.floor(e))};var et=v;class ei extends ee{constructor(e){super(),this.widgetOffset=0,this._fixed=0,this._spacing=4,this._dirty=!1,this._hasNormedSizes=!1,this._sizers=[],this._items=[],this._handles=[],this._box=null,this._alignment="start",this._orientation="horizontal",this.renderer=e.renderer,void 0!==e.orientation&&(this._orientation=e.orientation),void 0!==e.alignment&&(this._alignment=e.alignment),void 0!==e.spacing&&(this._spacing=v.clampDimension(e.spacing))}dispose(){for(let e of this._items)e.dispose();this._box=null,this._items.length=0,this._sizers.length=0,this._handles.length=0,super.dispose()}get orientation(){return this._orientation}set orientation(e){this._orientation!==e&&(this._orientation=e,this.parent&&(this.parent.dataset.orientation=e,this.parent.fit()))}get alignment(){return this._alignment}set alignment(e){this._alignment!==e&&(this._alignment=e,this.parent&&(this.parent.dataset.alignment=e,this.parent.update()))}get spacing(){return this._spacing}set spacing(e){e=v.clampDimension(e),this._spacing!==e&&(this._spacing=e,this.parent&&this.parent.fit())}get handles(){return this._handles}absoluteSizes(){return this._sizers.map(e=>e.size)}relativeSizes(){return M.normalize(this._sizers.map(e=>e.size))}setRelativeSizes(e,t=!0){let i=this._sizers.length,s=e.slice(0,i);for(;s.length<i;)s.push(0);let n=M.normalize(s);for(let e=0;e<i;++e){let t=this._sizers[e];t.sizeHint=n[e],t.size=n[e]}this._hasNormedSizes=!0,t&&this.parent&&this.parent.update()}moveHandle(e,t){let i,s=this._handles[e];if(!(!s||s.classList.contains("lm-mod-hidden"))&&0!=(i="horizontal"===this._orientation?t-s.offsetLeft:t-s.offsetTop)){for(let e of this._sizers)e.size>0&&(e.sizeHint=e.size);_.adjust(this._sizers,e,i),this.parent&&this.parent.update()}}init(){this.parent.dataset.orientation=this.orientation,this.parent.dataset.alignment=this.alignment,super.init()}attachWidget(e,t){let i=new Z(t),s=M.createHandle(this.renderer),n=M.averageSize(this._sizers),r=M.createSizer(n);W.RO.insert(this._items,e,i),W.RO.insert(this._sizers,e,r),W.RO.insert(this._handles,e,s),this.parent.isAttached&&q.pB.sendMessage(t,J.Msg.BeforeAttach),this.parent.node.appendChild(t.node),this.parent.node.appendChild(s),this.parent.isAttached&&q.pB.sendMessage(t,J.Msg.AfterAttach),this.parent.fit()}moveWidget(e,t,i){W.RO.move(this._items,e,t),W.RO.move(this._sizers,e,t),W.RO.move(this._handles,e,t),this.parent.fit()}detachWidget(e,t){let i=W.RO.removeAt(this._items,e),s=W.RO.removeAt(this._handles,e);W.RO.removeAt(this._sizers,e),this.parent.isAttached&&q.pB.sendMessage(t,J.Msg.BeforeDetach),this.parent.node.removeChild(t.node),this.parent.node.removeChild(s),this.parent.isAttached&&q.pB.sendMessage(t,J.Msg.AfterDetach),i.dispose(),this.parent.fit()}onBeforeShow(e){super.onBeforeShow(e),this.parent.update()}onBeforeAttach(e){super.onBeforeAttach(e),this.parent.fit()}onChildShown(e){this.parent.fit()}onChildHidden(e){this.parent.fit()}onResize(e){this.parent.isVisible&&this._update(e.width,e.height)}onUpdateRequest(e){this.parent.isVisible&&this._update(-1,-1)}onFitRequest(e){this.parent.isAttached&&this._fit()}updateItemPosition(e,t,i,s,n,r,a){let o=this._items[e];if(o.isHidden)return;let h=this._handles[e].style;t?(i+=this.widgetOffset,o.update(i,s,a,n),i+=a,h.top=`${s}px`,h.left=`${i}px`,h.width=`${this._spacing}px`,h.height=`${n}px`):(s+=this.widgetOffset,o.update(i,s,r,a),s+=a,h.top=`${s}px`,h.left=`${i}px`,h.width=`${r}px`,h.height=`${this._spacing}px`)}_fit(){let e=0,t=-1;for(let i=0,s=this._items.length;i<s;++i)this._items[i].isHidden?this._handles[i].classList.add("lm-mod-hidden"):(this._handles[i].classList.remove("lm-mod-hidden"),t=i,e++);-1!==t&&this._handles[t].classList.add("lm-mod-hidden"),this._fixed=this._spacing*Math.max(0,e-1)+this.widgetOffset*this._items.length;let i="horizontal"===this._orientation,s=i?this._fixed:0,n=i?0:this._fixed;for(let e=0,t=this._items.length;e<t;++e){let t=this._items[e],r=this._sizers[e];if(r.size>0&&(r.sizeHint=r.size),t.isHidden){r.minSize=0,r.maxSize=0;continue}t.fit(),r.stretch=ei.getStretch(t.widget),i?(r.minSize=t.minWidth,r.maxSize=t.maxWidth,s+=t.minWidth,n=Math.max(n,t.minHeight)):(r.minSize=t.minHeight,r.maxSize=t.maxHeight,n+=t.minHeight,s=Math.max(s,t.minWidth))}let r=this._box=P.TE.boxSizing(this.parent.node);s+=r.horizontalSum,n+=r.verticalSum;let a=this.parent.node.style;a.minWidth=`${s}px`,a.minHeight=`${n}px`,this._dirty=!0,this.parent.parent&&q.pB.sendMessage(this.parent.parent,J.Msg.FitRequest),this._dirty&&q.pB.sendMessage(this.parent,J.Msg.UpdateRequest)}_update(e,t){this._dirty=!1;let i=0;for(let e=0,t=this._items.length;e<t;++e)i+=+!this._items[e].isHidden;if(0===i&&0===this.widgetOffset)return;e<0&&(e=this.parent.node.offsetWidth),t<0&&(t=this.parent.node.offsetHeight),this._box||(this._box=P.TE.boxSizing(this.parent.node));let s=this._box.paddingTop,n=this._box.paddingLeft,r=e-this._box.horizontalSum,a=t-this._box.verticalSum,o=0,h=0,d="horizontal"===this._orientation;if(i>0){let e;if(e=d?Math.max(0,r-this._fixed):Math.max(0,a-this._fixed),this._hasNormedSizes){for(let t of this._sizers)t.sizeHint*=e;this._hasNormedSizes=!1}let t=_.calc(this._sizers,e);if(t>0)switch(this._alignment){case"start":break;case"center":o=0,h=t/2;break;case"end":o=0,h=t;break;case"justify":o=t/i,h=0;break;default:throw"unreachable"}}for(let e=0,t=this._items.length;e<t;++e){let t=this._items[e],i=t.isHidden?0:this._sizers[e].size+o;this.updateItemPosition(e,d,d?n+h:n,d?s:s+h,a,r,i);let l=this.widgetOffset+(this._handles[e].classList.contains("lm-mod-hidden")?0:this._spacing);d?n+=i+l:s+=i+l}}}(a=ei||(ei={})).getStretch=function(e){return M.stretchProperty.get(e)},a.setStretch=function(e,t){M.stretchProperty.set(e,t)},(o=M||(M={})).stretchProperty=new F.AttachedProperty({name:"stretch",create:()=>0,coerce:(e,t)=>Math.max(0,Math.floor(t)),changed:function(e){e.parent&&e.parent.layout instanceof ei&&e.parent.fit()}}),o.createSizer=function(e){let t=new G;return t.sizeHint=Math.floor(e),t},o.createHandle=function(e){let t=e.createHandle();return t.style.position="absolute",t.style.contain="style",t},o.averageSize=function(e){return e.reduce((e,t)=>e+t.size,0)/e.length||0},o.normalize=function(e){let t=e.length;if(0===t)return[];let i=e.reduce((e,t)=>e+Math.abs(t),0);return 0===i?e.map(e=>1/t):e.map(e=>e/i)};class es extends ei{constructor(e){super({...e,orientation:e.orientation||"vertical"}),this._titles=[],this.titleSpace=e.titleSpace||22}get titleSpace(){return this.widgetOffset}set titleSpace(e){e=et.clampDimension(e),this.widgetOffset!==e&&(this.widgetOffset=e,this.parent&&this.parent.fit())}get titles(){return this._titles}dispose(){this.isDisposed||(this._titles.length=0,super.dispose())}updateTitle(e,t){let i=this._titles[e],s=i.classList.contains("lm-mod-expanded"),n=w.createTitle(this.renderer,t.title,s);this._titles[e]=n,this.parent.node.replaceChild(n,i)}insertWidget(e,t){t.id||(t.id=`id-${O.UUID.uuid4()}`),super.insertWidget(e,t)}attachWidget(e,t){let i=w.createTitle(this.renderer,t.title);W.RO.insert(this._titles,e,i),this.parent.node.appendChild(i),t.node.setAttribute("role","region"),t.node.setAttribute("aria-labelledby",i.id),super.attachWidget(e,t)}moveWidget(e,t,i){W.RO.move(this._titles,e,t),super.moveWidget(e,t,i)}detachWidget(e,t){let i=W.RO.removeAt(this._titles,e);this.parent.node.removeChild(i),super.detachWidget(e,t)}updateItemPosition(e,t,i,s,n,r,a){let o=this._titles[e].style;o.top=`${s}px`,o.left=`${i}px`,o.height=`${this.widgetOffset}px`,t?o.width=`${n}px`:o.width=`${r}px`,super.updateItemPosition(e,t,i,s,n,r,a)}}(w||(w={})).createTitle=function(e,t,i=!0){let s=e.createSectionTitle(t);return s.style.position="absolute",s.style.contain="strict",s.setAttribute("aria-label",`${t.label} Section`),s.setAttribute("aria-expanded",i?"true":"false"),s.setAttribute("aria-controls",t.owner.id),i&&s.classList.add("lm-mod-expanded"),s};class en extends J{constructor(e={}){super(),this.addClass("lm-Panel"),this.layout=y.createLayout(e)}get widgets(){return this.layout.widgets}addWidget(e){this.layout.addWidget(e)}insertWidget(e,t){this.layout.insertWidget(e,t)}}(y||(y={})).createLayout=function(e){return e.layout||new ee};class er extends en{constructor(e={}){super({layout:x.createLayout(e)}),this._handleMoved=new $.Signal(this),this._pressData=null,this.addClass("lm-SplitPanel")}dispose(){this._releaseMouse(),super.dispose()}get orientation(){return this.layout.orientation}set orientation(e){this.layout.orientation=e}get alignment(){return this.layout.alignment}set alignment(e){this.layout.alignment=e}get spacing(){return this.layout.spacing}set spacing(e){this.layout.spacing=e}get renderer(){return this.layout.renderer}get handleMoved(){return this._handleMoved}get handles(){return this.layout.handles}relativeSizes(){return this.layout.relativeSizes()}setRelativeSizes(e,t=!0){this.layout.setRelativeSizes(e,t)}handleEvent(e){switch(e.type){case"pointerdown":this._evtPointerDown(e);break;case"pointermove":this._evtPointerMove(e);break;case"pointerup":this._evtPointerUp(e);break;case"keydown":this._evtKeyDown(e);break;case"contextmenu":e.preventDefault(),e.stopPropagation()}}onBeforeAttach(e){this.node.addEventListener("pointerdown",this)}onAfterDetach(e){this.node.removeEventListener("pointerdown",this),this._releaseMouse()}onChildAdded(e){e.child.addClass("lm-SplitPanel-child"),this._releaseMouse()}onChildRemoved(e){e.child.removeClass("lm-SplitPanel-child"),this._releaseMouse()}_evtKeyDown(e){this._pressData&&(e.preventDefault(),e.stopPropagation()),27===e.keyCode&&this._releaseMouse()}_evtPointerDown(e){let t;if(0!==e.button)return;let i=this.layout,s=W.RO.findFirstIndex(i.handles,t=>t.contains(e.target));if(-1===s)return;e.preventDefault(),e.stopPropagation(),document.addEventListener("pointerup",this,!0),document.addEventListener("pointermove",this,!0),document.addEventListener("keydown",this,!0),document.addEventListener("contextmenu",this,!0);let n=i.handles[s],r=n.getBoundingClientRect();t="horizontal"===i.orientation?e.clientX-r.left:e.clientY-r.top;let a=window.getComputedStyle(n),o=V.n.overrideCursor(a.cursor);this._pressData={index:s,delta:t,override:o}}_evtPointerMove(e){let t;e.preventDefault(),e.stopPropagation();let i=this.layout,s=this.node.getBoundingClientRect();t="horizontal"===i.orientation?e.clientX-s.left-this._pressData.delta:e.clientY-s.top-this._pressData.delta,i.moveHandle(this._pressData.index,t)}_evtPointerUp(e){0===e.button&&(e.preventDefault(),e.stopPropagation(),this._releaseMouse())}_releaseMouse(){this._pressData&&(this._pressData.override.dispose(),this._pressData=null,this._handleMoved.emit(),document.removeEventListener("keydown",this,!0),document.removeEventListener("pointerup",this,!0),document.removeEventListener("pointermove",this,!0),document.removeEventListener("contextmenu",this,!0))}}!function(e){class t{createHandle(){let e=document.createElement("div");return e.className="lm-SplitPanel-handle",e}}e.Renderer=t,e.defaultRenderer=new t,e.getStretch=function(e){return ei.getStretch(e)},e.setStretch=function(e,t){ei.setStretch(e,t)}}(er||(er={})),(x||(x={})).createLayout=function(e){return e.layout||new ei({renderer:e.renderer||er.defaultRenderer,orientation:e.orientation,alignment:e.alignment,spacing:e.spacing})};class ea extends er{constructor(e={}){super({...e,layout:S.createLayout(e)}),this._widgetSizesCache=new WeakMap,this.addClass("lm-AccordionPanel")}get renderer(){return this.layout.renderer}get titleSpace(){return this.layout.titleSpace}set titleSpace(e){this.layout.titleSpace=e}get titles(){return this.layout.titles}addWidget(e){super.addWidget(e),e.title.changed.connect(this._onTitleChanged,this)}collapse(e){let t=this.layout.widgets[e];t&&!t.isHidden&&this._toggleExpansion(e)}expand(e){let t=this.layout.widgets[e];t&&t.isHidden&&this._toggleExpansion(e)}insertWidget(e,t){super.insertWidget(e,t),t.title.changed.connect(this._onTitleChanged,this)}handleEvent(e){switch(super.handleEvent(e),e.type){case"click":this._evtClick(e);break;case"keydown":this._eventKeyDown(e)}}onBeforeAttach(e){this.node.addEventListener("click",this),this.node.addEventListener("keydown",this),super.onBeforeAttach(e)}onAfterDetach(e){super.onAfterDetach(e),this.node.removeEventListener("click",this),this.node.removeEventListener("keydown",this)}_onTitleChanged(e){let t=W.RO.findFirstIndex(this.widgets,t=>t.contains(e.owner));t>=0&&(this.layout.updateTitle(t,e.owner),this.update())}_computeWidgetSize(e){let t=this.layout,i=t.widgets[e];if(!i)return;let s=i.isHidden,n=t.absoluteSizes(),r=(s?-1:1)*this.spacing,a=n.reduce((e,t)=>e+t),o=[...n];if(s){let t=this._widgetSizesCache.get(i);if(!t)return;o[e]+=t;let s=o.map(e=>e-t>0).lastIndexOf(!0);-1===s?o.forEach((i,s)=>{s!==e&&(o[s]-=n[s]/a*(t-r))}):o[s]-=t-r}else{let t=n[e];this._widgetSizesCache.set(i,t),o[e]=0;let s=o.map(e=>e>0).lastIndexOf(!0);if(-1===s)return;o[s]=n[s]+t+r}return o.map(e=>e/(a+r))}_evtClick(e){let t=e.target;if(t){let i=W.RO.findFirstIndex(this.titles,e=>e.contains(t));i>=0&&(e.preventDefault(),e.stopPropagation(),this._toggleExpansion(i))}}_eventKeyDown(e){if(e.defaultPrevented)return;let t=e.target,i=!1;if(t){let s=W.RO.findFirstIndex(this.titles,e=>e.contains(t));if(s>=0){let n=e.keyCode.toString();if(e.key.match(/Space|Enter/)||n.match(/13|32/))t.click(),i=!0;else if("horizontal"===this.orientation?e.key.match(/ArrowLeft|ArrowRight/)||n.match(/37|39/):e.key.match(/ArrowUp|ArrowDown/)||n.match(/38|40/)){let t=e.key.match(/ArrowLeft|ArrowUp/)||n.match(/37|38/)?-1:1,r=this.titles.length;this.titles[(s+r+t)%r].focus(),i=!0}else"End"===e.key||"35"===n?(this.titles[this.titles.length-1].focus(),i=!0):("Home"===e.key||"36"===n)&&(this.titles[0].focus(),i=!0)}i&&e.preventDefault()}}_toggleExpansion(e){let t=this.titles[e],i=this.layout.widgets[e],s=this._computeWidgetSize(e);s&&this.setRelativeSizes(s,!1),i.isHidden?(t.classList.add("lm-mod-expanded"),t.setAttribute("aria-expanded","true"),i.show()):(t.classList.remove("lm-mod-expanded"),t.setAttribute("aria-expanded","false"),i.hide())}}!function(e){class t extends er.Renderer{constructor(){super(),this.titleClassName="lm-AccordionPanel-title",this._titleID=0,this._titleKeys=new WeakMap,this._uuid=++t._nInstance}createCollapseIcon(e){return document.createElement("span")}createSectionTitle(e){let t=document.createElement("h3");for(let i in t.setAttribute("tabindex","0"),t.id=this.createTitleKey(e),t.className=this.titleClassName,e.dataset)t.dataset[i]=e.dataset[i];let i=t.appendChild(this.createCollapseIcon(e));i.className="lm-AccordionPanel-titleCollapser";let s=t.appendChild(document.createElement("span"));return s.className="lm-AccordionPanel-titleLabel",s.textContent=e.label,s.title=e.caption||e.label,t}createTitleKey(e){let t=this._titleKeys.get(e);return void 0===t&&(t=`title-key-${this._uuid}-${this._titleID++}`,this._titleKeys.set(e,t)),t}}t._nInstance=0,e.Renderer=t,e.defaultRenderer=new t}(ea||(ea={})),(S||(S={})).createLayout=function(e){return e.layout||new es({renderer:e.renderer||ea.defaultRenderer,orientation:e.orientation,alignment:e.alignment,spacing:e.spacing,titleSpace:e.titleSpace})};class eo extends ee{constructor(e={}){super(),this._fixed=0,this._spacing=4,this._dirty=!1,this._sizers=[],this._items=[],this._box=null,this._alignment="start",this._direction="top-to-bottom",void 0!==e.direction&&(this._direction=e.direction),void 0!==e.alignment&&(this._alignment=e.alignment),void 0!==e.spacing&&(this._spacing=et.clampDimension(e.spacing))}dispose(){for(let e of this._items)e.dispose();this._box=null,this._items.length=0,this._sizers.length=0,super.dispose()}get direction(){return this._direction}set direction(e){this._direction!==e&&(this._direction=e,this.parent&&(this.parent.dataset.direction=e,this.parent.fit()))}get alignment(){return this._alignment}set alignment(e){this._alignment!==e&&(this._alignment=e,this.parent&&(this.parent.dataset.alignment=e,this.parent.update()))}get spacing(){return this._spacing}set spacing(e){e=et.clampDimension(e),this._spacing!==e&&(this._spacing=e,this.parent&&this.parent.fit())}init(){this.parent.dataset.direction=this.direction,this.parent.dataset.alignment=this.alignment,super.init()}attachWidget(e,t){W.RO.insert(this._items,e,new Z(t)),W.RO.insert(this._sizers,e,new G),this.parent.isAttached&&q.pB.sendMessage(t,J.Msg.BeforeAttach),this.parent.node.appendChild(t.node),this.parent.isAttached&&q.pB.sendMessage(t,J.Msg.AfterAttach),this.parent.fit()}moveWidget(e,t,i){W.RO.move(this._items,e,t),W.RO.move(this._sizers,e,t),this.parent.update()}detachWidget(e,t){let i=W.RO.removeAt(this._items,e);W.RO.removeAt(this._sizers,e),this.parent.isAttached&&q.pB.sendMessage(t,J.Msg.BeforeDetach),this.parent.node.removeChild(t.node),this.parent.isAttached&&q.pB.sendMessage(t,J.Msg.AfterDetach),i.dispose(),this.parent.fit()}onBeforeShow(e){super.onBeforeShow(e),this.parent.update()}onBeforeAttach(e){super.onBeforeAttach(e),this.parent.fit()}onChildShown(e){this.parent.fit()}onChildHidden(e){this.parent.fit()}onResize(e){this.parent.isVisible&&this._update(e.width,e.height)}onUpdateRequest(e){this.parent.isVisible&&this._update(-1,-1)}onFitRequest(e){this.parent.isAttached&&this._fit()}_fit(){let e=0;for(let t=0,i=this._items.length;t<i;++t)e+=+!this._items[t].isHidden;this._fixed=this._spacing*Math.max(0,e-1);let t=I.isHorizontal(this._direction),i=t?this._fixed:0,s=t?0:this._fixed;for(let e=0,n=this._items.length;e<n;++e){let n=this._items[e],r=this._sizers[e];if(n.isHidden){r.minSize=0,r.maxSize=0;continue}n.fit(),r.sizeHint=eo.getSizeBasis(n.widget),r.stretch=eo.getStretch(n.widget),t?(r.minSize=n.minWidth,r.maxSize=n.maxWidth,i+=n.minWidth,s=Math.max(s,n.minHeight)):(r.minSize=n.minHeight,r.maxSize=n.maxHeight,s+=n.minHeight,i=Math.max(i,n.minWidth))}let n=this._box=P.TE.boxSizing(this.parent.node);i+=n.horizontalSum,s+=n.verticalSum;let r=this.parent.node.style;r.minWidth=`${i}px`,r.minHeight=`${s}px`,this._dirty=!0,this.parent.parent&&q.pB.sendMessage(this.parent.parent,J.Msg.FitRequest),this._dirty&&q.pB.sendMessage(this.parent,J.Msg.UpdateRequest)}_update(e,t){let i;this._dirty=!1;let s=0;for(let e=0,t=this._items.length;e<t;++e)s+=+!this._items[e].isHidden;if(0===s)return;e<0&&(e=this.parent.node.offsetWidth),t<0&&(t=this.parent.node.offsetHeight),this._box||(this._box=P.TE.boxSizing(this.parent.node));let n=this._box.paddingTop,r=this._box.paddingLeft,a=e-this._box.horizontalSum,o=t-this._box.verticalSum;switch(this._direction){case"left-to-right":i=_.calc(this._sizers,Math.max(0,a-this._fixed));break;case"top-to-bottom":i=_.calc(this._sizers,Math.max(0,o-this._fixed));break;case"right-to-left":i=_.calc(this._sizers,Math.max(0,a-this._fixed)),r+=a;break;case"bottom-to-top":i=_.calc(this._sizers,Math.max(0,o-this._fixed)),n+=o;break;default:throw"unreachable"}let h=0,d=0;if(i>0)switch(this._alignment){case"start":break;case"center":h=0,d=i/2;break;case"end":h=0,d=i;break;case"justify":h=i/s,d=0;break;default:throw"unreachable"}for(let e=0,t=this._items.length;e<t;++e){let t=this._items[e];if(t.isHidden)continue;let i=this._sizers[e].size;switch(this._direction){case"left-to-right":t.update(r+d,n,i+h,o),r+=i+h+this._spacing;break;case"top-to-bottom":t.update(r,n+d,a,i+h),n+=i+h+this._spacing;break;case"right-to-left":t.update(r-d-i-h,n,i+h,o),r-=i+h+this._spacing;break;case"bottom-to-top":t.update(r,n-d-i-h,a,i+h),n-=i+h+this._spacing;break;default:throw"unreachable"}}}}(h=eo||(eo={})).getStretch=function(e){return I.stretchProperty.get(e)},h.setStretch=function(e,t){I.stretchProperty.set(e,t)},h.getSizeBasis=function(e){return I.sizeBasisProperty.get(e)},h.setSizeBasis=function(e,t){I.sizeBasisProperty.set(e,t)},function(e){function t(e){e.parent&&e.parent.layout instanceof eo&&e.parent.fit()}e.stretchProperty=new F.AttachedProperty({name:"stretch",create:()=>0,coerce:(e,t)=>Math.max(0,Math.floor(t)),changed:t}),e.sizeBasisProperty=new F.AttachedProperty({name:"sizeBasis",create:()=>0,coerce:(e,t)=>Math.max(0,Math.floor(t)),changed:t}),e.isHorizontal=function(e){return"left-to-right"===e||"right-to-left"===e},e.clampSpacing=function(e){return Math.max(0,Math.floor(e))}}(I||(I={}));class eh extends en{constructor(e={}){super({layout:C.createLayout(e)}),this.addClass("lm-BoxPanel")}get direction(){return this.layout.direction}set direction(e){this.layout.direction=e}get alignment(){return this.layout.alignment}set alignment(e){this.layout.alignment=e}get spacing(){return this.layout.spacing}set spacing(e){this.layout.spacing=e}onChildAdded(e){e.child.addClass("lm-BoxPanel-child")}onChildRemoved(e){e.child.removeClass("lm-BoxPanel-child")}}(d=eh||(eh={})).getStretch=function(e){return eo.getStretch(e)},d.setStretch=function(e,t){eo.setStretch(e,t)},d.getSizeBasis=function(e){return eo.getSizeBasis(e)},d.setSizeBasis=function(e,t){eo.setSizeBasis(e,t)},(C||(C={})).createLayout=function(e){return e.layout||new eo(e)};class ed extends J{constructor(e){super({node:z.createNode()}),this._activeIndex=-1,this._items=[],this._results=null,this.addClass("lm-CommandPalette"),this.setFlag(J.Flag.DisallowLayout),this.commands=e.commands,this.renderer=e.renderer||ed.defaultRenderer,this.commands.commandChanged.connect(this._onGenericChange,this),this.commands.keyBindingChanged.connect(this._onGenericChange,this)}dispose(){this._items.length=0,this._results=null,super.dispose()}get searchNode(){return this.node.getElementsByClassName("lm-CommandPalette-search")[0]}get inputNode(){return this.node.getElementsByClassName("lm-CommandPalette-input")[0]}get contentNode(){return this.node.getElementsByClassName("lm-CommandPalette-content")[0]}get items(){return this._items}addItem(e){let t=z.createItem(this.commands,e);return this._items.push(t),this.refresh(),t}addItems(e){let t=e.map(e=>z.createItem(this.commands,e));return t.forEach(e=>this._items.push(e)),this.refresh(),t}removeItem(e){this.removeItemAt(this._items.indexOf(e))}removeItemAt(e){W.RO.removeAt(this._items,e)&&this.refresh()}clearItems(){0!==this._items.length&&(this._items.length=0,this.refresh())}refresh(){this._results=null,""!==this.inputNode.value?this.node.getElementsByClassName("lm-close-icon")[0].style.display="inherit":this.node.getElementsByClassName("lm-close-icon")[0].style.display="none",this.update()}handleEvent(e){switch(e.type){case"click":this._evtClick(e);break;case"keydown":this._evtKeyDown(e);break;case"input":this.refresh();break;case"focus":case"blur":this._toggleFocused()}}onBeforeAttach(e){this.node.addEventListener("click",this),this.node.addEventListener("keydown",this),this.node.addEventListener("input",this),this.node.addEventListener("focus",this,!0),this.node.addEventListener("blur",this,!0)}onAfterDetach(e){this.node.removeEventListener("click",this),this.node.removeEventListener("keydown",this),this.node.removeEventListener("input",this),this.node.removeEventListener("focus",this,!0),this.node.removeEventListener("blur",this,!0)}onAfterShow(e){this.update(),super.onAfterShow(e)}onActivateRequest(e){if(this.isAttached){let e=this.inputNode;e.focus(),e.select()}}onUpdateRequest(e){if(this.isHidden)return;let t=this.inputNode.value,i=this.contentNode,s=this._results;if(s||(s=this._results=z.search(this._items,t),this._activeIndex=t?W.RO.findFirstIndex(s,z.canActivate):-1),!t&&0===s.length){Y.Iw.render(null,i);return}if(t&&0===s.length){let e=this.renderer.renderEmptyMessage({query:t});Y.Iw.render(e,i);return}let n=this.renderer,r=this._activeIndex,a=Array(s.length);for(let e=0,t=s.length;e<t;++e){let t=s[e];if("header"===t.type){let i=t.indices,s=t.category;a[e]=n.renderHeader({category:s,indices:i})}else{let i=t.item,s=t.indices,o=e===r;a[e]=n.renderItem({item:i,indices:s,active:o})}}if(Y.Iw.render(a,i),r<0||r>=s.length)i.scrollTop=0;else{let e=i.children[r];P.TE.scrollIntoViewIfNeeded(i,e)}}_evtClick(e){if(0!==e.button)return;if(e.target.classList.contains("lm-close-icon")){this.inputNode.value="",this.refresh();return}let t=W.RO.findFirstIndex(this.contentNode.children,t=>t.contains(e.target));-1!==t&&(e.preventDefault(),e.stopPropagation(),this._execute(t))}_evtKeyDown(e){if(!e.altKey&&!e.ctrlKey&&!e.metaKey&&!e.shiftKey)switch(e.keyCode){case 13:e.preventDefault(),e.stopPropagation(),this._execute(this._activeIndex);break;case 38:e.preventDefault(),e.stopPropagation(),this._activatePreviousItem();break;case 40:e.preventDefault(),e.stopPropagation(),this._activateNextItem()}}_activateNextItem(){if(!this._results||0===this._results.length)return;let e=this._activeIndex,t=this._results.length,i=e<t-1?e+1:0;this._activeIndex=W.RO.findFirstIndex(this._results,z.canActivate,i,0===i?t-1:i-1),this.update()}_activatePreviousItem(){if(!this._results||0===this._results.length)return;let e=this._activeIndex,t=this._results.length,i=e<=0?t-1:e-1;this._activeIndex=W.RO.findLastIndex(this._results,z.canActivate,i,i===t-1?0:i+1),this.update()}_execute(e){if(!this._results)return;let t=this._results[e];if(t){if("header"===t.type){let e=this.inputNode;e.value=`${t.category.toLowerCase()} `,e.focus(),this.refresh();return}t.item.isEnabled&&(this.commands.execute(t.item.command,t.item.args),this.inputNode.value="",this.refresh())}}_toggleFocused(){let e=document.activeElement===this.inputNode;this.toggleClass("lm-mod-focused",e)}_onGenericChange(){this.refresh()}}!function(e){class t{renderHeader(e){let t=this.formatHeader(e);return Y.h.li({className:"lm-CommandPalette-header"},t)}renderItem(e){let t=this.createItemClass(e),i=this.createItemDataset(e);return e.item.isToggleable?Y.h.li({className:t,dataset:i,role:"menuitemcheckbox","aria-checked":`${e.item.isToggled}`},this.renderItemIcon(e),this.renderItemContent(e),this.renderItemShortcut(e)):Y.h.li({className:t,dataset:i,role:"menuitem"},this.renderItemIcon(e),this.renderItemContent(e),this.renderItemShortcut(e))}renderEmptyMessage(e){let t=this.formatEmptyMessage(e);return Y.h.li({className:"lm-CommandPalette-emptyMessage"},t)}renderItemIcon(e){let t=this.createIconClass(e);return Y.h.div({className:t},e.item.icon,e.item.iconLabel)}renderItemContent(e){return Y.h.div({className:"lm-CommandPalette-itemContent"},this.renderItemLabel(e),this.renderItemCaption(e))}renderItemLabel(e){let t=this.formatItemLabel(e);return Y.h.div({className:"lm-CommandPalette-itemLabel"},t)}renderItemCaption(e){let t=this.formatItemCaption(e);return Y.h.div({className:"lm-CommandPalette-itemCaption"},t)}renderItemShortcut(e){let t=this.formatItemShortcut(e);return Y.h.div({className:"lm-CommandPalette-itemShortcut"},t)}createItemClass(e){let t="lm-CommandPalette-item";e.item.isEnabled||(t+=" lm-mod-disabled"),e.item.isToggled&&(t+=" lm-mod-toggled"),e.active&&(t+=" lm-mod-active");let i=e.item.className;return i&&(t+=` ${i}`),t}createItemDataset(e){return{...e.item.dataset,command:e.item.command}}createIconClass(e){let t="lm-CommandPalette-itemIcon",i=e.item.iconClass;return i?`${t} ${i}`:t}formatHeader(e){return e.indices&&0!==e.indices.length?W.kf.highlight(e.category,e.indices,Y.h.mark):e.category}formatEmptyMessage(e){return`No commands found that match '${e.query}'`}formatItemShortcut(e){let t=e.item.keyBinding;return t?U.H.formatKeystroke(t.keys):null}formatItemLabel(e){return e.indices&&0!==e.indices.length?W.kf.highlight(e.item.label,e.indices,Y.h.mark):e.item.label}formatItemCaption(e){return e.item.caption}}e.Renderer=t,e.defaultRenderer=new t}(ed||(ed={})),function(e){function t(e,t){let i=e.matchType-t.matchType;if(0!==i)return i;let s=e.score-t.score;if(0!==s)return s;let n=0,r=0;switch(e.matchType){case 0:n=e.labelIndices[0],r=t.labelIndices[0];break;case 1:case 2:n=e.categoryIndices[0],r=t.categoryIndices[0]}if(n!==r)return n-r;let a=e.item.category.localeCompare(t.item.category);if(0!==a)return a;let o=e.item.rank,h=t.item.rank;return o!==h?o<h?-1:1:e.item.label.localeCompare(t.item.label)}e.createNode=function(){let e=document.createElement("div"),t=document.createElement("div"),i=document.createElement("div"),s=document.createElement("input"),n=document.createElement("ul"),r=document.createElement("button");return t.className="lm-CommandPalette-search",i.className="lm-CommandPalette-wrapper",s.className="lm-CommandPalette-input",r.className="lm-close-icon",n.className="lm-CommandPalette-content",n.setAttribute("role","menu"),s.spellcheck=!1,i.appendChild(s),i.appendChild(r),t.appendChild(i),e.appendChild(t),e.appendChild(n),e},e.createItem=function(e,t){return new i(e,t)},e.search=function(e,i){let s=function(e,t){t=t.replace(/\s+/g,"").toLowerCase();let i=[];for(let s=0,n=e.length;s<n;++s){let n=e[s];if(!n.isVisible)continue;if(!t){i.push({matchType:3,categoryIndices:null,labelIndices:null,score:0,item:n});continue}let r=function(e,t){let i=e.category.toLowerCase(),s=`${i} ${e.label.toLowerCase()}`,n=1/0,r=null,a=/\b\w/g;for(;;){let e=a.exec(s);if(!e)break;let i=W.kf.matchSumOfDeltas(s,t,e.index);if(!i)break;i.score<=n&&(n=i.score,r=i.indices)}if(!r||n===1/0)return null;let o=i.length+1,h=W.RO.lowerBound(r,o,(e,t)=>e-t),d=r.slice(0,h),l=r.slice(h);for(let e=0,t=l.length;e<t;++e)l[e]-=o;return 0===d.length?{matchType:0,categoryIndices:null,labelIndices:l,score:n,item:e}:0===l.length?{matchType:1,categoryIndices:d,labelIndices:null,score:n,item:e}:{matchType:2,categoryIndices:d,labelIndices:l,score:n,item:e}}(n,t);r&&(n.isEnabled||(r.score+=1e3),i.push(r))}return i}(e,i);return s.sort(t),function(e){let t=Array(e.length);W.RO.fill(t,!1);let i=[];for(let s=0,n=e.length;s<n;++s){if(t[s])continue;let{item:r,categoryIndices:a}=e[s],o=r.category;i.push({type:"header",category:o,indices:a});for(let r=s;r<n;++r){if(t[r])continue;let{item:s,labelIndices:n}=e[r];s.category===o&&(i.push({type:"item",item:s,indices:n}),t[r]=!0)}}return i}(s)},e.canActivate=function(e){return"item"===e.type&&e.item.isEnabled};class i{constructor(e,t){this._commands=e,this.category=t.category.trim().replace(/\s+/g," "),this.command=t.command,this.args=t.args||O.JSONExt.emptyObject,this.rank=void 0!==t.rank?t.rank:1/0}get label(){return this._commands.label(this.command,this.args)}get icon(){return this._commands.icon(this.command,this.args)}get iconClass(){return this._commands.iconClass(this.command,this.args)}get iconLabel(){return this._commands.iconLabel(this.command,this.args)}get caption(){return this._commands.caption(this.command,this.args)}get className(){return this._commands.className(this.command,this.args)}get dataset(){return this._commands.dataset(this.command,this.args)}get isEnabled(){return this._commands.isEnabled(this.command,this.args)}get isToggled(){return this._commands.isToggled(this.command,this.args)}get isToggleable(){return this._commands.isToggleable(this.command,this.args)}get isVisible(){return this._commands.isVisible(this.command,this.args)}get keyBinding(){let{command:e,args:t}=this;return W.RO.findLastValue(this._commands.keyBindings,i=>i.command===e&&O.JSONExt.deepEqual(i.args,t))||null}}}(z||(z={}));class el extends J{constructor(e){super({node:A.createNode()}),this._childIndex=-1,this._activeIndex=-1,this._openTimerID=0,this._closeTimerID=0,this._items=[],this._childMenu=null,this._parentMenu=null,this._aboutToClose=new $.Signal(this),this._menuRequested=new $.Signal(this),this.addClass("lm-Menu"),this.setFlag(J.Flag.DisallowLayout),this.commands=e.commands,this.renderer=e.renderer||el.defaultRenderer}dispose(){this.close(),this._items.length=0,super.dispose()}get aboutToClose(){return this._aboutToClose}get menuRequested(){return this._menuRequested}get parentMenu(){return this._parentMenu}get childMenu(){return this._childMenu}get rootMenu(){let e=this;for(;e._parentMenu;)e=e._parentMenu;return e}get leafMenu(){let e=this;for(;e._childMenu;)e=e._childMenu;return e}get contentNode(){return this.node.getElementsByClassName("lm-Menu-content")[0]}get activeItem(){return this._items[this._activeIndex]||null}set activeItem(e){this.activeIndex=e?this._items.indexOf(e):-1}get activeIndex(){return this._activeIndex}set activeIndex(e){(e<0||e>=this._items.length)&&(e=-1),-1===e||A.canActivate(this._items[e])||(e=-1),this._activeIndex!==e&&(this._activeIndex=e,this._activeIndex>=0&&this.contentNode.childNodes[this._activeIndex]&&this.contentNode.childNodes[this._activeIndex].focus(),this.update())}get items(){return this._items}activateNextItem(){let e=this._items.length,t=this._activeIndex,i=t<e-1?t+1:0;this.activeIndex=W.RO.findFirstIndex(this._items,A.canActivate,i,0===i?e-1:i-1)}activatePreviousItem(){let e=this._items.length,t=this._activeIndex,i=t<=0?e-1:t-1;this.activeIndex=W.RO.findLastIndex(this._items,A.canActivate,i,i===e-1?0:i+1)}triggerActiveItem(){if(!this.isAttached)return;let e=this.activeItem;if(!e)return;if(this._cancelOpenTimer(),this._cancelCloseTimer(),"submenu"===e.type){this._openChildMenu(!0);return}this.rootMenu.close();let{command:t,args:i}=e;this.commands.isEnabled(t,i)?this.commands.execute(t,i):console.log(`Command '${t}' is disabled.`)}addItem(e){return this.insertItem(this._items.length,e)}insertItem(e,t){this.isAttached&&this.close(),this.activeIndex=-1;let i=Math.max(0,Math.min(e,this._items.length)),s=A.createItem(this,t);return W.RO.insert(this._items,i,s),this.update(),s}removeItem(e){this.removeItemAt(this._items.indexOf(e))}removeItemAt(e){this.isAttached&&this.close(),this.activeIndex=-1,W.RO.removeAt(this._items,e)&&this.update()}clearItems(){this.isAttached&&this.close(),this.activeIndex=-1,0!==this._items.length&&(this._items.length=0,this.update())}open(e,t,i={}){if(this.isAttached)return;let s=i.forceX||!1,n=i.forceY||!1;A.openRootMenu(this,e,t,s,n),this.activate()}handleEvent(e){switch(e.type){case"keydown":this._evtKeyDown(e);break;case"mouseup":this._evtMouseUp(e);break;case"mousemove":this._evtMouseMove(e);break;case"mouseenter":this._evtMouseEnter(e);break;case"mouseleave":this._evtMouseLeave(e);break;case"mousedown":this._evtMouseDown(e);break;case"contextmenu":e.preventDefault(),e.stopPropagation()}}onBeforeAttach(e){this.node.addEventListener("keydown",this),this.node.addEventListener("mouseup",this),this.node.addEventListener("mousemove",this),this.node.addEventListener("mouseenter",this),this.node.addEventListener("mouseleave",this),this.node.addEventListener("contextmenu",this),document.addEventListener("mousedown",this,!0)}onAfterDetach(e){this.node.removeEventListener("keydown",this),this.node.removeEventListener("mouseup",this),this.node.removeEventListener("mousemove",this),this.node.removeEventListener("mouseenter",this),this.node.removeEventListener("mouseleave",this),this.node.removeEventListener("contextmenu",this),document.removeEventListener("mousedown",this,!0)}onActivateRequest(e){this.isAttached&&this.node.focus()}onUpdateRequest(e){let t=this._items,i=this.renderer,s=this._activeIndex,n=A.computeCollapsed(t),r=Array(t.length);for(let e=0,a=t.length;e<a;++e){let a=t[e],o=e===s,h=n[e];r[e]=i.renderItem({item:a,active:o,collapsed:h,onfocus:()=>{this.activeIndex=e}})}Y.Iw.render(r,this.contentNode)}onCloseRequest(e){this._cancelOpenTimer(),this._cancelCloseTimer(),this.activeIndex=-1;let t=this._childMenu;t&&(this._childIndex=-1,this._childMenu=null,t._parentMenu=null,t.close());let i=this._parentMenu;i&&(this._parentMenu=null,i._childIndex=-1,i._childMenu=null,i.activate()),this.isAttached&&this._aboutToClose.emit(void 0),super.onCloseRequest(e)}_evtKeyDown(e){e.preventDefault(),e.stopPropagation();let t=e.keyCode;if(13===t){this.triggerActiveItem();return}if(27===t){this.close();return}if(37===t){this._parentMenu?this.close():this._menuRequested.emit("previous");return}if(38===t){this.activatePreviousItem();return}if(39===t){let e=this.activeItem;e&&"submenu"===e.type?this.triggerActiveItem():this.rootMenu._menuRequested.emit("next");return}if(40===t){this.activateNextItem();return}let i=(0,X.Vc)().keyForKeydownEvent(e);if(!i)return;let s=this._activeIndex+1,n=A.findMnemonic(this._items,i,s);-1===n.index||n.multiple?-1!==n.index?this.activeIndex=n.index:-1!==n.auto&&(this.activeIndex=n.auto):(this.activeIndex=n.index,this.triggerActiveItem())}_evtMouseUp(e){0===e.button&&(e.preventDefault(),e.stopPropagation(),this.triggerActiveItem())}_evtMouseMove(e){let t=W.RO.findFirstIndex(this.contentNode.children,t=>P.TE.hitTest(t,e.clientX,e.clientY));if(t===this._activeIndex)return;if(this.activeIndex=t,(t=this.activeIndex)===this._childIndex){this._cancelOpenTimer(),this._cancelCloseTimer();return}-1!==this._childIndex&&this._startCloseTimer(),this._cancelOpenTimer();let i=this.activeItem;i&&"submenu"===i.type&&i.submenu&&this._startOpenTimer()}_evtMouseEnter(e){for(let e=this._parentMenu;e;e=e._parentMenu)e._cancelOpenTimer(),e._cancelCloseTimer(),e.activeIndex=e._childIndex}_evtMouseLeave(e){if(this._cancelOpenTimer(),!this._childMenu){this.activeIndex=-1;return}let{clientX:t,clientY:i}=e;if(P.TE.hitTest(this._childMenu.node,t,i)){this._cancelCloseTimer();return}this.activeIndex=-1,this._startCloseTimer()}_evtMouseDown(e){this._parentMenu||(A.hitTestMenus(this,e.clientX,e.clientY)?(e.preventDefault(),e.stopPropagation()):this.close())}_openChildMenu(e=!1){let t=this.activeItem;if(!t||"submenu"!==t.type||!t.submenu){this._closeChildMenu();return}let i=t.submenu;if(i===this._childMenu)return;el.saveWindowData(),this._closeChildMenu(),this._childMenu=i,this._childIndex=this._activeIndex,i._parentMenu=this,q.pB.sendMessage(this,J.Msg.UpdateRequest);let s=this.contentNode.children[this._activeIndex];A.openSubmenu(i,s),e&&(i.activeIndex=-1,i.activateNextItem()),i.activate()}_closeChildMenu(){this._childMenu&&this._childMenu.close()}_startOpenTimer(){0===this._openTimerID&&(this._openTimerID=window.setTimeout(()=>{this._openTimerID=0,this._openChildMenu()},A.TIMER_DELAY))}_startCloseTimer(){0===this._closeTimerID&&(this._closeTimerID=window.setTimeout(()=>{this._closeTimerID=0,this._closeChildMenu()},A.TIMER_DELAY))}_cancelOpenTimer(){0!==this._openTimerID&&(clearTimeout(this._openTimerID),this._openTimerID=0)}_cancelCloseTimer(){0!==this._closeTimerID&&(clearTimeout(this._closeTimerID),this._closeTimerID=0)}static saveWindowData(){A.saveWindowData()}}!function(e){class t{renderItem(e){let t=this.createItemClass(e),i=this.createItemDataset(e),s=this.createItemARIA(e);return Y.h.li({className:t,dataset:i,tabindex:"0",onfocus:e.onfocus,...s},this.renderIcon(e),this.renderLabel(e),this.renderShortcut(e),this.renderSubmenu(e))}renderIcon(e){let t=this.createIconClass(e);return Y.h.div({className:t},e.item.icon,e.item.iconLabel)}renderLabel(e){let t=this.formatLabel(e);return Y.h.div({className:"lm-Menu-itemLabel"},t)}renderShortcut(e){let t=this.formatShortcut(e);return Y.h.div({className:"lm-Menu-itemShortcut"},t)}renderSubmenu(e){return Y.h.div({className:"lm-Menu-itemSubmenuIcon"})}createItemClass(e){let t="lm-Menu-item";e.item.isEnabled||(t+=" lm-mod-disabled"),e.item.isToggled&&(t+=" lm-mod-toggled"),e.item.isVisible||(t+=" lm-mod-hidden"),e.active&&(t+=" lm-mod-active"),e.collapsed&&(t+=" lm-mod-collapsed");let i=e.item.className;return i&&(t+=` ${i}`),t}createItemDataset(e){let{type:t,command:i,dataset:s}=e.item;return"command"===t?{...s,type:t,command:i}:{...s,type:t}}createIconClass(e){let t="lm-Menu-itemIcon",i=e.item.iconClass;return i?`${t} ${i}`:t}createItemARIA(e){let t={};switch(e.item.type){case"separator":t.role="presentation";break;case"submenu":t["aria-haspopup"]="true",e.item.isEnabled||(t["aria-disabled"]="true");break;default:e.item.isEnabled||(t["aria-disabled"]="true"),t.role="menuitem"}return t}formatLabel(e){let{label:t,mnemonic:i}=e.item;if(i<0||i>=t.length)return t;let s=t.slice(0,i),n=t.slice(i+1),r=t[i];return[s,Y.h.span({className:"lm-Menu-itemMnemonic"},r),n]}formatShortcut(e){let t=e.item.keyBinding;return t?U.H.formatKeystroke(t.keys):null}}e.Renderer=t,e.defaultRenderer=new t}(el||(el={})),function(e){e.TIMER_DELAY=300,e.SUBMENU_OVERLAP=3;let t=null,i=0;function s(){return i>0?(i--,t):r()}function n(e){return"separator"!==e.type&&e.isEnabled&&e.isVisible}function r(){return{pageXOffset:window.pageXOffset,pageYOffset:window.pageYOffset,clientWidth:document.documentElement.clientWidth,clientHeight:document.documentElement.clientHeight}}e.saveWindowData=function(){t=r(),i++},e.createNode=function(){let e=document.createElement("div"),t=document.createElement("ul");return t.className="lm-Menu-content",e.appendChild(t),t.setAttribute("role","menu"),e.tabIndex=0,e},e.canActivate=n,e.createItem=function(e,t){return new a(e.commands,t)},e.hitTestMenus=function(e,t,i){for(let s=e;s;s=s.childMenu)if(P.TE.hitTest(s.node,t,i))return!0;return!1},e.computeCollapsed=function(e){let t=Array(e.length);W.RO.fill(t,!1);let i=0,s=e.length;for(;i<s;++i){let s=e[i];if(s.isVisible){if("separator"!==s.type)break;t[i]=!0}}let n=s-1;for(;n>=0;--n){let i=e[n];if(i.isVisible){if("separator"!==i.type)break;t[n]=!0}}let r=!1;for(;++i<n;){let s=e[i];s.isVisible&&("separator"!==s.type?r=!1:r?t[i]=!0:r=!0)}return t},e.openRootMenu=function(e,t,i,n,r){let a=s(),o=a.pageXOffset,h=a.pageYOffset,d=a.clientWidth,l=a.clientHeight;q.pB.sendMessage(e,J.Msg.UpdateRequest);let c=l-(r?i:0),u=e.node,m=u.style;m.opacity="0",m.maxHeight=`${c}px`,J.attach(e,document.body);let{width:p,height:g}=u.getBoundingClientRect();!n&&t+p>o+d&&(t=o+d-p),!r&&i+g>h+l&&(i>h+l?i=h+l-g:i-=g),m.transform=`translate(${Math.max(0,t)}px, ${Math.max(0,i)}px`,m.opacity="1"},e.openSubmenu=function(t,i){let n=s(),r=n.pageXOffset,a=n.pageYOffset,o=n.clientWidth,h=n.clientHeight;q.pB.sendMessage(t,J.Msg.UpdateRequest);let d=t.node,l=d.style;l.opacity="0",l.maxHeight=`${h}px`,J.attach(t,document.body);let{width:c,height:u}=d.getBoundingClientRect(),m=P.TE.boxSizing(t.node),p=i.getBoundingClientRect(),g=p.right-e.SUBMENU_OVERLAP;g+c>r+o&&(g=p.left+e.SUBMENU_OVERLAP-c);let _=p.top-m.borderTop-m.paddingTop;_+u>a+h&&(_=p.bottom+m.borderBottom+m.paddingBottom-u),l.transform=`translate(${Math.max(0,g)}px, ${Math.max(0,_)}px`,l.opacity="1"},e.findMnemonic=function(e,t,i){let s=-1,r=-1,a=!1,o=t.toUpperCase();for(let t=0,h=e.length;t<h;++t){let d=(t+i)%h,l=e[d];if(!n(l))continue;let c=l.label;if(0===c.length)continue;let u=l.mnemonic;if(u>=0&&u<c.length){c[u].toUpperCase()===o&&(-1===s?s=d:a=!0);continue}-1===r&&c[0].toUpperCase()===o&&(r=d)}return{index:s,multiple:a,auto:r}};class a{constructor(e,t){this._commands=e,this.type=t.type||"command",this.command=t.command||"",this.args=t.args||O.JSONExt.emptyObject,this.submenu=t.submenu||null}get label(){return"command"===this.type?this._commands.label(this.command,this.args):"submenu"===this.type&&this.submenu?this.submenu.title.label:""}get mnemonic(){return"command"===this.type?this._commands.mnemonic(this.command,this.args):"submenu"===this.type&&this.submenu?this.submenu.title.mnemonic:-1}get icon(){return"command"===this.type?this._commands.icon(this.command,this.args):"submenu"===this.type&&this.submenu?this.submenu.title.icon:void 0}get iconClass(){return"command"===this.type?this._commands.iconClass(this.command,this.args):"submenu"===this.type&&this.submenu?this.submenu.title.iconClass:""}get iconLabel(){return"command"===this.type?this._commands.iconLabel(this.command,this.args):"submenu"===this.type&&this.submenu?this.submenu.title.iconLabel:""}get caption(){return"command"===this.type?this._commands.caption(this.command,this.args):"submenu"===this.type&&this.submenu?this.submenu.title.caption:""}get className(){return"command"===this.type?this._commands.className(this.command,this.args):"submenu"===this.type&&this.submenu?this.submenu.title.className:""}get dataset(){return"command"===this.type?this._commands.dataset(this.command,this.args):"submenu"===this.type&&this.submenu?this.submenu.title.dataset:{}}get isEnabled(){return"command"===this.type?this._commands.isEnabled(this.command,this.args):"submenu"!==this.type||null!==this.submenu}get isToggled(){return"command"===this.type&&this._commands.isToggled(this.command,this.args)}get isVisible(){return"command"===this.type?this._commands.isVisible(this.command,this.args):"submenu"!==this.type||null!==this.submenu}get keyBinding(){if("command"===this.type){let{command:e,args:t}=this;return W.RO.findLastValue(this._commands.keyBindings,i=>i.command===e&&O.JSONExt.deepEqual(i.args,t))||null}return null}}}(A||(A={}));class ec{constructor(e){this._groupByTarget=!0,this._idTick=0,this._items=[],this._sortBySelector=!0;let{groupByTarget:t,sortBySelector:i,...s}=e;this.menu=new el(s),this._groupByTarget=!1!==t,this._sortBySelector=!1!==i}addItem(e){let t=B.createItem(e,this._idTick++);return this._items.push(t),new K.DisposableDelegate(()=>{W.RO.removeFirstOf(this._items,t)})}open(e){if(el.saveWindowData(),this.menu.clearItems(),0===this._items.length)return!1;let t=B.matchItems(this._items,e,this._groupByTarget,this._sortBySelector);if(!t||0===t.length)return!1;for(let e of t)this.menu.addItem(e);return this.menu.open(e.clientX,e.clientY),!0}}!function(e){function t(e,t){let i=e.rank,s=t.rank;return i!==s?i<s?-1:1:e.id-t.id}function i(e,i){let s=P.Qf.calculateSpecificity(e.selector),n=P.Qf.calculateSpecificity(i.selector);return s!==n?n-s:t(e,i)}e.createItem=function(e,t){let i=function(e){if(-1!==e.indexOf(","))throw Error(`Selector cannot contain commas: ${e}`);if(!P.Qf.isValid(e))throw Error(`Invalid selector: ${e}`);return e}(e.selector),s=void 0!==e.rank?e.rank:1/0;return{...e,selector:i,rank:s,id:t}},e.matchItems=function(e,s,n,r){let a=s.target;if(!a)return null;let o=s.currentTarget;if(!o||!o.contains(a)&&(!(a=document.elementFromPoint(s.clientX,s.clientY))||!o.contains(a)))return null;let h=[],d=e.slice();for(;null!==a;){let e=[];for(let t=0,i=d.length;t<i;++t){let i=d[t];i&&P.Qf.matches(a,i.selector)&&(e.push(i),d[t]=null)}if(0!==e.length&&(n&&e.sort(r?i:t),h.push(...e)),a===o)break;a=a.parentElement}return n||h.sort(r?i:t),h}}(B||(B={}));class eu extends J{constructor(e={}){super({node:T.createNode()}),this._currentIndex=-1,this._titles=[],this._titlesEditable=!1,this._previousTitle=null,this._dragData=null,this._addButtonEnabled=!1,this._tabMoved=new $.Signal(this),this._currentChanged=new $.Signal(this),this._addRequested=new $.Signal(this),this._tabCloseRequested=new $.Signal(this),this._tabDetachRequested=new $.Signal(this),this._tabActivateRequested=new $.Signal(this),this.addClass("lm-TabBar"),this.contentNode.setAttribute("role","tablist"),this.setFlag(J.Flag.DisallowLayout),this._document=e.document||document,this.tabsMovable=e.tabsMovable||!1,this.titlesEditable=e.titlesEditable||!1,this.allowDeselect=e.allowDeselect||!1,this.addButtonEnabled=e.addButtonEnabled||!1,this.insertBehavior=e.insertBehavior||"select-tab-if-needed",this.name=e.name||"",this.orientation=e.orientation||"horizontal",this.removeBehavior=e.removeBehavior||"select-tab-after",this.renderer=e.renderer||eu.defaultRenderer}dispose(){this._releaseMouse(),this._titles.length=0,this._previousTitle=null,super.dispose()}get currentChanged(){return this._currentChanged}get tabMoved(){return this._tabMoved}get tabActivateRequested(){return this._tabActivateRequested}get addRequested(){return this._addRequested}get tabCloseRequested(){return this._tabCloseRequested}get tabDetachRequested(){return this._tabDetachRequested}get document(){return this._document}get titlesEditable(){return this._titlesEditable}set titlesEditable(e){this._titlesEditable=e}get currentTitle(){return this._titles[this._currentIndex]||null}set currentTitle(e){this.currentIndex=e?this._titles.indexOf(e):-1}get currentIndex(){return this._currentIndex}set currentIndex(e){if((e<0||e>=this._titles.length)&&(e=-1),this._currentIndex===e)return;let t=this._currentIndex,i=this._titles[t]||null,s=e,n=this._titles[s]||null;this._currentIndex=s,this._previousTitle=i,this.update(),this._currentChanged.emit({previousIndex:t,previousTitle:i,currentIndex:s,currentTitle:n})}get name(){return this._name}set name(e){this._name=e,e?this.contentNode.setAttribute("aria-label",e):this.contentNode.removeAttribute("aria-label")}get orientation(){return this._orientation}set orientation(e){this._orientation!==e&&(this._releaseMouse(),this._orientation=e,this.dataset.orientation=e,this.contentNode.setAttribute("aria-orientation",e))}get addButtonEnabled(){return this._addButtonEnabled}set addButtonEnabled(e){this._addButtonEnabled!==e&&(this._addButtonEnabled=e,e?this.addButtonNode.classList.remove("lm-mod-hidden"):this.addButtonNode.classList.add("lm-mod-hidden"))}get titles(){return this._titles}get contentNode(){return this.node.getElementsByClassName("lm-TabBar-content")[0]}get addButtonNode(){return this.node.getElementsByClassName("lm-TabBar-addButton")[0]}addTab(e){return this.insertTab(this._titles.length,e)}insertTab(e,t){this._releaseMouse();let i=T.asTitle(t),s=this._titles.indexOf(i),n=Math.max(0,Math.min(e,this._titles.length));return -1===s?(W.RO.insert(this._titles,n,i),i.changed.connect(this._onTitleChanged,this),this.update(),this._adjustCurrentForInsert(n,i),i):(n===this._titles.length&&n--,s===n||(W.RO.move(this._titles,s,n),this.update(),this._adjustCurrentForMove(s,n)),i)}removeTab(e){this.removeTabAt(this._titles.indexOf(e))}removeTabAt(e){this._releaseMouse();let t=W.RO.removeAt(this._titles,e);t&&(t.changed.disconnect(this._onTitleChanged,this),t===this._previousTitle&&(this._previousTitle=null),this.update(),this._adjustCurrentForRemove(e,t))}clearTabs(){if(0===this._titles.length)return;for(let e of(this._releaseMouse(),this._titles))e.changed.disconnect(this._onTitleChanged,this);let e=this.currentIndex,t=this.currentTitle;this._currentIndex=-1,this._previousTitle=null,this._titles.length=0,this.update(),-1!==e&&this._currentChanged.emit({previousIndex:e,previousTitle:t,currentIndex:-1,currentTitle:null})}releaseMouse(){this._releaseMouse()}handleEvent(e){switch(e.type){case"pointerdown":this._evtPointerDown(e);break;case"pointermove":this._evtPointerMove(e);break;case"pointerup":this._evtPointerUp(e);break;case"dblclick":this._evtDblClick(e);break;case"keydown":this._evtKeyDown(e);break;case"contextmenu":e.preventDefault(),e.stopPropagation()}}onBeforeAttach(e){this.node.addEventListener("pointerdown",this),this.node.addEventListener("dblclick",this)}onAfterDetach(e){this.node.removeEventListener("pointerdown",this),this.node.removeEventListener("dblclick",this),this._releaseMouse()}onUpdateRequest(e){let t=this._titles,i=this.renderer,s=this.currentTitle,n=Array(t.length);for(let e=0,r=t.length;e<r;++e){let a=t[e],o=a===s,h=o?r:r-e-1;n[e]=i.renderTab({title:a,current:o,zIndex:h})}Y.Iw.render(n,this.contentNode)}_evtDblClick(e){if(!this.titlesEditable)return;let t=this.contentNode.children,i=W.RO.findFirstIndex(t,t=>P.TE.hitTest(t,e.clientX,e.clientY));if(-1===i)return;let s=this.titles[i],n=t[i].querySelector(".lm-TabBar-tabLabel");if(n&&n.contains(e.target)){let e=s.label||"",t=n.innerHTML;n.innerHTML="";let i=document.createElement("input");i.classList.add("lm-TabBar-tabInput"),i.value=e,n.appendChild(i);let r=()=>{i.removeEventListener("blur",r),n.innerHTML=t};i.addEventListener("dblclick",e=>e.stopPropagation()),i.addEventListener("blur",r),i.addEventListener("keydown",e=>{"Enter"===e.key?(""!==i.value&&(s.label=s.caption=i.value),r()):"Escape"===e.key&&r()}),i.select(),i.focus(),n.children.length>0&&n.children[0].focus()}}_evtKeyDown(e){e.preventDefault(),e.stopPropagation(),27===e.keyCode&&this._releaseMouse()}_evtPointerDown(e){if(0!==e.button&&1!==e.button||this._dragData)return;let t=this.addButtonEnabled&&this.addButtonNode.contains(e.target),i=this.contentNode.children,s=W.RO.findFirstIndex(i,t=>P.TE.hitTest(t,e.clientX,e.clientY));if(-1===s&&!t||(e.preventDefault(),e.stopPropagation(),this._dragData={tab:i[s],index:s,pressX:e.clientX,pressY:e.clientY,tabPos:-1,tabSize:-1,tabPressPos:-1,targetIndex:-1,tabLayout:null,contentRect:null,override:null,dragActive:!1,dragAborted:!1,detachRequested:!1},this.document.addEventListener("pointerup",this,!0),1===e.button||t))return;let n=i[s].querySelector(this.renderer.closeIconSelector);!(n&&n.contains(e.target))&&(this.tabsMovable&&(this.document.addEventListener("pointermove",this,!0),this.document.addEventListener("keydown",this,!0),this.document.addEventListener("contextmenu",this,!0)),this.allowDeselect&&this.currentIndex===s?this.currentIndex=-1:this.currentIndex=s,-1!==this.currentIndex&&this._tabActivateRequested.emit({index:this.currentIndex,title:this.currentTitle}))}_evtPointerMove(e){let t=this._dragData;if(!t)return;e.preventDefault(),e.stopPropagation();let i=this.contentNode.children;if(t.dragActive||T.dragExceeded(t,e)){if(!t.dragActive){let e=t.tab.getBoundingClientRect();"horizontal"===this._orientation?(t.tabPos=t.tab.offsetLeft,t.tabSize=e.width,t.tabPressPos=t.pressX-e.left):(t.tabPos=t.tab.offsetTop,t.tabSize=e.height,t.tabPressPos=t.pressY-e.top),t.tabLayout=T.snapTabLayout(i,this._orientation),t.contentRect=this.contentNode.getBoundingClientRect(),t.override=V.n.overrideCursor("default"),t.tab.classList.add("lm-mod-dragging"),this.addClass("lm-mod-dragging"),t.dragActive=!0}if(!t.detachRequested&&T.detachExceeded(t,e)){t.detachRequested=!0;let s=t.index,n=e.clientX,r=e.clientY,a=i[s],o=this._titles[s];if(this._tabDetachRequested.emit({index:s,title:o,tab:a,clientX:n,clientY:r}),t.dragAborted)return}T.layoutTabs(i,t,e,this._orientation)}}_evtPointerUp(e){if(0!==e.button&&1!==e.button)return;let t=this._dragData;if(t){if(e.preventDefault(),e.stopPropagation(),this.document.removeEventListener("pointermove",this,!0),this.document.removeEventListener("pointerup",this,!0),this.document.removeEventListener("keydown",this,!0),this.document.removeEventListener("contextmenu",this,!0),!t.dragActive){if(this._dragData=null,this.addButtonEnabled&&this.addButtonNode.contains(e.target)){this._addRequested.emit(void 0);return}let i=this.contentNode.children,s=W.RO.findFirstIndex(i,t=>P.TE.hitTest(t,e.clientX,e.clientY));if(s!==t.index)return;let n=this._titles[s];if(!n.closable)return;if(1===e.button){this._tabCloseRequested.emit({index:s,title:n});return}let r=i[s].querySelector(this.renderer.closeIconSelector);r&&r.contains(e.target)&&this._tabCloseRequested.emit({index:s,title:n});return}0===e.button&&(T.finalizeTabPosition(t,this._orientation),t.tab.classList.remove("lm-mod-dragging"),setTimeout(()=>{if(t.dragAborted)return;this._dragData=null,T.resetTabPositions(this.contentNode.children,this._orientation),t.override.dispose(),this.removeClass("lm-mod-dragging");let e=t.index,i=t.targetIndex;-1!==i&&e!==i&&(W.RO.move(this._titles,e,i),this._adjustCurrentForMove(e,i),this._tabMoved.emit({fromIndex:e,toIndex:i,title:this._titles[i]}),q.pB.sendMessage(this,J.Msg.UpdateRequest))},T.parseTransitionDuration(t.tab)))}}_releaseMouse(){let e=this._dragData;e&&(this._dragData=null,this.document.removeEventListener("pointermove",this,!0),this.document.removeEventListener("pointerup",this,!0),this.document.removeEventListener("keydown",this,!0),this.document.removeEventListener("contextmenu",this,!0),e.dragAborted=!0,e.dragActive&&(T.resetTabPositions(this.contentNode.children,this._orientation),e.override.dispose(),e.tab.classList.remove("lm-mod-dragging"),this.removeClass("lm-mod-dragging")))}_adjustCurrentForInsert(e,t){let i=this.currentTitle,s=this._currentIndex,n=this.insertBehavior;if("select-tab"===n||"select-tab-if-needed"===n&&-1===s){this._currentIndex=e,this._previousTitle=i,this._currentChanged.emit({previousIndex:s,previousTitle:i,currentIndex:e,currentTitle:t});return}s>=e&&this._currentIndex++}_adjustCurrentForMove(e,t){this._currentIndex===e?this._currentIndex=t:this._currentIndex<e&&this._currentIndex>=t?this._currentIndex++:this._currentIndex>e&&this._currentIndex<=t&&this._currentIndex--}_adjustCurrentForRemove(e,t){let i=this._currentIndex,s=this.removeBehavior;if(i!==e){i>e&&this._currentIndex--;return}if(0===this._titles.length){this._currentIndex=-1,this._currentChanged.emit({previousIndex:e,previousTitle:t,currentIndex:-1,currentTitle:null});return}if("select-tab-after"===s){this._currentIndex=Math.min(e,this._titles.length-1),this._currentChanged.emit({previousIndex:e,previousTitle:t,currentIndex:this._currentIndex,currentTitle:this.currentTitle});return}if("select-tab-before"===s){this._currentIndex=Math.max(0,e-1),this._currentChanged.emit({previousIndex:e,previousTitle:t,currentIndex:this._currentIndex,currentTitle:this.currentTitle});return}if("select-previous-tab"===s){this._previousTitle?(this._currentIndex=this._titles.indexOf(this._previousTitle),this._previousTitle=null):this._currentIndex=Math.min(e,this._titles.length-1),this._currentChanged.emit({previousIndex:e,previousTitle:t,currentIndex:this._currentIndex,currentTitle:this.currentTitle});return}this._currentIndex=-1,this._currentChanged.emit({previousIndex:e,previousTitle:t,currentIndex:-1,currentTitle:null})}_onTitleChanged(e){this.update()}}!function(e){class t{constructor(){this.closeIconSelector=".lm-TabBar-tabCloseIcon",this._tabID=0,this._tabKeys=new WeakMap,this._uuid=++t._nInstance}renderTab(e){let t=e.title.caption,i=this.createTabKey(e),s=this.createTabStyle(e),n=this.createTabClass(e),r=this.createTabDataset(e),a=this.createTabARIA(e);return e.title.closable?Y.h.li({id:i,key:i,className:n,title:t,style:s,dataset:r,...a},this.renderIcon(e),this.renderLabel(e),this.renderCloseIcon(e)):Y.h.li({id:i,key:i,className:n,title:t,style:s,dataset:r,...a},this.renderIcon(e),this.renderLabel(e))}renderIcon(e){let{title:t}=e,i=this.createIconClass(e);return Y.h.div({className:i},t.icon,t.iconLabel)}renderLabel(e){return Y.h.div({className:"lm-TabBar-tabLabel"},e.title.label)}renderCloseIcon(e){return Y.h.div({className:"lm-TabBar-tabCloseIcon"})}createTabKey(e){let t=this._tabKeys.get(e.title);return void 0===t&&(t=`tab-key-${this._uuid}-${this._tabID++}`,this._tabKeys.set(e.title,t)),t}createTabStyle(e){return{zIndex:`${e.zIndex}`}}createTabClass(e){let t="lm-TabBar-tab";return e.title.className&&(t+=` ${e.title.className}`),e.title.closable&&(t+=" lm-mod-closable"),e.current&&(t+=" lm-mod-current"),t}createTabDataset(e){return e.title.dataset}createTabARIA(e){return{role:"tab","aria-selected":e.current.toString()}}createIconClass(e){let t="lm-TabBar-tabIcon",i=e.title.iconClass;return i?`${t} ${i}`:t}}t._nInstance=0,e.Renderer=t,e.defaultRenderer=new t,e.addButtonSelector=".lm-TabBar-addButton"}(eu||(eu={})),(l=T||(T={})).DRAG_THRESHOLD=5,l.DETACH_THRESHOLD=20,l.createNode=function(){let e=document.createElement("div"),t=document.createElement("ul");t.setAttribute("role","tablist"),t.className="lm-TabBar-content",e.appendChild(t);let i=document.createElement("div");return i.className="lm-TabBar-addButton lm-mod-hidden",e.appendChild(i),e},l.asTitle=function(e){return e instanceof j?e:new j(e)},l.parseTransitionDuration=function(e){return 1e3*(parseFloat(window.getComputedStyle(e).transitionDuration)||0)},l.snapTabLayout=function(e,t){let i=Array(e.length);for(let s=0,n=e.length;s<n;++s){let n=e[s],r=window.getComputedStyle(n);"horizontal"===t?i[s]={pos:n.offsetLeft,size:n.offsetWidth,margin:parseFloat(r.marginLeft)||0}:i[s]={pos:n.offsetTop,size:n.offsetHeight,margin:parseFloat(r.marginTop)||0}}return i},l.dragExceeded=function(e,t){let i=Math.abs(t.clientX-e.pressX),s=Math.abs(t.clientY-e.pressY);return i>=l.DRAG_THRESHOLD||s>=l.DRAG_THRESHOLD},l.detachExceeded=function(e,t){let i=e.contentRect;return t.clientX<i.left-l.DETACH_THRESHOLD||t.clientX>=i.right+l.DETACH_THRESHOLD||t.clientY<i.top-l.DETACH_THRESHOLD||t.clientY>=i.bottom+l.DETACH_THRESHOLD},l.layoutTabs=function(e,t,i,s){let n,r,a,o;"horizontal"===s?(n=t.pressX,r=i.clientX-t.contentRect.left,a=i.clientX,o=t.contentRect.width):(n=t.pressY,r=i.clientY-t.contentRect.top,a=i.clientY,o=t.contentRect.height);let h=t.index,d=r-t.tabPressPos,l=d+t.tabSize;for(let i=0,r=e.length;i<r;++i){let r;let c=t.tabLayout[i],u=c.pos+(c.size>>1);i<t.index&&d<u?(r=`${t.tabSize+t.tabLayout[i+1].margin}px`,h=Math.min(h,i)):i>t.index&&l>u?(r=`${-t.tabSize-c.margin}px`,h=Math.max(h,i)):r=i===t.index?`${Math.max(-t.tabPos,Math.min(a-n,o-(t.tabPos+t.tabSize)))}px`:"","horizontal"===s?e[i].style.left=r:e[i].style.top=r}t.targetIndex=h},l.finalizeTabPosition=function(e,t){let i,s;if(i="horizontal"===t?e.contentRect.width:e.contentRect.height,e.targetIndex===e.index)s=0;else if(e.targetIndex>e.index){let t=e.tabLayout[e.targetIndex];s=t.pos+t.size-e.tabSize-e.tabPos}else s=e.tabLayout[e.targetIndex].pos-e.tabPos;let n=i-(e.tabPos+e.tabSize),r=Math.max(-e.tabPos,Math.min(s,n));"horizontal"===t?e.tab.style.left=`${r}px`:e.tab.style.top=`${r}px`},l.resetTabPositions=function(e,t){for(let i of e)"horizontal"===t?i.style.left="":i.style.top=""};class em extends Q{constructor(e){super(),this._spacing=4,this._dirty=!1,this._root=null,this._box=null,this._items=new Map,this.renderer=e.renderer,void 0!==e.spacing&&(this._spacing=et.clampDimension(e.spacing)),this._document=e.document||document,this._hiddenMode=void 0!==e.hiddenMode?e.hiddenMode:J.HiddenMode.Display}dispose(){let e=this[Symbol.iterator]();for(let t of(this._items.forEach(e=>{e.dispose()}),this._box=null,this._root=null,this._items.clear(),e))t.dispose();super.dispose()}get hiddenMode(){return this._hiddenMode}set hiddenMode(e){if(this._hiddenMode!==e){for(let t of(this._hiddenMode=e,this.tabBars()))if(t.titles.length>1)for(let e of t.titles)e.owner.hiddenMode=this._hiddenMode}}get spacing(){return this._spacing}set spacing(e){e=et.clampDimension(e),this._spacing!==e&&(this._spacing=e,this.parent&&this.parent.fit())}get isEmpty(){return null===this._root}[Symbol.iterator](){return this._root?this._root.iterAllWidgets():(0,W.cS)()}widgets(){return this._root?this._root.iterUserWidgets():(0,W.cS)()}selectedWidgets(){return this._root?this._root.iterSelectedWidgets():(0,W.cS)()}tabBars(){return this._root?this._root.iterTabBars():(0,W.cS)()}handles(){return this._root?this._root.iterHandles():(0,W.cS)()}moveHandle(e,t,i){let s,n=e.classList.contains("lm-mod-hidden");if(!this._root||n)return;let r=this._root.findSplitNode(e);r&&0!=(s="horizontal"===r.node.orientation?t-e.offsetLeft:i-e.offsetTop)&&(r.node.holdSizes(),_.adjust(r.node.sizers,r.index,s),this.parent&&this.parent.update())}saveLayout(){return this._root?(this._root.holdAllSizes(),{main:this._root.createConfig()}):{main:null}}restoreLayout(e){let t,i=new Set;t=e.main?E.normalizeAreaConfig(e.main,i):null;let s=this.widgets(),n=this.tabBars(),r=this.handles();for(let e of(this._root=null,s))i.has(e)||(e.parent=null);for(let e of n)e.dispose();for(let e of r)e.parentNode&&e.parentNode.removeChild(e);for(let e of i)e.parent=this.parent;t?this._root=E.realizeAreaConfig(t,{createTabBar:e=>this._createTabBar(),createHandle:()=>this._createHandle()},this._document):this._root=null,this.parent&&(i.forEach(e=>{this.attachWidget(e)}),this.parent.fit())}addWidget(e,t={}){let i=t.ref||null,s=t.mode||"tab-after",n=null;if(this._root&&i&&(n=this._root.findTabNode(i)),i&&!n)throw Error("Reference widget is not in the layout.");switch(e.parent=this.parent,s){case"tab-after":this._insertTab(e,i,n,!0);break;case"tab-before":this._insertTab(e,i,n,!1);break;case"split-top":this._insertSplit(e,i,n,"vertical",!1);break;case"split-left":this._insertSplit(e,i,n,"horizontal",!1);break;case"split-right":this._insertSplit(e,i,n,"horizontal",!0);break;case"split-bottom":this._insertSplit(e,i,n,"vertical",!0)}this.parent&&(this.attachWidget(e),this.parent.fit())}removeWidget(e){this._removeWidget(e),this.parent&&(this.detachWidget(e),this.parent.fit())}hitTestTabAreas(e,t){if(!this._root||!this.parent||!this.parent.isVisible)return null;this._box||(this._box=P.TE.boxSizing(this.parent.node));let i=this.parent.node.getBoundingClientRect(),s=e-i.left-this._box.borderLeft,n=t-i.top-this._box.borderTop,r=this._root.hitTestTabNodes(s,n);if(!r)return null;let{tabBar:a,top:o,left:h,width:d,height:l}=r,c=this._box.borderLeft+this._box.borderRight,u=this._box.borderTop+this._box.borderBottom;return{tabBar:a,x:s,y:n,top:o,left:h,right:i.width-c-(h+d),bottom:i.height-u-(o+l),width:d,height:l}}init(){for(let e of(super.init(),this))this.attachWidget(e);for(let e of this.handles())this.parent.node.appendChild(e);this.parent.fit()}attachWidget(e){this.parent.node!==e.node.parentNode&&(this._items.set(e,new Z(e)),this.parent.isAttached&&q.pB.sendMessage(e,J.Msg.BeforeAttach),this.parent.node.appendChild(e.node),this.parent.isAttached&&q.pB.sendMessage(e,J.Msg.AfterAttach))}detachWidget(e){if(this.parent.node!==e.node.parentNode)return;this.parent.isAttached&&q.pB.sendMessage(e,J.Msg.BeforeDetach),this.parent.node.removeChild(e.node),this.parent.isAttached&&q.pB.sendMessage(e,J.Msg.AfterDetach);let t=this._items.get(e);t&&(this._items.delete(e),t.dispose())}onBeforeShow(e){super.onBeforeShow(e),this.parent.update()}onBeforeAttach(e){super.onBeforeAttach(e),this.parent.fit()}onChildShown(e){this.parent.fit()}onChildHidden(e){this.parent.fit()}onResize(e){this.parent.isVisible&&this._update(e.width,e.height)}onUpdateRequest(e){this.parent.isVisible&&this._update(-1,-1)}onFitRequest(e){this.parent.isAttached&&this._fit()}_removeWidget(e){if(!this._root)return;let t=this._root.findTabNode(e);if(!t)return;if(E.removeAria(e),t.tabBar.titles.length>1){if(t.tabBar.removeTab(e.title),this._hiddenMode===J.HiddenMode.Scale&&1==t.tabBar.titles.length){let e=t.tabBar.titles[0].owner;e.hiddenMode=J.HiddenMode.Display}return}if(t.tabBar.dispose(),this._root===t){this._root=null;return}this._root.holdAllSizes();let i=t.parent;t.parent=null;let s=W.RO.removeFirstOf(i.children,t),n=W.RO.removeAt(i.handles,s);if(W.RO.removeAt(i.sizers,s),n.parentNode&&n.parentNode.removeChild(n),i.children.length>1){i.syncHandles();return}let r=i.parent;i.parent=null;let a=i.children[0],o=i.handles[0];if(i.children.length=0,i.handles.length=0,i.sizers.length=0,o.parentNode&&o.parentNode.removeChild(o),this._root===i){a.parent=null,this._root=a;return}let h=r,d=h.children.indexOf(i);if(a instanceof E.TabLayoutNode){a.parent=h,h.children[d]=a;return}let l=W.RO.removeAt(h.handles,d);W.RO.removeAt(h.children,d),W.RO.removeAt(h.sizers,d),l.parentNode&&l.parentNode.removeChild(l);for(let e=0,t=a.children.length;e<t;++e){let t=a.children[e],i=a.handles[e],s=a.sizers[e];W.RO.insert(h.children,d+e,t),W.RO.insert(h.handles,d+e,i),W.RO.insert(h.sizers,d+e,s),t.parent=h}a.children.length=0,a.handles.length=0,a.sizers.length=0,a.parent=null,h.syncHandles()}_insertTab(e,t,i,s){let n;if(e!==t){if(!this._root){let t=new E.TabLayoutNode(this._createTabBar());t.tabBar.addTab(e.title),this._root=t,E.addAria(e,t.tabBar);return}if(i||(i=this._root.findFirstTabNode()),-1===i.tabBar.titles.indexOf(e.title)&&(this._removeWidget(e),e.hide()),n=t?i.tabBar.titles.indexOf(t.title):i.tabBar.currentIndex,this._hiddenMode===J.HiddenMode.Scale){if(0===i.tabBar.titles.length)e.hiddenMode=J.HiddenMode.Display;else if(1==i.tabBar.titles.length){let e=i.tabBar.titles[0].owner;e.hiddenMode=J.HiddenMode.Scale}else e.hiddenMode=J.HiddenMode.Scale}else e.hiddenMode=this._hiddenMode;i.tabBar.insertTab(n+(s?1:0),e.title),E.addAria(e,i.tabBar)}}_insertSplit(e,t,i,s,n){if(e===t&&i&&1===i.tabBar.titles.length)return;this._removeWidget(e);let r=new E.TabLayoutNode(this._createTabBar());if(r.tabBar.addTab(e.title),E.addAria(e,r.tabBar),!this._root){this._root=r;return}if(!i||!i.parent){let e=this._splitRoot(s),t=n?e.children.length:0;e.normalizeSizes();let a=E.createSizer(i?1:E.GOLDEN_RATIO);W.RO.insert(e.children,t,r),W.RO.insert(e.sizers,t,a),W.RO.insert(e.handles,t,this._createHandle()),r.parent=e,e.normalizeSizes(),e.syncHandles();return}let a=i.parent;if(a.orientation===s){let e=a.children.indexOf(i);a.normalizeSizes();let t=a.sizers[e].sizeHint/=2,s=e+(n?1:0);W.RO.insert(a.children,s,r),W.RO.insert(a.sizers,s,E.createSizer(t)),W.RO.insert(a.handles,s,this._createHandle()),r.parent=a,a.syncHandles();return}let o=W.RO.removeFirstOf(a.children,i),h=new E.SplitLayoutNode(s);h.normalized=!0,h.children.push(i),h.sizers.push(E.createSizer(.5)),h.handles.push(this._createHandle()),i.parent=h;let d=n?1:0;W.RO.insert(h.children,d,r),W.RO.insert(h.sizers,d,E.createSizer(.5)),W.RO.insert(h.handles,d,this._createHandle()),r.parent=h,h.syncHandles(),W.RO.insert(a.children,o,h),h.parent=a}_splitRoot(e){let t=this._root;if(t instanceof E.SplitLayoutNode&&t.orientation===e)return t;let i=this._root=new E.SplitLayoutNode(e);return t&&(i.children.push(t),i.sizers.push(E.createSizer(0)),i.handles.push(this._createHandle()),t.parent=i),i}_fit(){let e=0,t=0;if(this._root){let i=this._root.fit(this._spacing,this._items);e=i.minWidth,t=i.minHeight}let i=this._box=P.TE.boxSizing(this.parent.node);e+=i.horizontalSum,t+=i.verticalSum;let s=this.parent.node.style;s.minWidth=`${e}px`,s.minHeight=`${t}px`,this._dirty=!0,this.parent.parent&&q.pB.sendMessage(this.parent.parent,J.Msg.FitRequest),this._dirty&&q.pB.sendMessage(this.parent,J.Msg.UpdateRequest)}_update(e,t){if(this._dirty=!1,!this._root)return;e<0&&(e=this.parent.node.offsetWidth),t<0&&(t=this.parent.node.offsetHeight),this._box||(this._box=P.TE.boxSizing(this.parent.node));let i=this._box.paddingTop,s=this._box.paddingLeft,n=e-this._box.horizontalSum,r=t-this._box.verticalSum;this._root.update(i,s,n,r,this._spacing,this._items)}_createTabBar(){let e=this.renderer.createTabBar(this._document);return e.orientation="horizontal",this.parent&&(e.parent=this.parent,this.attachWidget(e)),e}_createHandle(){let e=this.renderer.createHandle(),t=e.style;return t.position="absolute",t.contain="strict",t.top="0",t.left="0",t.width="0",t.height="0",this.parent&&this.parent.node.appendChild(e),e}}!function(e){function t(e){let t=new G;return t.sizeHint=e,t.size=e,t}e.GOLDEN_RATIO=.618,e.createSizer=t,e.normalizeAreaConfig=function e(t,i){return"tab-area"===t.type?function(e,t){if(0===e.widgets.length)return null;let i=[];for(let s of e.widgets)t.has(s)||(t.add(s),i.push(s));if(0===i.length)return null;let s=e.currentIndex;return -1!==s&&(s<0||s>=i.length)&&(s=0),{type:"tab-area",widgets:i,currentIndex:s}}(t,i):function(t,i){let s=t.orientation,n=[],r=[];for(let a=0,o=t.children.length;a<o;++a){let o=e(t.children[a],i);o&&("tab-area"===o.type||o.orientation!==s?(n.push(o),r.push(Math.abs(t.sizes[a]||0))):(n.push(...o.children),r.push(...o.sizes)))}return 0===n.length?null:1===n.length?n[0]:{type:"split-area",orientation:s,children:n,sizes:r}}(t,i)},e.realizeAreaConfig=function n(r,a,o){let h;return"tab-area"===r.type?function(t,s,n){let r=s.createTabBar(n);for(let i of t.widgets)i.hide(),r.addTab(i.title),e.addAria(i,r);return r.currentIndex=t.currentIndex,new i(r)}(r,a,o):(h=new s(r.orientation),r.children.forEach((e,i)=>{let s=n(e,a,o),d=t(r.sizes[i]),l=a.createHandle();h.children.push(s),h.handles.push(l),h.sizers.push(d),s.parent=h}),h.syncHandles(),h.normalizeSizes(),h)};class i{constructor(e){this.parent=null,this._top=0,this._left=0,this._width=0,this._height=0;let t=new G,i=new G;t.stretch=0,i.stretch=1,this.tabBar=e,this.sizers=[t,i]}get top(){return this._top}get left(){return this._left}get width(){return this._width}get height(){return this._height}*iterAllWidgets(){yield this.tabBar,yield*this.iterUserWidgets()}*iterUserWidgets(){for(let e of this.tabBar.titles)yield e.owner}*iterSelectedWidgets(){let e=this.tabBar.currentTitle;e&&(yield e.owner)}*iterTabBars(){yield this.tabBar}*iterHandles(){}findTabNode(e){return -1!==this.tabBar.titles.indexOf(e.title)?this:null}findSplitNode(e){return null}findFirstTabNode(){return this}hitTestTabNodes(e,t){return e<this._left||e>=this._left+this._width||t<this._top||t>=this._top+this._height?null:this}createConfig(){return{type:"tab-area",widgets:this.tabBar.titles.map(e=>e.owner),currentIndex:this.tabBar.currentIndex}}holdAllSizes(){}fit(e,t){let i=0,s=0,n=t.get(this.tabBar),r=this.tabBar.currentTitle,a=r?t.get(r.owner):void 0,[o,h]=this.sizers;return n&&n.fit(),a&&a.fit(),n&&!n.isHidden?(i=Math.max(i,n.minWidth),s+=n.minHeight,o.minSize=n.minHeight,o.maxSize=n.maxHeight):(o.minSize=0,o.maxSize=0),a&&!a.isHidden?(i=Math.max(i,a.minWidth),s+=a.minHeight,h.minSize=a.minHeight,h.maxSize=1/0):(h.minSize=0,h.maxSize=1/0),{minWidth:i,minHeight:s,maxWidth:1/0,maxHeight:1/0}}update(e,t,i,s,n,r){this._top=t,this._left=e,this._width=i,this._height=s;let a=r.get(this.tabBar),o=this.tabBar.currentTitle,h=o?r.get(o.owner):void 0;if(_.calc(this.sizers,s),a&&!a.isHidden){let s=this.sizers[0].size;a.update(e,t,i,s),t+=s}if(h&&!h.isHidden){let s=this.sizers[1].size;h.update(e,t,i,s)}}}e.TabLayoutNode=i;class s{constructor(e){this.parent=null,this.normalized=!1,this.children=[],this.sizers=[],this.handles=[],this.orientation=e}*iterAllWidgets(){for(let e of this.children)yield*e.iterAllWidgets()}*iterUserWidgets(){for(let e of this.children)yield*e.iterUserWidgets()}*iterSelectedWidgets(){for(let e of this.children)yield*e.iterSelectedWidgets()}*iterTabBars(){for(let e of this.children)yield*e.iterTabBars()}*iterHandles(){for(let e of(yield*this.handles,this.children))yield*e.iterHandles()}findTabNode(e){for(let t=0,i=this.children.length;t<i;++t){let i=this.children[t].findTabNode(e);if(i)return i}return null}findSplitNode(e){let t=this.handles.indexOf(e);if(-1!==t)return{index:t,node:this};for(let t=0,i=this.children.length;t<i;++t){let i=this.children[t].findSplitNode(e);if(i)return i}return null}findFirstTabNode(){return 0===this.children.length?null:this.children[0].findFirstTabNode()}hitTestTabNodes(e,t){for(let i=0,s=this.children.length;i<s;++i){let s=this.children[i].hitTestTabNodes(e,t);if(s)return s}return null}createConfig(){let e=this.orientation,t=this.createNormalizedSizes();return{type:"split-area",orientation:e,children:this.children.map(e=>e.createConfig()),sizes:t}}syncHandles(){this.handles.forEach((e,t)=>{e.setAttribute("data-orientation",this.orientation),t===this.handles.length-1?e.classList.add("lm-mod-hidden"):e.classList.remove("lm-mod-hidden")})}holdSizes(){for(let e of this.sizers)e.sizeHint=e.size}holdAllSizes(){for(let e of this.children)e.holdAllSizes();this.holdSizes()}normalizeSizes(){let e=this.sizers.length;if(0===e)return;this.holdSizes();let t=this.sizers.reduce((e,t)=>e+t.sizeHint,0);if(0===t)for(let t of this.sizers)t.size=t.sizeHint=1/e;else for(let e of this.sizers)e.size=e.sizeHint/=t;this.normalized=!0}createNormalizedSizes(){let e=this.sizers.length;if(0===e)return[];let t=this.sizers.map(e=>e.size),i=t.reduce((e,t)=>e+t,0);if(0===i)for(let i=t.length-1;i>-1;i--)t[i]=1/e;else for(let e=t.length-1;e>-1;e--)t[e]/=i;return t}fit(e,t){let i="horizontal"===this.orientation,s=Math.max(0,this.children.length-1)*e,n=i?s:0,r=i?0:s;for(let s=0,a=this.children.length;s<a;++s){let a=this.children[s].fit(e,t);i?(r=Math.max(r,a.minHeight),n+=a.minWidth,this.sizers[s].minSize=a.minWidth):(n=Math.max(n,a.minWidth),r+=a.minHeight,this.sizers[s].minSize=a.minHeight)}return{minWidth:n,minHeight:r,maxWidth:1/0,maxHeight:1/0}}update(e,t,i,s,n,r){let a="horizontal"===this.orientation,o=Math.max(0,(a?i:s)-Math.max(0,this.children.length-1)*n);if(this.normalized){for(let e of this.sizers)e.sizeHint*=o;this.normalized=!1}_.calc(this.sizers,o);for(let o=0,h=this.children.length;o<h;++o){let h=this.children[o],d=this.sizers[o].size,l=this.handles[o].style;a?(h.update(e,t,d,s,n,r),e+=d,l.top=`${t}px`,l.left=`${e}px`,l.width=`${n}px`,l.height=`${s}px`,e+=n):(h.update(e,t,i,d,n,r),t+=d,l.top=`${t}px`,l.left=`${e}px`,l.width=`${i}px`,l.height=`${n}px`,t+=n)}}}e.SplitLayoutNode=s,e.addAria=function(e,t){e.node.setAttribute("role","tabpanel");let i=t.renderer;if(i instanceof eu.Renderer){let t=i.createTabKey({title:e.title,current:!1,zIndex:0});e.node.setAttribute("aria-labelledby",t)}},e.removeAria=function(e){e.node.removeAttribute("role"),e.node.removeAttribute("aria-labelledby")}}(E||(E={}));class ep extends J{constructor(e={}){super(),this._drag=null,this._tabsMovable=!0,this._tabsConstrained=!1,this._addButtonEnabled=!1,this._pressData=null,this._layoutModified=new $.Signal(this),this._addRequested=new $.Signal(this),this.addClass("lm-DockPanel"),this._document=e.document||document,this._mode=e.mode||"multiple-document",this._renderer=e.renderer||ep.defaultRenderer,this._edges=e.edges||R.DEFAULT_EDGES,void 0!==e.tabsMovable&&(this._tabsMovable=e.tabsMovable),void 0!==e.tabsConstrained&&(this._tabsConstrained=e.tabsConstrained),void 0!==e.addButtonEnabled&&(this._addButtonEnabled=e.addButtonEnabled),this.dataset.mode=this._mode,this.layout=new em({document:this._document,renderer:{createTabBar:()=>this._createTabBar(),createHandle:()=>this._createHandle()},spacing:e.spacing,hiddenMode:e.hiddenMode}),this.overlay=e.overlay||new ep.Overlay,this.node.appendChild(this.overlay.node)}dispose(){this._releaseMouse(),this.overlay.hide(0),this._drag&&this._drag.dispose(),super.dispose()}get hiddenMode(){return this.layout.hiddenMode}set hiddenMode(e){this.layout.hiddenMode=e}get layoutModified(){return this._layoutModified}get addRequested(){return this._addRequested}get renderer(){return this.layout.renderer}get spacing(){return this.layout.spacing}set spacing(e){this.layout.spacing=e}get mode(){return this._mode}set mode(e){if(this._mode===e)return;this._mode=e,this.dataset.mode=e;let t=this.layout;switch(e){case"multiple-document":for(let e of t.tabBars())e.show();break;case"single-document":t.restoreLayout(R.createSingleDocumentConfig(this));break;default:throw"unreachable"}q.pB.postMessage(this,R.LayoutModified)}get tabsMovable(){return this._tabsMovable}set tabsMovable(e){for(let t of(this._tabsMovable=e,this.tabBars()))t.tabsMovable=e}get tabsConstrained(){return this._tabsConstrained}set tabsConstrained(e){this._tabsConstrained=e}get addButtonEnabled(){return this._addButtonEnabled}set addButtonEnabled(e){for(let t of(this._addButtonEnabled=e,this.tabBars()))t.addButtonEnabled=e}get isEmpty(){return this.layout.isEmpty}*widgets(){yield*this.layout.widgets()}*selectedWidgets(){yield*this.layout.selectedWidgets()}*tabBars(){yield*this.layout.tabBars()}*handles(){yield*this.layout.handles()}selectWidget(e){let t=(0,W.sE)(this.tabBars(),t=>-1!==t.titles.indexOf(e.title));if(!t)throw Error("Widget is not contained in the dock panel.");t.currentTitle=e.title}activateWidget(e){this.selectWidget(e),e.activate()}saveLayout(){return this.layout.saveLayout()}restoreLayout(e){this._mode="multiple-document",this.layout.restoreLayout(e),(P.t4.IS_EDGE||P.t4.IS_IE)&&q.pB.flush(),q.pB.postMessage(this,R.LayoutModified)}addWidget(e,t={}){"single-document"===this._mode?this.layout.addWidget(e):this.layout.addWidget(e,t),q.pB.postMessage(this,R.LayoutModified)}processMessage(e){"layout-modified"===e.type?this._layoutModified.emit(void 0):super.processMessage(e)}handleEvent(e){switch(e.type){case"lm-dragenter":this._evtDragEnter(e);break;case"lm-dragleave":this._evtDragLeave(e);break;case"lm-dragover":this._evtDragOver(e);break;case"lm-drop":this._evtDrop(e);break;case"pointerdown":this._evtPointerDown(e);break;case"pointermove":this._evtPointerMove(e);break;case"pointerup":this._evtPointerUp(e);break;case"keydown":this._evtKeyDown(e);break;case"contextmenu":e.preventDefault(),e.stopPropagation()}}onBeforeAttach(e){this.node.addEventListener("lm-dragenter",this),this.node.addEventListener("lm-dragleave",this),this.node.addEventListener("lm-dragover",this),this.node.addEventListener("lm-drop",this),this.node.addEventListener("pointerdown",this)}onAfterDetach(e){this.node.removeEventListener("lm-dragenter",this),this.node.removeEventListener("lm-dragleave",this),this.node.removeEventListener("lm-dragover",this),this.node.removeEventListener("lm-drop",this),this.node.removeEventListener("pointerdown",this),this._releaseMouse()}onChildAdded(e){R.isGeneratedTabBarProperty.get(e.child)||e.child.addClass("lm-DockPanel-widget")}onChildRemoved(e){R.isGeneratedTabBarProperty.get(e.child)||(e.child.removeClass("lm-DockPanel-widget"),q.pB.postMessage(this,R.LayoutModified))}_evtDragEnter(e){e.mimeData.hasData("application/vnd.lumino.widget-factory")&&(e.preventDefault(),e.stopPropagation())}_evtDragLeave(e){e.preventDefault(),this._tabsConstrained&&e.source!==this||(e.stopPropagation(),this.overlay.hide(1))}_evtDragOver(e){e.preventDefault(),this._tabsConstrained&&e.source!==this||"invalid"===this._showOverlay(e.clientX,e.clientY)?e.dropAction="none":(e.stopPropagation(),e.dropAction=e.proposedAction)}_evtDrop(e){if(e.preventDefault(),this.overlay.hide(0),"none"===e.proposedAction){e.dropAction="none";return}let{clientX:t,clientY:i}=e,{zone:s,target:n}=R.findDropTarget(this,t,i,this._edges);if(this._tabsConstrained&&e.source!==this||"invalid"===s){e.dropAction="none";return}let r=e.mimeData.getData("application/vnd.lumino.widget-factory");if("function"!=typeof r){e.dropAction="none";return}let a=r();if(!(a instanceof J)||a.contains(this)){e.dropAction="none";return}let o=n?R.getDropRef(n.tabBar):null;switch(s){case"root-all":this.addWidget(a);break;case"root-top":this.addWidget(a,{mode:"split-top"});break;case"root-left":this.addWidget(a,{mode:"split-left"});break;case"root-right":this.addWidget(a,{mode:"split-right"});break;case"root-bottom":this.addWidget(a,{mode:"split-bottom"});break;case"widget-all":case"widget-tab":this.addWidget(a,{mode:"tab-after",ref:o});break;case"widget-top":this.addWidget(a,{mode:"split-top",ref:o});break;case"widget-left":this.addWidget(a,{mode:"split-left",ref:o});break;case"widget-right":this.addWidget(a,{mode:"split-right",ref:o});break;case"widget-bottom":this.addWidget(a,{mode:"split-bottom",ref:o});break;default:throw"unreachable"}e.dropAction=e.proposedAction,e.stopPropagation(),this.activateWidget(a)}_evtKeyDown(e){e.preventDefault(),e.stopPropagation(),27===e.keyCode&&(this._releaseMouse(),q.pB.postMessage(this,R.LayoutModified))}_evtPointerDown(e){if(0!==e.button)return;let t=this.layout,i=e.target,s=(0,W.sE)(t.handles(),e=>e.contains(i));if(!s)return;e.preventDefault(),e.stopPropagation(),this._document.addEventListener("keydown",this,!0),this._document.addEventListener("pointerup",this,!0),this._document.addEventListener("pointermove",this,!0),this._document.addEventListener("contextmenu",this,!0);let n=s.getBoundingClientRect(),r=e.clientX-n.left,a=e.clientY-n.top,o=window.getComputedStyle(s),h=V.n.overrideCursor(o.cursor,this._document);this._pressData={handle:s,deltaX:r,deltaY:a,override:h}}_evtPointerMove(e){if(!this._pressData)return;e.preventDefault(),e.stopPropagation();let t=this.node.getBoundingClientRect(),i=e.clientX-t.left-this._pressData.deltaX,s=e.clientY-t.top-this._pressData.deltaY;this.layout.moveHandle(this._pressData.handle,i,s)}_evtPointerUp(e){0===e.button&&(e.preventDefault(),e.stopPropagation(),this._releaseMouse(),q.pB.postMessage(this,R.LayoutModified))}_releaseMouse(){this._pressData&&(this._pressData.override.dispose(),this._pressData=null,this._document.removeEventListener("keydown",this,!0),this._document.removeEventListener("pointerup",this,!0),this._document.removeEventListener("pointermove",this,!0),this._document.removeEventListener("contextmenu",this,!0))}_showOverlay(e,t){let i,s,n,r,{zone:a,target:o}=R.findDropTarget(this,e,t,this._edges);if("invalid"===a)return this.overlay.hide(100),a;let h=P.TE.boxSizing(this.node),d=this.node.getBoundingClientRect();switch(a){case"root-all":i=h.paddingTop,s=h.paddingLeft,n=h.paddingRight,r=h.paddingBottom;break;case"root-top":i=h.paddingTop,s=h.paddingLeft,n=h.paddingRight,r=d.height*R.GOLDEN_RATIO;break;case"root-left":i=h.paddingTop,s=h.paddingLeft,n=d.width*R.GOLDEN_RATIO,r=h.paddingBottom;break;case"root-right":i=h.paddingTop,s=d.width*R.GOLDEN_RATIO,n=h.paddingRight,r=h.paddingBottom;break;case"root-bottom":i=d.height*R.GOLDEN_RATIO,s=h.paddingLeft,n=h.paddingRight,r=h.paddingBottom;break;case"widget-all":i=o.top,s=o.left,n=o.right,r=o.bottom;break;case"widget-top":i=o.top,s=o.left,n=o.right,r=o.bottom+o.height/2;break;case"widget-left":i=o.top,s=o.left,n=o.right+o.width/2,r=o.bottom;break;case"widget-right":i=o.top,s=o.left+o.width/2,n=o.right,r=o.bottom;break;case"widget-bottom":i=o.top+o.height/2,s=o.left,n=o.right,r=o.bottom;break;case"widget-tab":{let e=o.tabBar.node.getBoundingClientRect().height;i=o.top,s=o.left,n=o.right,r=o.bottom+o.height-e;break}default:throw"unreachable"}return this.overlay.show({top:i,left:s,right:n,bottom:r}),a}_createTabBar(){let e=this._renderer.createTabBar(this._document);return R.isGeneratedTabBarProperty.set(e,!0),"single-document"===this._mode&&e.hide(),e.tabsMovable=this._tabsMovable,e.allowDeselect=!1,e.addButtonEnabled=this._addButtonEnabled,e.removeBehavior="select-previous-tab",e.insertBehavior="select-tab-if-needed",e.tabMoved.connect(this._onTabMoved,this),e.currentChanged.connect(this._onCurrentChanged,this),e.tabCloseRequested.connect(this._onTabCloseRequested,this),e.tabDetachRequested.connect(this._onTabDetachRequested,this),e.tabActivateRequested.connect(this._onTabActivateRequested,this),e.addRequested.connect(this._onTabAddRequested,this),e}_createHandle(){return this._renderer.createHandle()}_onTabMoved(){q.pB.postMessage(this,R.LayoutModified)}_onCurrentChanged(e,t){let{previousTitle:i,currentTitle:s}=t;i&&i.owner.hide(),s&&s.owner.show(),(P.t4.IS_EDGE||P.t4.IS_IE)&&q.pB.flush(),q.pB.postMessage(this,R.LayoutModified)}_onTabAddRequested(e){this._addRequested.emit(e)}_onTabActivateRequested(e,t){t.title.owner.activate()}_onTabCloseRequested(e,t){t.title.owner.close()}_onTabDetachRequested(e,t){if(this._drag)return;e.releaseMouse();let{title:i,tab:s,clientX:n,clientY:r}=t,a=new O.MimeData;a.setData("application/vnd.lumino.widget-factory",()=>i.owner);let o=s.cloneNode(!0);this._drag=new V.n({document:this._document,mimeData:a,dragImage:o,proposedAction:"move",supportedActions:"move",source:this}),s.classList.add("lm-mod-hidden");let h=()=>{this._drag=null,s.classList.remove("lm-mod-hidden")};this._drag.start(n,r).then(h)}}!function(e){e.Overlay=class{constructor(){this._timer=-1,this._hidden=!0,this.node=document.createElement("div"),this.node.classList.add("lm-DockPanel-overlay"),this.node.classList.add("lm-mod-hidden"),this.node.style.position="absolute",this.node.style.contain="strict"}show(e){let t=this.node.style;t.top=`${e.top}px`,t.left=`${e.left}px`,t.right=`${e.right}px`,t.bottom=`${e.bottom}px`,clearTimeout(this._timer),this._timer=-1,this._hidden&&(this._hidden=!1,this.node.classList.remove("lm-mod-hidden"))}hide(e){if(!this._hidden){if(e<=0){clearTimeout(this._timer),this._timer=-1,this._hidden=!0,this.node.classList.add("lm-mod-hidden");return}-1===this._timer&&(this._timer=window.setTimeout(()=>{this._timer=-1,this._hidden=!0,this.node.classList.add("lm-mod-hidden")},e))}}};class t{createTabBar(e){let t=new eu({document:e});return t.addClass("lm-DockPanel-tabBar"),t}createHandle(){let e=document.createElement("div");return e.className="lm-DockPanel-handle",e}}e.Renderer=t,e.defaultRenderer=new t}(ep||(ep={})),(c=R||(R={})).GOLDEN_RATIO=.618,c.DEFAULT_EDGES={top:12,right:40,bottom:40,left:40},c.LayoutModified=new q.Af("layout-modified"),c.isGeneratedTabBarProperty=new F.AttachedProperty({name:"isGeneratedTabBar",create:()=>!1}),c.createSingleDocumentConfig=function(e){if(e.isEmpty)return{main:null};let t=Array.from(e.widgets()),i=e.selectedWidgets().next().value;return{main:{type:"tab-area",widgets:t,currentIndex:i?t.indexOf(i):-1}}},c.findDropTarget=function(e,t,i,s){let n;if(!P.TE.hitTest(e.node,t,i))return{zone:"invalid",target:null};let r=e.layout;if(r.isEmpty)return{zone:"root-all",target:null};if("multiple-document"===e.mode){let n=e.node.getBoundingClientRect(),r=t-n.left+1,a=i-n.top+1,o=n.right-t,h=n.bottom-i;switch(Math.min(a,o,h,r)){case a:if(a<s.top)return{zone:"root-top",target:null};break;case o:if(o<s.right)return{zone:"root-right",target:null};break;case h:if(h<s.bottom)return{zone:"root-bottom",target:null};break;case r:if(r<s.left)return{zone:"root-left",target:null};break;default:throw"unreachable"}}let a=r.hitTestTabAreas(t,i);if(!a)return{zone:"invalid",target:null};if("single-document"===e.mode)return{zone:"widget-all",target:a};let o=a.x-a.left+1,h=a.y-a.top+1,d=a.left+a.width-a.x,l=a.top+a.height-a.y,c=a.tabBar.node.getBoundingClientRect().height;if(h<c)return{zone:"widget-tab",target:a};let u=Math.round(a.width/3),m=Math.round(a.height/3);if(o>u&&d>u&&h>m&&l>m)return{zone:"widget-all",target:a};switch(Math.min(o/=u,h/=m,d/=u,l/=m)){case o:n="widget-left";break;case h:n="widget-top";break;case d:n="widget-right";break;case l:n="widget-bottom";break;default:throw"unreachable"}return{zone:n,target:a}},c.getDropRef=function(e){return 0===e.titles.length?null:e.currentTitle?e.currentTitle.owner:e.titles[e.titles.length-1].owner};class eg{constructor(){this._counter=0,this._widgets=[],this._activeWidget=null,this._currentWidget=null,this._numbers=new Map,this._nodes=new Map,this._activeChanged=new $.Signal(this),this._currentChanged=new $.Signal(this)}dispose(){if(!(this._counter<0)){for(let e of(this._counter=-1,$.Signal.clearData(this),this._widgets))e.node.removeEventListener("focus",this,!0),e.node.removeEventListener("blur",this,!0);this._activeWidget=null,this._currentWidget=null,this._nodes.clear(),this._numbers.clear(),this._widgets.length=0}}get currentChanged(){return this._currentChanged}get activeChanged(){return this._activeChanged}get isDisposed(){return this._counter<0}get currentWidget(){return this._currentWidget}get activeWidget(){return this._activeWidget}get widgets(){return this._widgets}focusNumber(e){let t=this._numbers.get(e);return void 0===t?-1:t}has(e){return this._numbers.has(e)}add(e){if(this._numbers.has(e))return;let t=e.node.contains(document.activeElement),i=t?this._counter++:-1;this._widgets.push(e),this._numbers.set(e,i),this._nodes.set(e.node,e),e.node.addEventListener("focus",this,!0),e.node.addEventListener("blur",this,!0),e.disposed.connect(this._onWidgetDisposed,this),t&&this._setWidgets(e,e)}remove(e){if(!this._numbers.has(e)||(e.disposed.disconnect(this._onWidgetDisposed,this),e.node.removeEventListener("focus",this,!0),e.node.removeEventListener("blur",this,!0),W.RO.removeFirstOf(this._widgets,e),this._nodes.delete(e.node),this._numbers.delete(e),this._currentWidget!==e))return;let t=this._widgets.filter(e=>-1!==this._numbers.get(e)),i=(0,W.Fp)(t,(e,t)=>this._numbers.get(e)-this._numbers.get(t))||null;this._setWidgets(i,null)}handleEvent(e){switch(e.type){case"focus":this._evtFocus(e);break;case"blur":this._evtBlur(e)}}_setWidgets(e,t){let i=this._currentWidget;this._currentWidget=e;let s=this._activeWidget;this._activeWidget=t,i!==e&&this._currentChanged.emit({oldValue:i,newValue:e}),s!==t&&this._activeChanged.emit({oldValue:s,newValue:t})}_evtFocus(e){let t=this._nodes.get(e.currentTarget);t!==this._currentWidget&&this._numbers.set(t,this._counter++),this._setWidgets(t,t)}_evtBlur(e){let t=this._nodes.get(e.currentTarget),i=e.relatedTarget;if(!i||!t.node.contains(i)&&!(0,W.sE)(this._widgets,e=>e.node.contains(i))){this._setWidgets(this._currentWidget,null);return}}_onWidgetDisposed(e){this.remove(e)}}class e_ extends Q{constructor(e={}){super(e),this._dirty=!1,this._rowSpacing=4,this._columnSpacing=4,this._items=[],this._rowStarts=[],this._columnStarts=[],this._rowSizers=[new G],this._columnSizers=[new G],this._box=null,void 0!==e.rowCount&&L.reallocSizers(this._rowSizers,e.rowCount),void 0!==e.columnCount&&L.reallocSizers(this._columnSizers,e.columnCount),void 0!==e.rowSpacing&&(this._rowSpacing=L.clampValue(e.rowSpacing)),void 0!==e.columnSpacing&&(this._columnSpacing=L.clampValue(e.columnSpacing))}dispose(){for(let e of this._items){let t=e.widget;e.dispose(),t.dispose()}this._box=null,this._items.length=0,this._rowStarts.length=0,this._rowSizers.length=0,this._columnStarts.length=0,this._columnSizers.length=0,super.dispose()}get rowCount(){return this._rowSizers.length}set rowCount(e){e!==this.rowCount&&(L.reallocSizers(this._rowSizers,e),this.parent&&this.parent.fit())}get columnCount(){return this._columnSizers.length}set columnCount(e){e!==this.columnCount&&(L.reallocSizers(this._columnSizers,e),this.parent&&this.parent.fit())}get rowSpacing(){return this._rowSpacing}set rowSpacing(e){e=L.clampValue(e),this._rowSpacing!==e&&(this._rowSpacing=e,this.parent&&this.parent.fit())}get columnSpacing(){return this._columnSpacing}set columnSpacing(e){e=L.clampValue(e),this._columnSpacing!==e&&(this._columnSpacing=e,this.parent&&this.parent.fit())}rowStretch(e){let t=this._rowSizers[e];return t?t.stretch:-1}setRowStretch(e,t){let i=this._rowSizers[e];i&&(t=L.clampValue(t),i.stretch!==t&&(i.stretch=t,this.parent&&this.parent.update()))}columnStretch(e){let t=this._columnSizers[e];return t?t.stretch:-1}setColumnStretch(e,t){let i=this._columnSizers[e];i&&(t=L.clampValue(t),i.stretch!==t&&(i.stretch=t,this.parent&&this.parent.update()))}*[Symbol.iterator](){for(let e of this._items)yield e.widget}addWidget(e){-1===W.RO.findFirstIndex(this._items,t=>t.widget===e)&&(this._items.push(new Z(e)),this.parent&&this.attachWidget(e))}removeWidget(e){let t=W.RO.findFirstIndex(this._items,t=>t.widget===e);if(-1===t)return;let i=W.RO.removeAt(this._items,t);this.parent&&this.detachWidget(e),i.dispose()}init(){for(let e of(super.init(),this))this.attachWidget(e)}attachWidget(e){this.parent.isAttached&&q.pB.sendMessage(e,J.Msg.BeforeAttach),this.parent.node.appendChild(e.node),this.parent.isAttached&&q.pB.sendMessage(e,J.Msg.AfterAttach),this.parent.fit()}detachWidget(e){this.parent.isAttached&&q.pB.sendMessage(e,J.Msg.BeforeDetach),this.parent.node.removeChild(e.node),this.parent.isAttached&&q.pB.sendMessage(e,J.Msg.AfterDetach),this.parent.fit()}onBeforeShow(e){super.onBeforeShow(e),this.parent.update()}onBeforeAttach(e){super.onBeforeAttach(e),this.parent.fit()}onChildShown(e){this.parent.fit()}onChildHidden(e){this.parent.fit()}onResize(e){this.parent.isVisible&&this._update(e.width,e.height)}onUpdateRequest(e){this.parent.isVisible&&this._update(-1,-1)}onFitRequest(e){this.parent.isAttached&&this._fit()}_fit(){for(let e=0,t=this.rowCount;e<t;++e)this._rowSizers[e].minSize=0;for(let e=0,t=this.columnCount;e<t;++e)this._columnSizers[e].minSize=0;let e=this._items.filter(e=>!e.isHidden);for(let t=0,i=e.length;t<i;++t)e[t].fit();let t=this.rowCount-1,i=this.columnCount-1;e.sort(L.rowSpanCmp);for(let i=0,s=e.length;i<s;++i){let s=e[i],n=e_.getCellConfig(s.widget),r=Math.min(n.row,t),a=Math.min(n.row+n.rowSpan-1,t);L.distributeMin(this._rowSizers,r,a,s.minHeight)}e.sort(L.columnSpanCmp);for(let t=0,s=e.length;t<s;++t){let s=e[t],n=e_.getCellConfig(s.widget),r=Math.min(n.column,i),a=Math.min(n.column+n.columnSpan-1,i);L.distributeMin(this._columnSizers,r,a,s.minWidth)}if("set-no-constraint"===this.fitPolicy){q.pB.sendMessage(this.parent,J.Msg.UpdateRequest);return}let s=t*this._rowSpacing,n=i*this._columnSpacing;for(let e=0,t=this.rowCount;e<t;++e)s+=this._rowSizers[e].minSize;for(let e=0,t=this.columnCount;e<t;++e)n+=this._columnSizers[e].minSize;let r=this._box=P.TE.boxSizing(this.parent.node);n+=r.horizontalSum,s+=r.verticalSum;let a=this.parent.node.style;a.minWidth=`${n}px`,a.minHeight=`${s}px`,this._dirty=!0,this.parent.parent&&q.pB.sendMessage(this.parent.parent,J.Msg.FitRequest),this._dirty&&q.pB.sendMessage(this.parent,J.Msg.UpdateRequest)}_update(e,t){this._dirty=!1,e<0&&(e=this.parent.node.offsetWidth),t<0&&(t=this.parent.node.offsetHeight),this._box||(this._box=P.TE.boxSizing(this.parent.node));let i=this._box.paddingTop,s=this._box.paddingLeft,n=e-this._box.horizontalSum,r=t-this._box.verticalSum,a=this.rowCount-1,o=this.columnCount-1,h=a*this._rowSpacing,d=o*this._columnSpacing;_.calc(this._rowSizers,Math.max(0,r-h)),_.calc(this._columnSizers,Math.max(0,n-d));for(let e=0,t=i,s=this.rowCount;e<s;++e)this._rowStarts[e]=t,t+=this._rowSizers[e].size+this._rowSpacing;for(let e=0,t=s,i=this.columnCount;e<i;++e)this._columnStarts[e]=t,t+=this._columnSizers[e].size+this._columnSpacing;for(let e=0,t=this._items.length;e<t;++e){let t=this._items[e];if(t.isHidden)continue;let i=e_.getCellConfig(t.widget),s=Math.min(i.row,a),n=Math.min(i.column,o),r=Math.min(i.row+i.rowSpan-1,a),h=Math.min(i.column+i.columnSpan-1,o),d=this._columnStarts[n],l=this._rowStarts[s],c=this._columnStarts[h]+this._columnSizers[h].size-d,u=this._rowStarts[r]+this._rowSizers[r].size-l;t.update(d,l,c,u)}}}(u=e_||(e_={})).getCellConfig=function(e){return L.cellConfigProperty.get(e)},u.setCellConfig=function(e,t){L.cellConfigProperty.set(e,L.normalizeConfig(t))},(m=L||(L={})).cellConfigProperty=new F.AttachedProperty({name:"cellConfig",create:()=>({row:0,column:0,rowSpan:1,columnSpan:1}),changed:function(e){e.parent&&e.parent.layout instanceof e_&&e.parent.fit()}}),m.normalizeConfig=function(e){let t=Math.max(0,Math.floor(e.row||0));return{row:t,column:Math.max(0,Math.floor(e.column||0)),rowSpan:Math.max(1,Math.floor(e.rowSpan||0)),columnSpan:Math.max(1,Math.floor(e.columnSpan||0))}},m.clampValue=function(e){return Math.max(0,Math.floor(e))},m.rowSpanCmp=function(e,t){let i=m.cellConfigProperty.get(e.widget),s=m.cellConfigProperty.get(t.widget);return i.rowSpan-s.rowSpan},m.columnSpanCmp=function(e,t){let i=m.cellConfigProperty.get(e.widget),s=m.cellConfigProperty.get(t.widget);return i.columnSpan-s.columnSpan},m.reallocSizers=function(e,t){for(t=Math.max(1,Math.floor(t));e.length<t;)e.push(new G);e.length>t&&(e.length=t)},m.distributeMin=function(e,t,i,s){if(i<t)return;if(t===i){let i=e[t];i.minSize=Math.max(i.minSize,s);return}let n=0;for(let s=t;s<=i;++s)n+=e[s].minSize;if(n>=s)return;let r=(s-n)/(i-t+1);for(let s=t;s<=i;++s)e[s].minSize+=r};class ef extends J{constructor(e={}){super({node:D.createNode()}),this._activeIndex=-1,this._tabFocusIndex=0,this._menus=[],this._childMenu=null,this._overflowMenu=null,this._menuItemSizes=[],this._overflowIndex=-1,this.addClass("lm-MenuBar"),this.setFlag(J.Flag.DisallowLayout),this.renderer=e.renderer||ef.defaultRenderer,this._forceItemsPosition=e.forceItemsPosition||{forceX:!0,forceY:!0},this._overflowMenuOptions=e.overflowMenuOptions||{isVisible:!0}}dispose(){this._closeChildMenu(),this._menus.length=0,super.dispose()}get childMenu(){return this._childMenu}get overflowIndex(){return this._overflowIndex}get overflowMenu(){return this._overflowMenu}get contentNode(){return this.node.getElementsByClassName("lm-MenuBar-content")[0]}get activeMenu(){return this._menus[this._activeIndex]||null}set activeMenu(e){this.activeIndex=e?this._menus.indexOf(e):-1}get activeIndex(){return this._activeIndex}set activeIndex(e){(e<0||e>=this._menus.length)&&(e=-1),this._activeIndex!==e&&(this._activeIndex=e,-1!==e&&(this._tabFocusIndex=e),this._activeIndex>=0&&this.contentNode.childNodes[this._activeIndex]&&this.contentNode.childNodes[this._activeIndex].focus(),this.update())}get menus(){return this._menus}openActiveMenu(){-1!==this._activeIndex&&(this._openChildMenu(),this._childMenu&&(this._childMenu.activeIndex=-1,this._childMenu.activateNextItem()))}addMenu(e,t=!0){this.insertMenu(this._menus.length,e,t)}insertMenu(e,t,i=!0){this._closeChildMenu();let s=this._menus.indexOf(t),n=Math.max(0,Math.min(e,this._menus.length));if(-1===s){W.RO.insert(this._menus,n,t),t.addClass("lm-MenuBar-menu"),t.aboutToClose.connect(this._onMenuAboutToClose,this),t.menuRequested.connect(this._onMenuMenuRequested,this),t.title.changed.connect(this._onTitleChanged,this),i&&this.update();return}n===this._menus.length&&n--,s!==n&&(W.RO.move(this._menus,s,n),i&&this.update())}removeMenu(e,t=!0){this.removeMenuAt(this._menus.indexOf(e),t)}removeMenuAt(e,t=!0){this._closeChildMenu();let i=W.RO.removeAt(this._menus,e);i&&(i.aboutToClose.disconnect(this._onMenuAboutToClose,this),i.menuRequested.disconnect(this._onMenuMenuRequested,this),i.title.changed.disconnect(this._onTitleChanged,this),i.removeClass("lm-MenuBar-menu"),t&&this.update())}clearMenus(){if(0!==this._menus.length){for(let e of(this._closeChildMenu(),this._menus))e.aboutToClose.disconnect(this._onMenuAboutToClose,this),e.menuRequested.disconnect(this._onMenuMenuRequested,this),e.title.changed.disconnect(this._onTitleChanged,this),e.removeClass("lm-MenuBar-menu");this._menus.length=0,this.update()}}handleEvent(e){switch(e.type){case"keydown":this._evtKeyDown(e);break;case"mousedown":this._evtMouseDown(e);break;case"mousemove":this._evtMouseMove(e);break;case"mouseleave":this._evtMouseLeave(e);break;case"contextmenu":e.preventDefault(),e.stopPropagation()}}onBeforeAttach(e){this.node.addEventListener("keydown",this),this.node.addEventListener("mousedown",this),this.node.addEventListener("mousemove",this),this.node.addEventListener("mouseleave",this),this.node.addEventListener("contextmenu",this)}onAfterDetach(e){this.node.removeEventListener("keydown",this),this.node.removeEventListener("mousedown",this),this.node.removeEventListener("mousemove",this),this.node.removeEventListener("mouseleave",this),this.node.removeEventListener("contextmenu",this),this._closeChildMenu()}onActivateRequest(e){this.isAttached&&(this.activeIndex=0)}onResize(e){this.update(),super.onResize(e)}onUpdateRequest(e){var t;let i=this._menus,s=this.renderer,n=this._activeIndex,r=this._tabFocusIndex>=0&&this._tabFocusIndex<i.length?this._tabFocusIndex:0,a=this._overflowIndex>-1?this._overflowIndex:i.length,o=0,h=!1,d=Array(a=null!==this._overflowMenu?a-1:a);for(let e=0;e<a;++e)d[e]=s.renderItem({title:i[e].title,active:e===n&&0!==i[e].items.length,tabbable:e===r,onfocus:()=>{this.activeIndex=e}}),o+=this._menuItemSizes[e],i[e].title.label===this._overflowMenuOptions.title&&(h=!0,a--);if(this._overflowMenuOptions.isVisible){if(this._overflowIndex>-1&&!h){if(null===this._overflowMenu){let e=null!==(t=this._overflowMenuOptions.title)&&void 0!==t?t:"...";this._overflowMenu=new el({commands:new U.H}),this._overflowMenu.title.label=e,this._overflowMenu.title.mnemonic=0,this.addMenu(this._overflowMenu,!1)}for(let e=i.length-2;e>=a;e--){let t=this.menus[e];t.title.mnemonic=0,this._overflowMenu.insertItem(0,{type:"submenu",submenu:t}),this.removeMenu(t,!1)}d[a]=s.renderItem({title:this._overflowMenu.title,active:a===n&&0!==i[a].items.length,tabbable:a===r,onfocus:()=>{this.activeIndex=a}}),a++}else if(null!==this._overflowMenu){let e=this._overflowMenu.items,t=this.node.offsetWidth,n=this._overflowMenu.items.length;for(let h=0;h<n;++h){let n=i.length-1-h;if(t-o>this._menuItemSizes[n]){let t=e[0].submenu;this._overflowMenu.removeItemAt(0),this.insertMenu(a,t,!1),d[a]=s.renderItem({title:t.title,active:!1,tabbable:a===r,onfocus:()=>{this.activeIndex=a}}),a++}}0===this._overflowMenu.items.length&&(this.removeMenu(this._overflowMenu,!1),d.pop(),this._overflowMenu=null,this._overflowIndex=-1)}}Y.Iw.render(d,this.contentNode),this._updateOverflowIndex()}_updateOverflowIndex(){if(!this._overflowMenuOptions.isVisible)return;let e=this.contentNode.childNodes,t=this.node.offsetWidth,i=0,s=-1,n=e.length;if(0==this._menuItemSizes.length)for(let r=0;r<n;r++){let n=e[r];i+=n.offsetWidth,this._menuItemSizes.push(n.offsetWidth),i>t&&-1===s&&(s=r)}else for(let e=0;e<this._menuItemSizes.length;e++)if((i+=this._menuItemSizes[e])>t){s=e;break}this._overflowIndex=s}_evtKeyDown(e){let t=e.keyCode;if(9===t){this.activeIndex=-1;return}if(e.preventDefault(),e.stopPropagation(),13===t||32===t||38===t||40===t){this.openActiveMenu();return}if(27===t){this._closeChildMenu(),this.activeIndex=-1,this.node.blur();return}if(37===t){let e=this._activeIndex,t=this._menus.length;this.activeIndex=0===e?t-1:e-1;return}if(39===t){let e=this._activeIndex,t=this._menus.length;this.activeIndex=e===t-1?0:e+1;return}let i=(0,X.Vc)().keyForKeydownEvent(e);if(!i)return;let s=this._activeIndex+1,n=D.findMnemonic(this._menus,i,s);-1===n.index||n.multiple?-1!==n.index?this.activeIndex=n.index:-1!==n.auto&&(this.activeIndex=n.auto):(this.activeIndex=n.index,this.openActiveMenu())}_evtMouseDown(e){if(!P.TE.hitTest(this.node,e.clientX,e.clientY))return;e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let t=W.RO.findFirstIndex(this.contentNode.children,t=>P.TE.hitTest(t,e.clientX,e.clientY));if(-1===t){this._closeChildMenu();return}if(0===e.button){if(this._childMenu)this._closeChildMenu(),this.activeIndex=t;else{let e=this._positionForMenu(t);el.saveWindowData(),this.activeIndex=t,this._openChildMenu(e)}}}_evtMouseMove(e){let t=W.RO.findFirstIndex(this.contentNode.children,t=>P.TE.hitTest(t,e.clientX,e.clientY));if(t===this._activeIndex||-1===t&&this._childMenu)return;let i=t>=0&&this._childMenu?this._positionForMenu(t):null;el.saveWindowData(),this.activeIndex=t,i&&this._openChildMenu(i)}_positionForMenu(e){let{left:t,bottom:i}=this.contentNode.children[e].getBoundingClientRect();return{top:i,left:t}}_evtMouseLeave(e){this._childMenu||(this.activeIndex=-1)}_openChildMenu(e={}){let t=this.activeMenu;if(!t){this._closeChildMenu();return}let i=this._childMenu;if(i===t)return;this._childMenu=t,i?i.close():document.addEventListener("mousedown",this,!0),q.pB.sendMessage(this,J.Msg.UpdateRequest);let{left:s,top:n}=e;(void 0===s||void 0===n)&&({left:s,top:n}=this._positionForMenu(this._activeIndex)),i||this.addClass("lm-mod-active"),t.items.length>0&&t.open(s,n,this._forceItemsPosition)}_closeChildMenu(){if(!this._childMenu)return;this.removeClass("lm-mod-active"),document.removeEventListener("mousedown",this,!0);let e=this._childMenu;this._childMenu=null,e.close(),this.activeIndex=-1}_onMenuAboutToClose(e){e===this._childMenu&&(this.removeClass("lm-mod-active"),document.removeEventListener("mousedown",this,!0),this._childMenu=null,this.activeIndex=-1)}_onMenuMenuRequested(e,t){if(e!==this._childMenu)return;let i=this._activeIndex,s=this._menus.length;switch(t){case"next":this.activeIndex=i===s-1?0:i+1;break;case"previous":this.activeIndex=0===i?s-1:i-1}this.openActiveMenu()}_onTitleChanged(){this.update()}}!function(e){class t{renderItem(e){let t=this.createItemClass(e),i=this.createItemDataset(e),s=this.createItemARIA(e);return Y.h.li({className:t,dataset:i,tabindex:e.tabbable?"0":"-1",onfocus:e.onfocus,...s},this.renderIcon(e),this.renderLabel(e))}renderIcon(e){let t=this.createIconClass(e);return Y.h.div({className:t},e.title.icon,e.title.iconLabel)}renderLabel(e){let t=this.formatLabel(e);return Y.h.div({className:"lm-MenuBar-itemLabel"},t)}createItemClass(e){let t="lm-MenuBar-item";return e.title.className&&(t+=` ${e.title.className}`),e.active&&(t+=" lm-mod-active"),t}createItemDataset(e){return e.title.dataset}createItemARIA(e){return{role:"menuitem","aria-haspopup":"true"}}createIconClass(e){let t="lm-MenuBar-itemIcon",i=e.title.iconClass;return i?`${t} ${i}`:t}formatLabel(e){let{label:t,mnemonic:i}=e.title;if(i<0||i>=t.length)return t;let s=t.slice(0,i),n=t.slice(i+1),r=t[i];return[s,Y.h.span({className:"lm-MenuBar-itemMnemonic"},r),n]}}e.Renderer=t,e.defaultRenderer=new t}(ef||(ef={})),(p=D||(D={})).createNode=function(){let e=document.createElement("div"),t=document.createElement("ul");return t.className="lm-MenuBar-content",e.appendChild(t),t.setAttribute("role","menubar"),e},p.findMnemonic=function(e,t,i){let s=-1,n=-1,r=!1,a=t.toUpperCase();for(let t=0,o=e.length;t<o;++t){let h=(t+i)%o,d=e[h].title;if(0===d.label.length)continue;let l=d.mnemonic;if(l>=0&&l<d.label.length){d.label[l].toUpperCase()===a&&(-1===s?s=h:r=!0);continue}-1===n&&d.label[0].toUpperCase()===a&&(n=h)}return{index:s,multiple:r,auto:n}},(g=k||(k={})).createNode=function(){let e=document.createElement("div"),t=document.createElement("div"),i=document.createElement("div"),s=document.createElement("div"),n=document.createElement("div");return t.className="lm-ScrollBar-button",i.className="lm-ScrollBar-button",t.dataset.action="decrement",i.dataset.action="increment",s.className="lm-ScrollBar-track",n.className="lm-ScrollBar-thumb",s.appendChild(n),e.appendChild(t),e.appendChild(s),e.appendChild(i),e},g.findPart=function(e,t){return e.thumbNode.contains(t)?"thumb":e.trackNode.contains(t)?"track":e.decrementNode.contains(t)?"decrement":e.incrementNode.contains(t)?"increment":null};class eb extends ee{constructor(e={}){super(e),this._dirty=!1,this._items=[],this._box=null,this._hiddenMode=void 0!==e.hiddenMode?e.hiddenMode:J.HiddenMode.Display}get hiddenMode(){return this._hiddenMode}set hiddenMode(e){this._hiddenMode!==e&&(this._hiddenMode=e,this.widgets.length>1&&this.widgets.forEach(e=>{e.hiddenMode=this._hiddenMode}))}dispose(){for(let e of this._items)e.dispose();this._box=null,this._items.length=0,super.dispose()}attachWidget(e,t){this._hiddenMode===J.HiddenMode.Scale&&this._items.length>0?(1===this._items.length&&(this.widgets[0].hiddenMode=J.HiddenMode.Scale),t.hiddenMode=J.HiddenMode.Scale):t.hiddenMode=J.HiddenMode.Display,W.RO.insert(this._items,e,new Z(t)),this.parent.isAttached&&q.pB.sendMessage(t,J.Msg.BeforeAttach),this.parent.node.appendChild(t.node),this.parent.isAttached&&q.pB.sendMessage(t,J.Msg.AfterAttach),this.parent.fit()}moveWidget(e,t,i){W.RO.move(this._items,e,t),this.parent.update()}detachWidget(e,t){let i=W.RO.removeAt(this._items,e);this.parent.isAttached&&q.pB.sendMessage(t,J.Msg.BeforeDetach),this.parent.node.removeChild(t.node),this.parent.isAttached&&q.pB.sendMessage(t,J.Msg.AfterDetach),i.widget.node.style.zIndex="",this._hiddenMode===J.HiddenMode.Scale&&(t.hiddenMode=J.HiddenMode.Display,1===this._items.length&&(this._items[0].widget.hiddenMode=J.HiddenMode.Display)),i.dispose(),this.parent.fit()}onBeforeShow(e){super.onBeforeShow(e),this.parent.update()}onBeforeAttach(e){super.onBeforeAttach(e),this.parent.fit()}onChildShown(e){this.parent.fit()}onChildHidden(e){this.parent.fit()}onResize(e){this.parent.isVisible&&this._update(e.width,e.height)}onUpdateRequest(e){this.parent.isVisible&&this._update(-1,-1)}onFitRequest(e){this.parent.isAttached&&this._fit()}_fit(){let e=0,t=0;for(let i=0,s=this._items.length;i<s;++i){let s=this._items[i];s.isHidden||(s.fit(),e=Math.max(e,s.minWidth),t=Math.max(t,s.minHeight))}let i=this._box=P.TE.boxSizing(this.parent.node);e+=i.horizontalSum,t+=i.verticalSum;let s=this.parent.node.style;s.minWidth=`${e}px`,s.minHeight=`${t}px`,this._dirty=!0,this.parent.parent&&q.pB.sendMessage(this.parent.parent,J.Msg.FitRequest),this._dirty&&q.pB.sendMessage(this.parent,J.Msg.UpdateRequest)}_update(e,t){this._dirty=!1;let i=0;for(let e=0,t=this._items.length;e<t;++e)i+=+!this._items[e].isHidden;if(0===i)return;e<0&&(e=this.parent.node.offsetWidth),t<0&&(t=this.parent.node.offsetHeight),this._box||(this._box=P.TE.boxSizing(this.parent.node));let s=this._box.paddingTop,n=this._box.paddingLeft,r=e-this._box.horizontalSum,a=t-this._box.verticalSum;for(let e=0,t=this._items.length;e<t;++e){let t=this._items[e];t.isHidden||(t.widget.node.style.zIndex=`${e}`,t.update(n,s,r,a))}}}(H||(H={})).createLayout=function(e){return e.layout||new eb},function(e){e.orientationFromPlacement=function(e){return t[e]},e.directionFromPlacement=function(e){return i[e]};let t={top:"horizontal",left:"vertical",right:"vertical",bottom:"horizontal"},i={top:"top-to-bottom",left:"left-to-right",right:"right-to-left",bottom:"bottom-to-top"}}(N||(N={}))}}]);