!function(){"use strict";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let e=Symbol("Comlink.proxy"),t=Symbol("Comlink.endpoint"),a=Symbol("Comlink.releaseProxy"),i=Symbol("Comlink.finalizer"),s=Symbol("Comlink.thrown"),r=e=>"object"==typeof e&&null!==e||"function"==typeof e,n=new Map([["proxy",{canHandle:t=>r(t)&&t[e],serialize(e){let{port1:t,port2:a}=new MessageChannel;return o(e,t),[a,[a]]},deserialize:e=>(e.start(),function e(i,s=[],r=function(){}){let n=!1,o=new Proxy(r,{get(t,r){if(p(n),r===a)return()=>{c&&c.unregister(o),h(i),n=!0};if("then"===r){if(0===s.length)return{then:()=>o};let e=f(i,{type:"GET",path:s.map(e=>e.toString())}).then(y);return e.then.bind(e)}return e(i,[...s,r])},set(e,t,a){p(n);let[r,o]=_(a);return f(i,{type:"SET",path:[...s,t].map(e=>e.toString()),value:r},o).then(y)},apply(a,r,o){p(n);let l=s[s.length-1];if(l===t)return f(i,{type:"ENDPOINT"}).then(y);if("bind"===l)return e(i,s.slice(0,-1));let[h,u]=m(o);return f(i,{type:"APPLY",path:s.map(e=>e.toString()),argumentList:h},u).then(y)},construct(e,t){p(n);let[a,r]=m(t);return f(i,{type:"CONSTRUCT",path:s.map(e=>e.toString()),argumentList:a},r).then(y)}});return function(e,t){let a=(u.get(t)||0)+1;u.set(t,a),c&&c.register(e,t,e)}(o,i),o}(e,[],void 0))}],["throw",{canHandle:e=>r(e)&&s in e,serialize:({value:e})=>[e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[]],deserialize(e){if(e.isError)throw Object.assign(Error(e.value.message),e.value);throw e.value}}]]);function o(t,a=globalThis,r=["*"]){a.addEventListener("message",function n(p){let h;if(!p||!p.data)return;if(!function(e,t){for(let a of e)if(t===a||"*"===a||a instanceof RegExp&&a.test(t))return!0;return!1}(r,p.origin)){console.warn(`Invalid origin '${p.origin}' for comlink proxy`);return}let{id:u,type:c,path:m}=Object.assign({path:[]},p.data),f=(p.data.argumentList||[]).map(y);try{let a=m.slice(0,-1).reduce((e,t)=>e[t],t),i=m.reduce((e,t)=>e[t],t);switch(c){case"GET":h=i;break;case"SET":a[m.slice(-1)[0]]=y(p.data.value),h=!0;break;case"APPLY":h=i.apply(a,f);break;case"CONSTRUCT":{let t=new i(...f);h=Object.assign(t,{[e]:!0})}break;case"ENDPOINT":{let{port1:e,port2:a}=new MessageChannel;o(t,a),d.set(e,[e]),h=e}break;case"RELEASE":h=void 0;break;default:return}}catch(e){h={value:e,[s]:0}}Promise.resolve(h).catch(e=>({value:e,[s]:0})).then(e=>{let[s,r]=_(e);a.postMessage(Object.assign(Object.assign({},s),{id:u}),r),"RELEASE"===c&&(a.removeEventListener("message",n),l(a),i in t&&"function"==typeof t[i]&&t[i]())}).catch(e=>{let[t,i]=_({value:TypeError("Unserializable return value"),[s]:0});a.postMessage(Object.assign(Object.assign({},t),{id:u}),i)})}),a.start&&a.start()}function l(e){"MessagePort"===e.constructor.name&&e.close()}function p(e){if(e)throw Error("Proxy has been released and is not useable")}function h(e){return f(e,{type:"RELEASE"}).then(()=>{l(e)})}let u=new WeakMap,c="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{let t=(u.get(e)||0)-1;u.set(e,t),0===t&&h(e)});function m(e){var t;let a=e.map(_);return[a.map(e=>e[0]),(t=a.map(e=>e[1]),Array.prototype.concat.apply([],t))]}let d=new WeakMap;function _(e){for(let[t,a]of n)if(a.canHandle(e)){let[i,s]=a.serialize(e);return[{type:"HANDLER",name:t,value:i},s]}return[{type:"RAW",value:e},d.get(e)||[]]}function y(e){switch(e.type){case"HANDLER":return n.get(e.name).deserialize(e.value);case"RAW":return e.value}}function f(e,t,a){return new Promise(i=>{let s=[,,,,].fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");e.addEventListener("message",function t(a){a.data&&a.data.id&&a.data.id===s&&(e.removeEventListener("message",t),i(a.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:s},t),a)})}let g=new class{constructor(){this._options=null,this._initializer=null,this._localPath="",this._driveName="",this._initialized=new Promise((e,t)=>{this._initializer={resolve:e,reject:t}})}async initialize(e){var t;if(this._options=e,e.location.includes(":")){let t=e.location.split(":");this._driveName=t[0],this._localPath=t[1]}else this._driveName="",this._localPath=e.location;await this.initRuntime(e),await this.initPackageManager(e),await this.initKernel(e),await this.initGlobals(e),null===(t=this._initializer)||void 0===t||t.resolve()}async initRuntime(e){let{pyodideUrl:t,indexUrl:a}=e;if(t.endsWith(".mjs")){let e=await import(t);this._pyodide=await e.loadPyodide({indexURL:a})}else importScripts(t),this._pyodide=await self.loadPyodide({indexURL:a})}async initPackageManager(e){if(!this._options)throw Error("Uninitialized");let{pipliteWheelUrl:t,disablePyPIFallback:a,pipliteUrls:i}=this._options;await this._pyodide.loadPackage(["micropip"]),await this._pyodide.runPythonAsync(`
      import micropip
      await micropip.install('${t}', keep_going=True)
      import piplite.piplite
      piplite.piplite._PIPLITE_DISABLE_PYPI = ${a?"True":"False"}
      piplite.piplite._PIPLITE_URLS = ${JSON.stringify(i)}
    `)}async initKernel(e){await this._pyodide.runPythonAsync(`
      await piplite.install(['matplotlib', 'ipykernel'], keep_going=True);
      await piplite.install(['pyolite'], keep_going=True);
      await piplite.install(['ipython'], keep_going=True);
      import pyolite
    `),e.mountDrive&&this._localPath&&await this._pyodide.runPythonAsync(`
        import os;
        os.chdir("${this._localPath}");
      `)}async initGlobals(e){let{globals:t}=this._pyodide;this._kernel=t.get("pyolite").kernel_instance.copy(),this._stdout_stream=t.get("pyolite").stdout_stream.copy(),this._stderr_stream=t.get("pyolite").stderr_stream.copy(),this._interpreter=this._kernel.interpreter.copy(),this._interpreter.send_comm=this.sendComm.bind(this)}mapToObject(e){let t=e instanceof Array?[]:{};return e.forEach((e,a)=>{t[a]=e instanceof Map||e instanceof Array?this.mapToObject(e):e}),t}formatResult(e){if(!this._pyodide.isPyProxy(e))return e;let t=e.toJs(),a=this.mapToObject(t);return a}async setup(e){await this._initialized,this._kernel._parent_header=this._pyodide.toPy(e)}async execute(e,t){await this.setup(t);let a=(e,t,a)=>{let i={execution_count:e,data:this.formatResult(t),metadata:this.formatResult(a)};postMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:i,type:"execute_result"})},i=e=>{let t={wait:this.formatResult(e)};postMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:t,type:"clear_output"})},s=(e,t,a)=>{let i={data:this.formatResult(e),metadata:this.formatResult(t),transient:this.formatResult(a)};postMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:i,type:"display_data"})},r=(e,t,a)=>{let i={data:this.formatResult(e),metadata:this.formatResult(t),transient:this.formatResult(a)};postMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:i,type:"update_display_data"})},n=(e,t)=>{let a={name:this.formatResult(e),text:this.formatResult(t)};postMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:a,type:"stream"})};this._stdout_stream.publish_stream_callback=n,this._stderr_stream.publish_stream_callback=n,this._interpreter.display_pub.clear_output_callback=i,this._interpreter.display_pub.display_data_callback=s,this._interpreter.display_pub.update_display_data_callback=r,this._interpreter.displayhook.publish_execution_result=a,this._interpreter.input=this.input.bind(this),this._interpreter.getpass=this.getpass.bind(this);let o=await this._kernel.run(e.code),l=this.formatResult(o);return"error"===l.status&&((e,t,a)=>{postMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:{ename:e,evalue:t,traceback:a},type:"execute_error"})})(l.ename,l.evalue,l.traceback),l}async complete(e,t){await this.setup(t);let a=this._kernel.complete(e.code,e.cursor_pos),i=this.formatResult(a);return i}async inspect(e,t){await this.setup(t);let a=this._kernel.inspect(e.code,e.cursor_pos,e.detail_level),i=this.formatResult(a);return i}async isComplete(e,t){await this.setup(t);let a=this._kernel.is_complete(e.code),i=this.formatResult(a);return i}async commInfo(e,t){await this.setup(t);let a=this._kernel.comm_info(e.target_name),i=this.formatResult(a);return{comms:i,status:"ok"}}async commOpen(e,t){await this.setup(t);let a=this._kernel.comm_manager.comm_open(this._pyodide.toPy(e)),i=this.formatResult(a);return i}async commMsg(e,t){await this.setup(t);let a=this._kernel.comm_manager.comm_msg(this._pyodide.toPy(e)),i=this.formatResult(a);return i}async commClose(e,t){await this.setup(t);let a=this._kernel.comm_manager.comm_close(this._pyodide.toPy(e)),i=this.formatResult(a);return i}async inputReply(e,t){await this.setup(t),this._resolveInputReply(e)}async sendInputRequest(e,t){postMessage({type:"input_request",parentHeader:this.formatResult(this._kernel._parent_header).header,content:{prompt:e,password:t}})}async getpass(e){e=void 0===e?"":e,await this.sendInputRequest(e,!0);let t=new Promise(e=>{this._resolveInputReply=e}),a=await t;return a.value}async input(e){e=void 0===e?"":e,await this.sendInputRequest(e,!1);let t=new Promise(e=>{this._resolveInputReply=e}),a=await t;return a.value}async sendComm(e,t,a,i,s){postMessage({type:e,content:this.formatResult(t),metadata:this.formatResult(a),ident:this.formatResult(i),buffers:this.formatResult(s),parentHeader:this.formatResult(this._kernel._parent_header).header})}};o(g)}(),_N_E={};